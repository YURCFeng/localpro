(self["webpackChunkgeoview"]=self["webpackChunkgeoview"]||[]).push([[969],{274:function(){var e=document.querySelector("head");e&&[16,32,96,160,196].forEach((function(t){var n=document.createElement("link");n.setAttribute("rel","icon"),n.setAttribute("href","https://kitware.github.io/vtk-js/icon/favicon-".concat(t,"x").concat(t,".png")),n.setAttribute("sizes","".concat(t,"x").concat(t)),n.setAttribute("type","image/png"),e.appendChild(n)}))},8692:function(e,t,n){"use strict";n.d(t,{EE:function(){return u},Xk:function(){return m},EW:function(){return d},cM:function(){return f},wZ:function(){return p}});var r=n(6265),a=n.n(r),o=n(9070),i=n(5574),s=n(9912);function l(e){const t=a().create({baseURL:o.Z.BASEURL,transformRequest:[function(e,t){return delete t.post["Content-Type"],e}]});return t.interceptors.request.use((e=>(e.headers.Accept="multipart/form-data",e.headers["Content-Type"]="multipart/form-data",e)),(e=>Promise.reject(e))),t.interceptors.response.use((e=>0!==e.data.code?((0,s.Fx)("#load"),i.z8.error(e.data.msg),Promise.reject()):e),(({response:e})=>Promise.reject(error))),t(e)}var c=n(1298);function u(e){return l({method:"POST",url:"/api/file/upload",data:e,transformRequest:[function(e,t){return delete t.post["Content-Type"],e}],headers:{"Content-Type":"multipart/form-data"}})}function f(e,t){return(0,c.W)({method:"POST",url:`/api/analysis/${t}`,data:e})}function d(e){return(0,c.W)({method:"POST",url:"/api/analysis/histogram_match",data:e})}function p(e){return(0,c.W)({method:"POST",url:"/api/analysis/image_pre",data:e})}function m(e){return(0,c.W)({method:"GET",url:`/api/model/list/${e}`})}},9980:function(e,t,n){"use strict";var r=n(2034),a="function"===typeof Symbol&&"symbol"===typeof Symbol("foo"),o=Object.prototype.toString,i=Array.prototype.concat,s=Object.defineProperty,l=function(e){return"function"===typeof e&&"[object Function]"===o.call(e)},c=n(46)(),u=s&&c,f=function(e,t,n,r){if(t in e)if(!0===r){if(e[t]===n)return}else if(!l(r)||!r())return;u?s(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n},d=function(e,t){var n=arguments.length>2?arguments[2]:{},o=r(t);a&&(o=i.call(o,Object.getOwnPropertySymbols(t)));for(var s=0;s<o.length;s+=1)f(e,o[s],t[o[s]],n[o[s]])};d.supportsDescriptors=!!u,e.exports=d},7796:function(e,t,n){"use strict";n(2087),e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,a,o;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(a=r;0!==a--;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(o=Object.keys(t),r=o.length,r!==Object.keys(n).length)return!1;for(a=r;0!==a--;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=r;0!==a--;){var i=o[a];if(!e(t[i],n[i]))return!1}return!0}return t!==t&&n!==n}},5847:function(e,t,n){"use strict";n(7658);var r="Function.prototype.bind called on incompatible ",a=Array.prototype.slice,o=Object.prototype.toString,i="[object Function]";e.exports=function(e){var t=this;if("function"!==typeof t||o.call(t)!==i)throw new TypeError(r+t);for(var n,s=a.call(arguments,1),l=function(){if(this instanceof n){var r=t.apply(this,s.concat(a.call(arguments)));return Object(r)===r?r:this}return t.apply(e,s.concat(a.call(arguments)))},c=Math.max(0,t.length-s.length),u=[],f=0;f<c;f++)u.push("$"+f);if(n=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(l),t.prototype){var d=function(){};d.prototype=t.prototype,n.prototype=new d,d.prototype=null}return n}},9148:function(e,t,n){"use strict";var r=n(5847);e.exports=Function.prototype.bind||r},8267:function(e,t,n){"use strict";var r;n(3767),n(8585),n(8696);var a=SyntaxError,o=Function,i=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(t){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(M){l=null}var c=function(){throw new i},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(t){return c}}}():c,f=n(2763)(),d=Object.getPrototypeOf||function(e){return e.__proto__},p={},m="undefined"===typeof Uint8Array?r:d(Uint8Array),g={"%AggregateError%":"undefined"===typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"===typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":f?d([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"===typeof Atomics?r:Atomics,"%BigInt%":"undefined"===typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"===typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"===typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"===typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"===typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"===typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"===typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":p,"%Int8Array%":"undefined"===typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"===typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"===typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f?d(d([][Symbol.iterator]())):r,"%JSON%":"object"===typeof JSON?JSON:r,"%Map%":"undefined"===typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!==typeof Map&&f?d((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"===typeof Promise?r:Promise,"%Proxy%":"undefined"===typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"===typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"===typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!==typeof Set&&f?d((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"===typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f?d(""[Symbol.iterator]()):r,"%Symbol%":f?Symbol:r,"%SyntaxError%":a,"%ThrowTypeError%":u,"%TypedArray%":m,"%TypeError%":i,"%Uint8Array%":"undefined"===typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"===typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"===typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"===typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"===typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"===typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"===typeof WeakSet?r:WeakSet};try{null.error}catch(M){var v=d(d(M));g["%Error.prototype%"]=v}var h=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var a=e("%AsyncGenerator%");a&&(n=d(a.prototype))}return g[t]=n,n},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=n(9148),x=n(5769),T=b.call(Function.call,Array.prototype.concat),S=b.call(Function.apply,Array.prototype.splice),O=b.call(Function.call,String.prototype.replace),w=b.call(Function.call,String.prototype.slice),A=b.call(Function.call,RegExp.prototype.exec),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,C=function(e){var t=w(e,0,1),n=w(e,-1);if("%"===t&&"%"!==n)throw new a("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new a("invalid intrinsic syntax, expected opening `%`");var r=[];return O(e,P,(function(e,t,n,a){r[r.length]=n?O(a,I,"$1"):t||e})),r},E=function(e,t){var n,r=e;if(x(y,r)&&(n=y[r],r="%"+n[0]+"%"),x(g,r)){var o=g[r];if(o===p&&(o=h(r)),"undefined"===typeof o&&!t)throw new i("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new a("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!==typeof e||0===e.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!==typeof t)throw new i('"allowMissing" argument must be a boolean');if(null===A(/^%?[^%]*%?$/,e))throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=C(e),r=n.length>0?n[0]:"",o=E("%"+r+"%",t),s=o.name,c=o.value,u=!1,f=o.alias;f&&(r=f[0],S(n,T([0,1],f)));for(var d=1,p=!0;d<n.length;d+=1){var m=n[d],v=w(m,0,1),h=w(m,-1);if(('"'===v||"'"===v||"`"===v||'"'===h||"'"===h||"`"===h)&&v!==h)throw new a("property names with quotes must have matching quotes");if("constructor"!==m&&p||(u=!0),r+="."+m,s="%"+r+"%",x(g,s))c=g[s];else if(null!=c){if(!(m in c)){if(!t)throw new i("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&d+1>=n.length){var y=l(c,m);p=!!y,c=p&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=x(c,m),c=c[m];p&&!u&&(g[s]=c)}}return c}},4372:function(e){"use strict";"undefined"!==typeof self?e.exports=self:"undefined"!==typeof window?e.exports=window:e.exports=Function("return this")()},2108:function(e,t,n){"use strict";var r=n(9980),a=n(4372),o=n(4063),i=n(4906),s=o(),l=function(){return s};r(l,{getPolyfill:o,implementation:a,shim:i}),e.exports=l},4063:function(e,t,n){"use strict";var r=n(4372);e.exports=function(){return"object"===typeof n.g&&n.g&&n.g.Math===Math&&n.g.Array===Array?n.g:r}},4906:function(e,t,n){"use strict";var r=n(9980),a=n(4063);e.exports=function(){var e=a();if(r.supportsDescriptors){var t=Object.getOwnPropertyDescriptor(e,"globalThis");t&&(!t.configurable||!t.enumerable&&t.writable&&globalThis===e)||Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else"object"===typeof globalThis&&globalThis===e||(e.globalThis=e);return e}},46:function(e,t,n){"use strict";var r=n(8267),a=r("%Object.defineProperty%",!0),o=function(){if(a)try{return a({},"a",{value:1}),!0}catch(e){return!1}return!1};o.hasArrayLengthDefineBug=function(){if(!o())return null;try{return 1!==a([],"length",{value:1}).length}catch(e){return!0}},e.exports=o},2763:function(e,t,n){"use strict";var r="undefined"!==typeof Symbol&&Symbol,a=n(3994);e.exports=function(){return"function"===typeof r&&("function"===typeof Symbol&&("symbol"===typeof r("foo")&&("symbol"===typeof Symbol("bar")&&a())))}},3994:function(e){"use strict";e.exports=function(){if("function"!==typeof Symbol||"function"!==typeof Object.getOwnPropertySymbols)return!1;if("symbol"===typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"===typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;var r=42;for(t in e[t]=r,e)return!1;if("function"===typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"===typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var a=Object.getOwnPropertySymbols(e);if(1!==a.length||a[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"===typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==r||!0!==o.enumerable)return!1}return!0}},5769:function(e,t,n){"use strict";var r=n(9148);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},5564:function(e,t,n){"use strict";var r;if(n(7658),!Object.keys){var a=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=n(9833),s=Object.prototype.propertyIsEnumerable,l=!s.call({toString:null},"toString"),c=s.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=function(e){var t=e.constructor;return t&&t.prototype===e},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"===typeof window)return!1;for(var e in window)try{if(!d["$"+e]&&a.call(window,e)&&null!==window[e]&&"object"===typeof window[e])try{f(window[e])}catch(t){return!0}}catch(t){return!0}return!1}(),m=function(e){if("undefined"===typeof window||!p)return f(e);try{return f(e)}catch(t){return!1}};r=function(e){var t=null!==e&&"object"===typeof e,n="[object Function]"===o.call(e),r=i(e),s=t&&"[object String]"===o.call(e),f=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var d=c&&n;if(s&&e.length>0&&!a.call(e,0))for(var p=0;p<e.length;++p)f.push(String(p));if(r&&e.length>0)for(var g=0;g<e.length;++g)f.push(String(g));else for(var v in e)d&&"prototype"===v||!a.call(e,v)||f.push(String(v));if(l)for(var h=m(e),y=0;y<u.length;++y)h&&"constructor"===u[y]||!a.call(e,u[y])||f.push(u[y]);return f}}e.exports=r},2034:function(e,t,n){"use strict";var r=Array.prototype.slice,a=n(9833),o=Object.keys,i=o?function(e){return o(e)}:n(5564),s=Object.keys;i.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return a(e)?s(r.call(e)):s(e)})}else Object.keys=i;return Object.keys||i},e.exports=i},9833:function(e){"use strict";var t=Object.prototype.toString;e.exports=function(e){var n=t.call(e),r="[object Arguments]"===n;return r||(r="[object Array]"!==n&&null!==e&&"object"===typeof e&&"number"===typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),r}},4332:function(e,t,n){var r=n(4805),a=n(6788),o=n(9787),i=n(661),s=n(2629),l=n(3363),c=n(4878);c.alea=r,c.xor128=a,c.xorwow=o,c.xorshift7=i,c.xor4096=s,c.tychei=l,e.exports=c},4805:function(e,t,n){var r;e=n.nmd(e),function(e,a,o){function i(e){var t=this,n=c();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var n=new i(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}function c(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t}a&&a.exports?a.exports=l:n.amdD&&n.amdO?(r=function(){return l}.call(t,n,t,a),void 0===r||(a.exports=r)):this.alea=l}(0,e,n.amdD)},3363:function(e,t,n){var r;e=n.nmd(e),function(e,a,o){function i(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=l:n.amdD&&n.amdO?(r=function(){return l}.call(t,n,t,a),void 0===r||(a.exports=r)):this.tychei=l}(0,e,n.amdD)},6788:function(e,t,n){var r;e=n.nmd(e),function(e,a,o){function i(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=l:n.amdD&&n.amdO?(r=function(){return l}.call(t,n,t,a),void 0===r||(a.exports=r)):this.xor128=l}(0,e,n.amdD)},2629:function(e,t,n){var r;e=n.nmd(e),function(e,a,o){function i(e){var t=this;function n(e,t){var n,r,a,o,i,s=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),a=0,o=-32;o<l;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,n=s[127&o]^=r+i,a=0==n?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,o=512;o>0;--o)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=i,e.X=s,e.i=a}t.next=function(){var e,n,r=t.w,a=t.X,o=t.i;return t.w=r=r+1640531527|0,n=a[o+34&127],e=a[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[o]=n^e,t.i=o,n+(r^r>>>16)|0},n(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=l:n.amdD&&n.amdO?(r=function(){return l}.call(t,n,t,a),void 0===r||(a.exports=r)):this.xor4096=l}(0,e,n.amdD)},661:function(e,t,n){var r;e=n.nmd(e),n(7658),function(e,a,o){function i(e){var t=this;function n(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;while(r.length<8)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],e^=e>>>7,n=e^e<<24,e=r[a+1&7],n^=e^e>>>10,e=r[a+3&7],n^=e^e>>>3,e=r[a+4&7],n^=e^e<<7,e=r[a+7&7],e^=e<<13,n^=e^e<<9,r[a]=n,t.i=a+1&7,n},n(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=l:n.amdD&&n.amdO?(r=function(){return l}.call(t,n,t,a),void 0===r||(a.exports=r)):this.xorshift7=l}(0,e,n.amdD)},9787:function(e,t,n){var r;e=n.nmd(e),function(e,a,o){function i(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=l:n.amdD&&n.amdO?(r=function(){return l}.call(t,n,t,a),void 0===r||(a.exports=r)):this.xorwow=l}(0,e,n.amdD)},4878:function(e,t,n){var r;n(7658),n(3767),n(8585),n(8696),function(a,o,i){var s,l=256,c=6,u=52,f="random",d=i.pow(l,c),p=i.pow(2,u),m=2*p,g=l-1;function v(e,t,n){var r=[];t=1==t?{entropy:!0}:t||{};var a=x(b(t.entropy?[e,S(o)]:null==e?T():e,3),r),s=new h(r),u=function(){var e=s.g(c),t=d,n=0;while(e<p)e=(e+n)*l,t*=l,n=s.g(1);while(e>=m)e/=2,t/=2,n>>>=1;return(e+n)/t};return u.int32=function(){return 0|s.g(4)},u.quick=function(){return s.g(4)/4294967296},u.double=u,x(S(s.S),o),(t.pass||n||function(e,t,n,r){return r&&(r.S&&y(r,s),e.state=function(){return y(s,{})}),n?(i[f]=e,t):e})(u,a,"global"in t?t.global:this==i,t.state)}function h(e){var t,n=e.length,r=this,a=0,o=r.i=r.j=0,i=r.S=[];n||(e=[n++]);while(a<l)i[a]=a++;for(a=0;a<l;a++)i[a]=i[o=g&o+e[a%n]+(t=i[a])],i[o]=t;(r.g=function(e){var t,n=0,a=r.i,o=r.j,i=r.S;while(e--)t=i[a=g&a+1],n=n*l+i[g&(i[a]=i[o=g&o+t])+(i[o]=t)];return r.i=a,r.j=o,n})(l)}function y(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function b(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(b(e[n],t-1))}catch(o){}return r.length?r:"string"==a?e:e+"\0"}function x(e,t){var n,r=e+"",a=0;while(a<r.length)t[g&a]=g&(n^=19*t[g&a])+r.charCodeAt(a++);return S(t)}function T(){try{var e;return s&&(e=s.randomBytes)?e=e(l):(e=new Uint8Array(l),(a.crypto||a.msCrypto).getRandomValues(e)),S(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,S(o)]}}function S(e){return String.fromCharCode.apply(0,e)}if(x(i.random(),o),e.exports){e.exports=v;try{s=n(5042)}catch(O){}}else r=function(){return v}.call(t,n,t,e),void 0===r||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},2606:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(3396);const a=e=>((0,r.dD)("data-v-1a665ad6"),e=e(),(0,r.Cn)(),e),o=a((()=>(0,r._)("i",{class:"iconfont icon-dianji1"},null,-1)));function i(e,t,n,a,i,s){const l=(0,r.up)("el-col"),c=(0,r.up)("el-row"),u=(0,r.up)("el-header");return(0,r.wg)(),(0,r.j4)(u,{height:"60px"},{default:(0,r.w5)((()=>[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(l,{xs:12,sm:12,md:16,lg:16,xl:16,class:"hidden-sm-and-down",style:{"margin-left":"30px"}}),(0,r.Wm)(l,{xs:24,sm:24,md:8,lg:4,xl:4,style:{"margin-left":"30px"}},{default:(0,r.w5)((()=>[(0,r.Uk)(" more details please click "),(0,r._)("a",{onClick:t[0]||(t[0]=(...e)=>s.goGithub&&s.goGithub(...e))},[(0,r.Uk)("here"),o])])),_:1})])),_:1})])),_:1})}var s={name:"Bottominfor",methods:{goGithub(){window.open("https://github.com/PaddleCV-SIG/GeoView")}}},l=n(89);const c=(0,l.Z)(s,[["render",i],["__scopeId","data-v-1a665ad6"]]);var u=c},4314:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(3396);function a(e,t,n,a,o,i){const s=(0,r.up)("el-col"),l=(0,r.up)("el-row");return(0,r.wg)(),(0,r.j4)(l,{justify:"center",align:"middle"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{xs:8,sm:8,md:8,lg:8,xl:8},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.WI)(e.$slots,"left")])])),_:3}),(0,r.Wm)(s,{xs:8,sm:8,md:8,lg:8,xl:8,style:{"text-align":"center"}},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.WI)(e.$slots,"mid")])])),_:3}),(0,r.Wm)(s,{xs:7,sm:7,md:7,lg:7,xl:7,style:{"text-align":"right"}},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.WI)(e.$slots,"right")])])),_:3}),(0,r.Wm)(s,{xs:1,sm:1,md:1,lg:1,xl:1})])),_:3})}var o={name:"Tabinfor"},i=n(89);const s=(0,i.Z)(o,[["render",a]]);var l=s},4969:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return hp}});var r=n(3396);const a=(0,r._)("div",{id:"sub-title"},[(0,r.Uk)(" 数据读取与推理"),(0,r._)("i",{class:"iconfont icon-dianji"})],-1),o=(0,r._)("label",null,"Select DICOM file series or DICOM file:",-1),i=(0,r._)("textarea",{readonly:"",name:"fileInformation"},"File information...",-1),s=(0,r._)("div",{id:"container"},null,-1);function l(e,t,n,l,c,u){const f=(0,r.up)("Tabinfor"),d=(0,r.up)("el-divider");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(f,null,{left:(0,r.w5)((()=>[a])),_:1}),(0,r.Wm)(d),(0,r._)("div",null,[o,(0,r._)("input",{name:"inputFile",type:"file",ref:"refFileA",multiple:"multiple",onChange:t[0]||(t[0]=e=>u.outputFileInformation(e))},null,544)]),i,s])}n(7658);var c=n(8692),u=n(5893),f=n(9450),d=n(4314),p=n(2606),m=n(7139);const g=e=>((0,r.dD)("data-v-2d671402"),e=e(),(0,r.Cn)(),e),v={id:"cards",class:"drag-box"},h=g((()=>(0,r._)("div",{class:"drag-title"}," 相关信息 ",-1))),y=g((()=>(0,r._)("i",{class:"iconfont icon-guanbi"},null,-1))),b=[y],x={class:"infor-row"},T={class:"infor"},S={class:"icon"},O={class:"infor-row"},w={class:"infor"},A={class:"icon"},P={class:"drag-box-item"};function I(e,t,n,a,o,i){const s=(0,r.up)("el-divider"),l=(0,r.Q2)("drag");return(0,r.wy)(((0,r.wg)(),(0,r.iD)("div",v,[h,(0,r._)("span",{class:"shut-bitton",onClick:t[0]||(t[0]=(...e)=>i.shutDown&&i.shutDown(...e))},b),(0,r.Wm)(s,{style:{"margin-top":"10px"}}),(0,r._)("div",x,[(0,r._)("div",T,[(0,r.WI)(e.$slots,"left-1",{},void 0,!0)]),(0,r._)("div",S,[(0,r.WI)(e.$slots,"rightIcon-1",{},void 0,!0)])]),(0,r._)("div",O,[(0,r._)("div",w,[(0,r.WI)(e.$slots,"left-2",{},void 0,!0)]),(0,r._)("div",A,[(0,r.WI)(e.$slots,"rightIcon-2",{},void 0,!0)])]),(0,r._)("div",P,(0,m.zw)(o.childImgInfor.id),1),(0,r.WI)(e.$slots,"default",{},void 0,!0)])),[[l]])}var C={name:"DraggableItem",props:{imgInfor:{type:Object,default:()=>({})}},emits:["child-vannish"],data(){return{childImgInfor:{}}},mounted(){this.childImgInfor=this.imgInfor},updated(){this.childImgInfor=this.imgInfor},methods:{shutDown(){this.$emit("child-vannish")}}},E=n(89);const M=(0,E.Z)(C,[["render",I],["__scopeId","data-v-2d671402"]]);var R=M,D=n(9070),k=n(5835),L=n(7386),B=n(1237),V=n(5247),F=n(2387),N=n(6542),U=n(790),_=n(180),G=(n(274),n(3767),n(8585),n(8696),1e-6),z="undefined"!==typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function j(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function W(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function K(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],o=t[6],i=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function H(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],c=t[7],u=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],v=t[14],h=t[15],y=n*s-r*i,b=n*l-a*i,x=n*c-o*i,T=r*l-a*s,S=r*c-o*s,O=a*c-o*l,w=u*g-f*m,A=u*v-d*m,P=u*h-p*m,I=f*v-d*g,C=f*h-p*g,E=d*h-p*v,M=y*E-b*C+x*I+T*P-S*A+O*w;return M?(M=1/M,e[0]=(s*E-l*C+c*I)*M,e[1]=(a*C-r*E-o*I)*M,e[2]=(g*O-v*S+h*T)*M,e[3]=(d*S-f*O-p*T)*M,e[4]=(l*P-i*E-c*A)*M,e[5]=(n*E-a*P+o*A)*M,e[6]=(v*x-m*O-h*b)*M,e[7]=(u*O-d*x+p*b)*M,e[8]=(i*C-s*P+c*w)*M,e[9]=(r*P-n*C-o*w)*M,e[10]=(m*S-g*x+h*y)*M,e[11]=(f*x-u*S-p*y)*M,e[12]=(s*A-i*I-l*w)*M,e[13]=(n*I-r*A+a*w)*M,e[14]=(g*b-m*T-v*y)*M,e[15]=(u*T-f*b+d*y)*M,e):null}function X(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8],d=t[9],p=t[10],m=t[11],g=t[12],v=t[13],h=t[14],y=t[15],b=n[0],x=n[1],T=n[2],S=n[3];return e[0]=b*r+x*s+T*f+S*g,e[1]=b*a+x*l+T*d+S*v,e[2]=b*o+x*c+T*p+S*h,e[3]=b*i+x*u+T*m+S*y,b=n[4],x=n[5],T=n[6],S=n[7],e[4]=b*r+x*s+T*f+S*g,e[5]=b*a+x*l+T*d+S*v,e[6]=b*o+x*c+T*p+S*h,e[7]=b*i+x*u+T*m+S*y,b=n[8],x=n[9],T=n[10],S=n[11],e[8]=b*r+x*s+T*f+S*g,e[9]=b*a+x*l+T*d+S*v,e[10]=b*o+x*c+T*p+S*h,e[11]=b*i+x*u+T*m+S*y,b=n[12],x=n[13],T=n[14],S=n[15],e[12]=b*r+x*s+T*f+S*g,e[13]=b*a+x*l+T*d+S*v,e[14]=b*o+x*c+T*p+S*h,e[15]=b*i+x*u+T*m+S*y,e}function q(e,t,n){var r,a,o,i,s,l,c,u,f,d,p,m,g=n[0],v=n[1],h=n[2];return t===e?(e[12]=t[0]*g+t[4]*v+t[8]*h+t[12],e[13]=t[1]*g+t[5]*v+t[9]*h+t[13],e[14]=t[2]*g+t[6]*v+t[10]*h+t[14],e[15]=t[3]*g+t[7]*v+t[11]*h+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8],d=t[9],p=t[10],m=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=f,e[9]=d,e[10]=p,e[11]=m,e[12]=r*g+s*v+f*h+t[12],e[13]=a*g+l*v+d*h+t[13],e[14]=o*g+c*v+p*h+t[14],e[15]=i*g+u*v+m*h+t[15]),e}function Y(e,t,n){var r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Z(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],s=t[6],l=t[7],c=t[8],u=t[9],f=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+c*r,e[5]=i*a+u*r,e[6]=s*a+f*r,e[7]=l*a+d*r,e[8]=c*a-o*r,e[9]=u*a-i*r,e[10]=f*a-s*r,e[11]=d*a-l*r,e}function $(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],l=t[3],c=t[8],u=t[9],f=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-c*r,e[1]=i*a-u*r,e[2]=s*a-f*r,e[3]=l*a-d*r,e[8]=o*r+c*a,e[9]=i*r+u*a,e[10]=s*r+f*a,e[11]=l*r+d*a,e}function J(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],l=t[3],c=t[4],u=t[5],f=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+c*r,e[1]=i*a+u*r,e[2]=s*a+f*r,e[3]=l*a+d*r,e[4]=c*a-o*r,e[5]=u*a-i*r,e[6]=f*a-s*r,e[7]=d*a-l*r,e}function Q(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ee(e,t){var n=t[0],r=t[1],a=t[2],o=t[4],i=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(o,i,s),e[2]=Math.hypot(l,c,u),e}function te(e,t){var n=new z(3);ee(n,t);var r=1/n[0],a=1/n[1],o=1/n[2],i=t[0]*r,s=t[1]*a,l=t[2]*o,c=t[4]*r,u=t[5]*a,f=t[6]*o,d=t[8]*r,p=t[9]*a,m=t[10]*o,g=i+u+m,v=0;return g>0?(v=2*Math.sqrt(g+1),e[3]=.25*v,e[0]=(f-p)/v,e[1]=(d-l)/v,e[2]=(s-c)/v):i>u&&i>m?(v=2*Math.sqrt(1+i-u-m),e[3]=(f-p)/v,e[0]=.25*v,e[1]=(s+c)/v,e[2]=(d+l)/v):u>m?(v=2*Math.sqrt(1+u-i-m),e[3]=(d-l)/v,e[0]=(s+c)/v,e[1]=.25*v,e[2]=(f+p)/v):(v=2*Math.sqrt(1+m-i-u),e[3]=(s-c)/v,e[0]=(d+l)/v,e[1]=(f+p)/v,e[2]=.25*v),e}function ne(e,t,n,r){var a=t[0],o=t[1],i=t[2],s=t[3],l=a+a,c=o+o,u=i+i,f=a*l,d=a*c,p=a*u,m=o*c,g=o*u,v=i*u,h=s*l,y=s*c,b=s*u,x=r[0],T=r[1],S=r[2];return e[0]=(1-(m+v))*x,e[1]=(d+b)*x,e[2]=(p-y)*x,e[3]=0,e[4]=(d-b)*T,e[5]=(1-(f+v))*T,e[6]=(g+h)*T,e[7]=0,e[8]=(p+y)*S,e[9]=(g-h)*S,e[10]=(1-(f+m))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function re(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,s=r+r,l=a+a,c=n*i,u=r*i,f=r*s,d=a*i,p=a*s,m=a*l,g=o*i,v=o*s,h=o*l;return e[0]=1-f-m,e[1]=u+h,e[2]=d-v,e[3]=0,e[4]=u-h,e[5]=1-c-m,e[6]=p+g,e[7]=0,e[8]=d+v,e[9]=p-g,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){var e=0,t=arguments.length;while(t--)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ae=X;function oe(){var e=new z(9);return z!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ie(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function se(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function le(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],c=t[7],u=t[8],f=u*i-s*c,d=-u*o+s*l,p=c*o-i*l,m=n*f+r*d+a*p;return m?(m=1/m,e[0]=f*m,e[1]=(-u*r+a*c)*m,e[2]=(s*r-a*i)*m,e[3]=d*m,e[4]=(u*n-a*l)*m,e[5]=(-s*n+a*o)*m,e[6]=p*m,e[7]=(-c*n+r*l)*m,e[8]=(i*n-r*o)*m,e):null}function ce(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8],d=n[0],p=n[1],m=n[2],g=n[3],v=n[4],h=n[5],y=n[6],b=n[7],x=n[8];return e[0]=d*r+p*i+m*c,e[1]=d*a+p*s+m*u,e[2]=d*o+p*l+m*f,e[3]=g*r+v*i+h*c,e[4]=g*a+v*s+h*u,e[5]=g*o+v*l+h*f,e[6]=y*r+b*i+x*c,e[7]=y*a+b*s+x*u,e[8]=y*o+b*l+x*f,e}function ue(e){if(Array.isArray(e))return e}function fe(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done);i=!0)if(o.push(r.value),t&&o.length===t)break}catch(Dc){s=!0,a=Dc}finally{try{i||null==n["return"]||n["return"]()}finally{if(s)throw a}}return o}}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pe(e,t){if(e){if("string"===typeof e)return de(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?de(e,t):void 0}}function me(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ge(e,t){return ue(e)||fe(e,t)||pe(e,t)||me()}function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function he(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ye(e){if(Array.isArray(e))return de(e)}function be(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function xe(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Te(e){return ye(e)||be(e)||pe(e)||xe()}function Se(e,t){return Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Se(e,t)}function Oe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function we(e,t,n){return we=Oe()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=Function.bind.apply(e,r),o=new a;return n&&Se(o,n.prototype),o},we.apply(null,arguments)}var Ae=n(7796),Pe=n.n(Ae),Ie=n(2108),Ce=n.n(Ie);function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Re=Ce()(),De={vtkObject:function(){return null}};function ke(e){if(null===e||void 0===e)return e;if(e.isA)return e;if(!e.vtkClass)return Re.console&&Re.console.error&&Re.console.error("Invalid VTK object"),null;var t=De[e.vtkClass];if(!t)return Re.console&&Re.console.error&&Re.console.error("No vtk class found for Object of type ".concat(e.vtkClass)),null;var n=Me({},e);Object.keys(n).forEach((function(e){n[e]&&"object"===ve(n[e])&&n[e].vtkClass&&(n[e]=ke(n[e]))}));var r=t(n);return r&&r.modified&&r.modified(),r}function Le(e,t){De[e]=t}function Be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fe(e,t,n){return t&&Ve(e.prototype,t),n&&Ve(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ne(e){return Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(e)}function Ue(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=Ne(e),null===e)break;return e}function _e(){return _e="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Ue(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},_e.apply(this,arguments)}function Ge(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}function ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e,t){if(t&&("object"===ve(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ze(e)}function We(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function Ke(e){var t="function"===typeof Map?new Map:void 0;return Ke=function(e){if(null===e||!We(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return we(e,arguments,Ne(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Se(n,e)},Ke(e)}function He(e){var t=Xe();return function(){var n,r=Ne(e);if(t){var a=Ne(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return je(this,n)}}function Xe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}ke.register=Le;var qe=function(e){Ge(n,e);var t=He(n);function n(){return Be(this,n),t.apply(this,arguments)}return Fe(n,[{key:"push",value:function(){for(var e=0;e<arguments.length;e++)this.includes(arguments[e])||_e(Ne(n.prototype),"push",this).call(this,arguments[e]);return this.length}}]),n}(Ke(Array));function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=0,Je=Symbol("void");function Qe(){return $e}var et={};function tt(){}var nt=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];nt.forEach((function(e){et[e]=tt})),Re.console=console.hasOwnProperty("log")?console:et;var rt={debug:tt,error:Re.console.error||tt,info:Re.console.info||tt,log:Re.console.log||tt,warn:Re.console.warn||tt};function at(e,t){rt[e]&&(rt[e]=t||tt)}function ot(){rt.log.apply(rt,arguments)}function it(){rt.info.apply(rt,arguments)}function st(){rt.debug.apply(rt,arguments)}function lt(){rt.error.apply(rt,arguments)}function ct(){rt.warn.apply(rt,arguments)}var ut={};function ft(e){ut[e]||(rt.error(e),ut[e]=!0)}var dt=Object.create(null);dt.Float32Array=Float32Array,dt.Float64Array=Float64Array,dt.Uint8Array=Uint8Array,dt.Int8Array=Int8Array,dt.Uint16Array=Uint16Array,dt.Int16Array=Int16Array,dt.Uint32Array=Uint32Array,dt.Int32Array=Int32Array,dt.Uint8ClampedArray=Uint8ClampedArray;try{dt.BigInt64Array=BigInt64Array,dt.BigUint64Array=BigUint64Array}catch(yp){}function pt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return we(dt[e]||Float64Array,n)}function mt(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=dt[e]||Float64Array).from.apply(t,r)}function gt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function vt(e){return gt("_"===e[0]?e.slice(1):e)}function ht(e){return e.charAt(0).toLowerCase()+e.slice(1)}function yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=["TB","GB","MB","KB"],a=Number(e),o="B";while(a>n)a/=n,o=r.pop();return"".concat(a.toFixed(t)," ").concat(o)}function bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=[],r=e;while(r>1e3)n.push("000".concat(r%1e3).slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(t)}function xt(e){Object.keys(e).forEach((function(t){Array.isArray(e[t])&&(e[t]=[].concat(e[t]))}))}function Tt(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}function St(e,t){return Object.keys(e).find((function(n){return e[n]===t}))}function Ot(e){return e&&e.isA?e.getState():e}function wt(e){setTimeout(e,0)}function At(e,t){var n=performance.now();e.finally((function(){var e=performance.now()-n;t(e)}))}function Pt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xt(t);var n=[];if(Number.isInteger(t.mtime)||(t.mtime=++$e),"classHierarchy"in t){if(!(t.classHierarchy instanceof qe)){for(var r=new qe,a=0;a<t.classHierarchy.length;a++)r.push(t.classHierarchy[a]);t.classHierarchy=r}}else t.classHierarchy=new qe("vtkObject");function o(e){n[e]=null}function i(e){function t(){o(e)}return Object.freeze({unsubscribe:t})}return e.isDeleted=function(){return!!t.deleted},e.modified=function(r){t.deleted?lt("instance deleted - cannot call any method"):r&&r<e.getMTime()||(t.mtime=++$e,n.forEach((function(t){return t&&t(e)})))},e.onModified=function(e){if(t.deleted)return lt("instance deleted - cannot call any method"),null;var r=n.length;return n.push(e),i(r)},e.getMTime=function(){return t.mtime},e.isA=function(e){var n=t.classHierarchy.length;while(n--)if(t.classHierarchy[n]===e)return!0;return!1},e.getClassName=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.classHierarchy[t.classHierarchy.length-1-e]},e.set=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!1;return Object.keys(n).forEach((function(i){var s=a?null:e["set".concat(gt(i))];s&&Array.isArray(n[i])&&s.length>1?o=s.apply(void 0,Te(n[i]))||o:s?o=s(n[i])||o:(-1!==["mtime"].indexOf(i)||r||ct("Warning: Set value to model directly ".concat(i,", ").concat(n[i])),o=t[i]!==n[i]||o,t[i]=n[i])})),o},e.get=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.length)return t;var a={};return n.forEach((function(e){a[e]=t[e]})),a},e.getReferenceByName=function(e){return t[e]},e.delete=function(){Object.keys(t).forEach((function(e){return delete t[e]})),n.forEach((function(e,t){return o(t)})),t.deleted=!0},e.getState=function(){if(t.deleted)return null;var n=Ze(Ze({},t),{},{vtkClass:e.getClassName()});Object.keys(n).forEach((function(e){null===n[e]||void 0===n[e]||"_"===e[0]?delete n[e]:n[e].isA?n[e]=n[e].getState():Array.isArray(n[e])&&(n[e]=n[e].map(Ot))}));var r={};return Object.keys(n).sort().forEach((function(e){r[e]=n[e]})),r.mtime&&delete r.mtime,r},e.shallowCopy=function(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n.getClassName()!==e.getClassName())throw new Error("Cannot ShallowCopy ".concat(n.getClassName()," into ").concat(e.getClassName()));var a=n.get(),o=Object.keys(t).sort(),i=Object.keys(a).sort();i.forEach((function(e){var n=o.indexOf(e);-1===n?r&&st("add ".concat(e," in shallowCopy")):o.splice(n,1),t[e]=a[e]})),o.length&&r&&st("Untouched keys: ".concat(o.join(", "))),e.modified()},e.toJSON=function(){return e.getState()},e}var It={object:function(e,t,n){return function(){return Ze({},t[n.name])}}};function Ct(e,t,n){n.forEach((function(n){if("object"===ve(n)){var r=It[n.type];e["get".concat(vt(n.name))]=r?r(e,t,n):function(){return t[n.name]}}else e["get".concat(vt(n))]=function(){return t[n]}}))}var Et={enum:function(e,t,n){return function(r){if("string"===typeof r){if(void 0!==n.enum[r])return t[n.name]!==n.enum[r]&&(t[n.name]=n.enum[r],e.modified(),!0);throw lt("Set Enum with invalid argument ".concat(n,", ").concat(r)),new RangeError("Set Enum with invalid string argument")}if("number"===typeof r){if(t[n.name]!==r){if(-1!==Object.keys(n.enum).map((function(e){return n.enum[e]})).indexOf(r))return t[n.name]=r,e.modified(),!0;throw lt("Set Enum outside numeric range ".concat(n,", ").concat(r)),new RangeError("Set Enum outside numeric range")}return!1}throw lt("Set Enum with invalid argument (String/Number) ".concat(n,", ").concat(r)),new TypeError("Set Enum with invalid argument (String/Number)")}},object:function(e,t,n){return function(r){return!Pe()(t[n.name],r)&&(t[n.name]=r,e.modified(),!0)}}};function Mt(e){if("object"===ve(e)){var t=Et[e.type];if(t)return function(n,r){return t(n,r,e)};throw lt("No setter for field ".concat(e)),new TypeError("No setter for field")}return function(t,n){return function(r){return n.deleted?(lt("instance deleted - cannot call any method"),!1):n[e]!==r&&(n[e]=r,t.modified(),!0)}}}function Rt(e,t,n){n.forEach((function(n){"object"===ve(n)?e["set".concat(vt(n.name))]=Mt(n)(e,t):e["set".concat(vt(n))]=Mt(n)(e,t)}))}function Dt(e,t,n){Ct(e,t,n),Rt(e,t,n)}function kt(e,t,n){n.forEach((function(n){e["get".concat(vt(n))]=function(){return t[n]?Array.from(t[n]):t[n]},e["get".concat(vt(n),"ByReference")]=function(){return t[n]}}))}function Lt(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;n.forEach((function(n){if(t[n]&&r&&t[n].length!==r)throw new RangeError("Invalid initial number of values for array (".concat(n,")"));e["set".concat(vt(n))]=function(){if(t.deleted)return lt("instance deleted - cannot call any method"),!1;for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];var l,c=i,u=!1;if(1===c.length&&(null==c[0]||c[0].length>=0)&&(c=c[0],u=!0),null==c)l=t[n]!==c;else{if(r&&c.length!==r){if(!(c.length<r&&void 0!==a))throw new RangeError("Invalid number of values for array setter (".concat(n,")"));c=Array.from(c),u=!1;while(c.length<r)c.push(a)}l=null==t[n]||t[n].length!==c.length;for(var f=0;!l&&f<c.length;++f)l=t[n][f]!==c[f];l&&u&&(c=Array.from(c))}return l&&(t[n]=c,e.modified()),l},e["set".concat(vt(n),"From")]=function(e){var r=t[n];e.forEach((function(e,t){r[t]=e}))}}))}function Bt(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;kt(e,t,n),Lt(e,t,n,r,a)}function Vt(e,t,n){for(var r=0;r<n.length;r++){var a=n[r];void 0!==t[a]&&(t["_".concat(a)]=t[a],delete t[a])}}function Ft(e,t,n,r){function a(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.deleted?lt("instance deleted - cannot call any method"):r>=t.numberOfInputs?lt("algorithm ".concat(e.getClassName()," only has ").concat(t.numberOfInputs," input ports. To add more input ports, use addInputData()")):(t.inputData[r]!==n||t.inputConnection[r])&&(t.inputData[r]=n,t.inputConnection[r]=null,e.modified&&e.modified())}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.inputConnection[e]&&(t.inputData[e]=t.inputConnection[e]()),t.inputData[e]}function i(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.deleted)lt("instance deleted - cannot call any method");else{if(r>=t.numberOfInputs){var a="algorithm ".concat(e.getClassName()," only has ");return a+="".concat(t.numberOfInputs),a+=" input ports. To add more input ports, use addInputConnection()",void lt(a)}t.inputData[r]=null,t.inputConnection[r]=n}}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.inputConnection[e]}function l(){var e=t.numberOfInputs;while(e&&!t.inputData[e-1]&&!t.inputConnection[e-1])e--;return e===t.numberOfInputs&&t.numberOfInputs++,e}function c(e){t.deleted?lt("instance deleted - cannot call any method"):i(e,l())}function u(e){t.deleted?lt("instance deleted - cannot call any method"):a(e,l())}function f(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.deleted?(lt("instance deleted - cannot call any method"),null):(e.shouldUpdate()&&e.update(),t.output[n])}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=function(){return f(t)};return n.filter=e,n}if(t.inputData?t.inputData=t.inputData.map(ke):t.inputData=[],t.inputConnection?t.inputConnection=t.inputConnection.map(ke):t.inputConnection=[],t.output?t.output=t.output.map(ke):t.output=[],t.inputArrayToProcess?t.inputArrayToProcess=t.inputArrayToProcess.map(ke):t.inputArrayToProcess=[],t.numberOfInputs=n,e.shouldUpdate=function(){var n=e.getMTime(),a=1/0,o=r;while(o--){if(!t.output[o]||t.output[o].isDeleted())return!0;var i=t.output[o].getMTime();if(i<n)return!0;i<a&&(a=i)}o=t.numberOfInputs;while(o--){var s,l;if(null!==(s=t.inputConnection[o])&&void 0!==s&&s.filter.shouldUpdate()||(null===(l=e.getInputData(o))||void 0===l?void 0:l.getMTime())>a)return!0}return!1},t.numberOfInputs){var p=t.numberOfInputs;while(p--)t.inputData.push(null),t.inputConnection.push(null);e.setInputData=a,e.setInputConnection=i,e.addInputData=u,e.addInputConnection=c,e.getInputData=o,e.getInputConnection=s}r&&(e.getOutputData=f,e.getOutputPort=d),e.update=function(){var n=[];if(t.numberOfInputs){var r=0;while(r<t.numberOfInputs)n[r]=e.getInputData(r),r++}e.shouldUpdate()&&e.requestData&&e.requestData(n,t.output)},e.getNumberOfInputPorts=function(){return t.numberOfInputs},e.getNumberOfOutputPorts=function(){return r||t.output.length},e.getInputArrayToProcess=function(e){var n=t.inputArrayToProcess[e],r=t.inputData[e];return n&&r?r["get".concat(n.fieldAssociation)]().getArray(n.arrayName):null},e.setInputArrayToProcess=function(e,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Scalars";while(t.inputArrayToProcess.length<e)t.inputArrayToProcess.push(null);t.inputArrayToProcess[e]={arrayName:n,fieldAssociation:r,attributeType:a}}}var Nt=Symbol("Event abort");function Ut(e,t,n){var r=[],a=e.delete,o=1;function i(e){for(var t=0;t<r.length;++t){var n=ge(r[t],1),a=n[0];if(a===e)return void r.splice(t,1)}}function s(e){function t(){i(e)}return Object.freeze({unsubscribe:t})}function l(){var n=arguments;if(t.deleted)lt("instance deleted - cannot call any method");else for(var a=r.slice(),o=function(t){var r=ge(a[t],3),o=r[1],i=r[2];if(!o)return"continue";if(i<0)setTimeout((function(){return o.apply(e,n)}),1-i);else{var s=o.apply(e,n);if(s===Nt)return"break"}},i=0;i<a.length;++i){var s=o(i);if("continue"!==s&&"break"===s)break}}e["invoke".concat(vt(n))]=l,e["on".concat(vt(n))]=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.apply)return console.error("Invalid callback for event ".concat(n)),null;if(t.deleted)return lt("instance deleted - cannot call any method"),null;var i=o++;return r.push([i,e,a]),r.sort((function(e,t){return t[2]-e[2]})),s(i)},e.delete=function(){a(),r.forEach((function(e){var t=ge(e,1),n=t[0];return i(n)}))}}function _t(e,t){var n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={},r={};return e(r,n,t),Object.freeze(r)};return t&&ke.register(t,n),n}function Gt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.filter((function(e){return!!e})).map((function(e){return e.apply(void 0,n)}))}}function zt(e){return e&&e.isA&&e.isA("vtkObject")}function jt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(zt(e)){if(r.indexOf(e)>=0)return n;r.push(e);var a=t(e);void 0!==a&&n.push(a);var o=e.get();Object.keys(o).forEach((function(e){var a=o[e];Array.isArray(a)?a.forEach((function(e){jt(e,t,n,r)})):jt(a,t,n,r)}))}return n}function Wt(e,t,n){var r,a=this,o=function(){for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];var l=a,c=function(){r=null,n||e.apply(l,i)},u=n&&!r;clearTimeout(r),r=setTimeout(c,t),u&&e.apply(l,i)};return o.cancel=function(){return clearTimeout(r)},o}function Kt(e,t){var n=!1,r=null;function a(){n=!1,null!==r&&(o.apply(void 0,Te(r)),r=null)}function o(){for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];n?r=i:(n=!0,e.apply(void 0,i),setTimeout(a,t))}return o}function Ht(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.keystore=Object.assign(t.keystore||{},n),e.setKey=function(e,n){t.keystore[e]=n},e.getKey=function(e){return t.keystore[e]},e.getAllKeys=function(){return Object.keys(t.keystore)},e.deleteKey=function(e){return delete t.keystore[e]},e.clearKeystore=function(){return e.getAllKeys().forEach((function(e){return delete t.keystore[e]}))}}var Xt=1,qt="__root__";function Yt(e,t){Ht(e,t);var n=e.delete;t.proxyId="".concat(Xt++),t.ui=JSON.parse(JSON.stringify(t.ui||[])),Ct(e,t,["proxyId","proxyGroup","proxyName"]),Dt(e,t,["proxyManager"]);var r={},a={};function o(e,t){a[t]||(a[t]=[]);for(var n=a[t],i=0;i<e.length;i++)n.push(e[i].name),r[e[i].name]=e[i],e[i].children&&e[i].children.length&&o(e[i].children,e[i].name)}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qt;return a[e]}function s(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qt,r=[],a=t.proxyId,o=i(n)||[],l=0;l<o.length;l++){var c=o[l],u=e["get".concat(vt(c))],f=u?u():void 0,d={id:a,name:c,value:f},p=s(c);p.length&&(d.children=p),r.push(d)}return r}function l(){if(t.links)for(var n=0;n<t.links.length;n++){var r=t.links[n],a=r.link,o=r.property,i=r.persistent,s=r.updateOnBind,l=r.type;if("application"===l){var c=t.proxyManager.getPropertyLink(a,i);e.registerPropertyLinkForGC(c,"application"),c.bind(e,o,s)}}}o(t.ui,qt),e.updateUI=function(n){t.ui=JSON.parse(JSON.stringify(n||[])),Object.keys(r).forEach((function(e){return delete r[e]})),Object.keys(a).forEach((function(e){return delete a[e]})),o(t.ui,qt),e.modified()},e.updateProxyProperty=function(e,t){var n=r[e];n?Object.assign(n,t):r[e]=Ze({},t)},e.activate=function(){if(t.proxyManager){var n="setActive".concat(vt(e.getProxyGroup().slice(0,-1)));t.proxyManager[n]&&t.proxyManager[n](e)}},t.propertyLinkSubscribers={},e.registerPropertyLinkForGC=function(e,n){n in t.propertyLinkSubscribers||(t.propertyLinkSubscribers[n]=[]),t.propertyLinkSubscribers[n].push(e)},e.gcPropertyLinks=function(n){var r=t.propertyLinkSubscribers[n]||[];while(r.length)r.pop().unbind(e)},t.propertyLinkMap={},e.getPropertyLink=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.propertyLinkMap[e])return t.propertyLinkMap[e];var r=null,a=[],o=0,i=!1;function s(n){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i)return null;var l=[],c=null;o=a.length;while(o--){var u=a[o];u.instance===n?c=u:l.push(u)}if(!c)return null;var f=c.instance["get".concat(vt(c.propertyName))]();if(!Tt(f,r)||s){r=f,i=!0;while(l.length){var d=l.pop();d.instance.set(he({},d.propertyName,r))}i=!1}return t.propertyLinkMap[e].persistent&&(t.propertyLinkMap[e].value=f),f}function l(e,t){var n=[];o=a.length;while(o--){var r=a[o];r.instance!==e||r.propertyName!==t&&void 0!==t||(r.subscription.unsubscribe(),n.push(o))}while(n.length)a.splice(n.pop(),1)}function c(n,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n.onModified(s),c=a[0];return a.push({instance:n,propertyName:r,subscription:i}),o&&(t.propertyLinkMap[e].persistent&&void 0!==t.propertyLinkMap[e].value?n.set(he({},r,t.propertyLinkMap[e].value)):c&&s(c.instance,!0)),{unsubscribe:function(){return l(n,r)}}}function u(){while(a.length)a.pop().subscription.unsubscribe()}var f={bind:c,unbind:l,unsubscribe:u,persistent:n};return t.propertyLinkMap[e]=f,f},e.listPropertyNames=function(){return s().map((function(e){return e.name}))},e.getPropertyByName=function(e){return s().find((function(t){return t.name===e}))},e.getPropertyDomainByName=function(e){return(r[e]||{}).domain},e.getProxySection=function(){return{id:t.proxyId,name:t.proxyGroup,ui:t.ui,properties:s()}},e.delete=function(){var r=Object.keys(t.propertyLinkMap),a=r.length;while(a--)t.propertyLinkMap[r[a]].unsubscribe();Object.keys(t.propertyLinkSubscribers).forEach(e.gcPropertyLinks),n()},e.getState=function(){return null},wt(l)}function Zt(e,t,n){var r=e.delete,a=[],o=Object.keys(n),i=o.length;while(i--){var s=o[i],l=n[s],c=l.modelKey,u=l.property,f=l.modified,d=void 0===f||f,p=vt(u),m=vt(s);e["get".concat(m)]=t[c]["get".concat(p)],e["set".concat(m)]=t[c]["set".concat(p)],d&&a.push(t[c].onModified(e.modified))}e.delete=function(){while(a.length)a.pop().unsubscribe();r()}}function $t(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};function a(e){var n=Object.keys(e),r=n.length;while(r--){var a=n[r];t[a].set(e[a])}}t.this=e;var o=Object.keys(r),i=o.length,s=function(){var s=o[i];t[s]=r[s];var l=n[s];e["set".concat(vt(s))]=function(n){if(n!==t[s]){t[s]=n;var r=l[n];a(r),e.modified()}}};while(i--)s();o.length&&Ct(e,t,o)}var Jt=10,Qt=40,en=800;function tn(e){var t=0,n=0,r=0,a=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=t*Jt,a=n*Jt,"deltaY"in e&&(a=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||a)&&e.deltaMode&&(1===e.deltaMode?(r*=Qt,a*=Qt):(r*=en,a*=en)),r&&!t&&(t=r<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:a}}var nn={algo:Ft,capitalize:gt,chain:Gt,debounce:Wt,enumToString:St,event:Ut,EVENT_ABORT:Nt,formatBytesToProperUnit:yt,formatNumbersWithThousandSeparator:bt,get:Ct,getArray:kt,getCurrentGlobalMTime:Qe,getStateArrayMapFunc:Ot,isVtkObject:zt,keystore:Ht,measurePromiseExecution:At,moveToProtected:Vt,newInstance:_t,newTypedArray:pt,newTypedArrayFrom:mt,normalizeWheel:tn,obj:Pt,proxy:Yt,proxyPropertyMapping:Zt,proxyPropertyState:$t,safeArrays:xt,set:Rt,setArray:Lt,setGet:Dt,setGetArray:Bt,setImmediate:wt,setLoggerFunction:at,throttle:Kt,traverseInstanceTree:jt,TYPED_ARRAYS:dt,uncapitalize:ht,VOID:Je,vtkDebugMacro:st,vtkErrorMacro:lt,vtkInfoMacro:it,vtkLogMacro:ot,vtkOnceErrorMacro:ft,vtkWarningMacro:ct},rn=nn.vtkErrorMacro,an=["Build","Render"];function on(e,t){t.classHierarchy.push("vtkViewNode"),e.build=function(e){},e.render=function(e){},e.traverse=function(n){var r=n.getTraverseOperation(),a=e[r];if(a)a(n);else{e.apply(n,!0);for(var o=0;o<t.children.length;o++)t.children[o].traverse(n);e.apply(n,!1)}},e.apply=function(t,n){var r=e[t.getOperation()];r&&r(n,t)},e.getViewNodeFor=function(n){if(t.renderable===n)return e;for(var r=0;r<t.children.length;++r){var a=t.children[r],o=a.getViewNodeFor(n);if(o)return o}},e.getFirstAncestorOfType=function(e){return t._parent?t._parent.isA(e)?t._parent:t._parent.getFirstAncestorOfType(e):null},e.addMissingNode=function(n){if(n){var r=t._renderableChildMap.get(n);if(void 0!==r)r.setVisited(!0);else{var a=e.createViewNode(n);a&&(a.setParent(e),a.setVisited(!0),t._renderableChildMap.set(n,a),t.children.push(a))}}},e.addMissingNodes=function(n){if(n&&n.length)for(var r=0;r<n.length;++r){var a=n[r],o=t._renderableChildMap.get(a);if(void 0!==o)o.setVisited(!0);else{var i=e.createViewNode(a);i&&(i.setParent(e),i.setVisited(!0),t._renderableChildMap.set(a,i),t.children.push(i))}}},e.addMissingChildren=function(n){if(n&&n.length)for(var r=0;r<n.length;++r){var a=n[r],o=t.children.indexOf(a);-1===o&&(a.setParent(e),t.children.push(a)),a.setVisited(!0)}},e.prepareNodes=function(){for(var e=0;e<t.children.length;++e)t.children[e].setVisited(!1)},e.setVisited=function(e){t.visited=e},e.removeUnusedNodes=function(){for(var e=null,n=0;n<t.children.length;++n){var r=t.children[n],a=r.getVisited();if(a)r.setVisited(!1);else{var o=r.getRenderable();o&&t._renderableChildMap.delete(o),e||(e=[]),e.push(r),r.delete()}}e&&(t.children=t.children.filter((function(t){return!e.includes(t)})))},e.createViewNode=function(e){if(!t.myFactory)return rn("Cannot create view nodes without my own factory"),null;var n=t.myFactory.createNode(e);return n&&n.setRenderable(e),n};var n=e.delete;e.delete=function(){for(var e=0;e<t.children.length;e++)t.children[e].delete();n()}}var sn={renderable:null,myFactory:null,children:[],visited:!1};function ln(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,sn,n),nn.obj(e,t),nn.event(e,t,"event"),t._renderableChildMap=new Map,nn.get(e,t,["visited"]),nn.setGet(e,t,["_parent","renderable","myFactory"]),nn.getArray(e,t,["children"]),nn.moveToProtected(e,t,["parent"]),on(e,t)}var cn=nn.newInstance(ln,"vtkViewNode"),un={newInstance:cn,extend:ln,PASS_TYPES:an};function fn(e,t){t.overrides||(t.overrides={}),t.classHierarchy.push("vtkViewNodeFactory"),e.createNode=function(n){if(n.isDeleted())return null;var r=0,a=n.getClassName(r++),o=!1,i=Object.keys(t.overrides);while(a&&!o)-1!==i.indexOf(a)?o=!0:a=n.getClassName(r++);if(!o)return null;var s=t.overrides[a]();return s.setMyFactory(e),s},e.registerOverride=function(e,n){t.overrides[e]=n}}var dn={};function pn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,dn,n),nn.obj(e,t),fn(e,t)}var mn=nn.newInstance(pn,"vtkViewNodeFactory"),gn={newInstance:mn,extend:pn},vn=Object.create(null);function hn(e,t){vn[e]=t}function yn(e,t){t.classHierarchy.push("vtkOpenGLViewNodeFactory")}var bn={};function xn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,bn,n),t.overrides=vn,gn.extend(e,t,n),yn(e,t)}nn.newInstance(xn,"vtkOpenGLViewNodeFactory");function Tn(e,t){t.classHierarchy.push("vtkOpenGLCamera"),e.buildPass=function(n){n&&(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext())},e.opaquePass=function(e){if(e){var n=t._openGLRenderer.getTiledSizeAndOrigin();t.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),t.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},e.translucentPass=e.opaquePass,e.zBufferPass=e.opaquePass,e.opaqueZBufferPass=e.opaquePass,e.volumePass=e.opaquePass,e.getKeyMatrices=function(n){if(n!==t.lastRenderer||t._openGLRenderWindow.getMTime()>t.keyMatrixTime.getMTime()||e.getMTime()>t.keyMatrixTime.getMTime()||n.getMTime()>t.keyMatrixTime.getMTime()||t.renderable.getMTime()>t.keyMatrixTime.getMTime()){j(t.keyMatrices.wcvc,t.renderable.getViewMatrix()),ie(t.keyMatrices.normalMatrix,t.keyMatrices.wcvc),le(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),K(t.keyMatrices.wcvc,t.keyMatrices.wcvc);var r=t._openGLRenderer.getAspectRatio();j(t.keyMatrices.vcpc,t.renderable.getProjectionMatrix(r,-1,1)),K(t.keyMatrices.vcpc,t.keyMatrices.vcpc),X(t.keyMatrices.wcpc,t.keyMatrices.vcpc,t.keyMatrices.wcvc),t.keyMatrixTime.modified(),t.lastRenderer=n}return t.keyMatrices}}var Sn={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function On(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Sn,n),un.extend(e,t,n),t.keyMatrixTime={},Pt(t.keyMatrixTime),t.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Dt(e,t,["context","keyMatrixTime"]),Tn(e,t)}var wn=_t(On);hn("vtkCamera",wn);var An=st;function Pn(e,t){t.classHierarchy.push("vtkOpenGLRenderer"),e.buildPass=function(n){if(n){if(!t.renderable)return;e.updateLights(),e.prepareNodes(),e.addMissingNode(t.renderable.getActiveCamera()),e.addMissingNodes(t.renderable.getViewPropsWithNestedProps()),e.removeUnusedNodes()}},e.updateLights=function(){for(var e=0,n=t.renderable.getLightsByReference(),r=0;r<n.length;++r)n[r].getSwitch()>0&&e++;return e||(An("No lights are on, creating one."),t.renderable.createLight()),e},e.zBufferPass=function(n){if(n){var r=0,a=t.context;t.renderable.getTransparent()||(t.context.clearColor(1,0,0,1),r|=a.COLOR_BUFFER_BIT),t.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),r|=a.DEPTH_BUFFER_BIT,t.context.depthMask(!0));var o=e.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),a.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),a.colorMask(!0,!0,!0,!0),r&&a.clear(r),a.enable(a.DEPTH_TEST)}},e.opaqueZBufferPass=function(t){return e.zBufferPass(t)},e.cameraPass=function(t){t&&e.clear()},e.getAspectRatio=function(){var e=t._parent.getSizeByReference(),n=t.renderable.getViewportByReference();return e[0]*(n[2]-n[0])/((n[3]-n[1])*e[1])},e.getTiledSizeAndOrigin=function(){var e=t.renderable.getViewportByReference(),n=[0,0,1,1],r=e[0]-n[0],a=e[1]-n[1],o=t._parent.normalizedDisplayToDisplay(r,a),i=Math.round(o[0]),s=Math.round(o[1]),l=e[2]-n[0],c=e[3]-n[1],u=t._parent.normalizedDisplayToDisplay(l,c),f=Math.round(u[0])-i,d=Math.round(u[1])-s;return f<0&&(f=0),d<0&&(d=0),{usize:f,vsize:d,lowerLeftU:i,lowerLeftV:s}},e.clear=function(){var n=0,r=t.context;if(!t.renderable.getTransparent()){var a=t.renderable.getBackgroundByReference();t.context.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}t.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,t.context.depthMask(!0)),r.colorMask(!0,!0,!0,!0);var o=e.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),r.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},e.releaseGraphicsResources=function(){null!==t.selector&&t.selector.releaseGraphicsResources()},e.setOpenGLRenderWindow=function(n){t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))}}var In={context:null,selector:null};function Cn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,In,n),un.extend(e,t,n),Ct(e,t,["shaderCache"]),Dt(e,t,["selector"]),Vt(e,t,["openGLRenderWindow"]),Pn(e,t)}var En=_t(Cn,"vtkOpenGLRenderer");hn("vtkRenderer",En);var Mn={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5},Rn={SlicingMode:Mn},Dn={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},kn={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},Ln=kn.FLOAT,Bn={DefaultDataType:Ln,DataTypeByteSize:Dn,VtkDataTypes:kn},Vn=(n(4332),1e-6),Fn=nn.vtkErrorMacro;nn.vtkWarningMacro;function Nn(e){return function(){return Fn("vtkMath::".concat(e," - NOT IMPLEMENTED"))}}function Un(e){return e/180*Math.PI}function _n(e){return 180*e/Math.PI}Math.round,Math.floor,Math.ceil,Math.min,Math.max;Nn("ceilLog2"),Nn("factorial");function Gn(e){var t=1;while(t<e)t*=2;return t}function zn(e){return e===Gn(e)}Nn("gaussian");function jn(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Wn(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function Kn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Hn(e,t,n){var r=e[1]*t[2]-e[2]*t[1],a=e[2]*t[0]-e[0]*t[2],o=e[0]*t[1]-e[1]*t[0];return n[0]=r,n[1]=a,n[2]=o,n}function Xn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:for(var n=0,r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}}function qn(e){var t=Xn(e);return 0!==t&&(e[0]/=t,e[1]/=t,e[2]/=t),t}function Yn(e,t,n){var r=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],a=e[3]*t[0]+e[4]*t[1]+e[5]*t[2],o=e[6]*t[0]+e[7]*t[1]+e[8]*t[2];n[0]=r,n[1]=a,n[2]=o}function Zn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Vn;if(e.length!==t.length)return!1;function r(e,r){return Math.abs(e-t[r])<=n}return e.every(r)}var $n=Zn;function Jn(e){return e[0]=1,e[1]=-1,e[2]=1,e[3]=-1,e[4]=1,e[5]=-1,e}function Qn(e,t,n){return e<t?t:e>n?n:e}Nn("GetScalarTypeFittingRange"),Nn("GetAdjustedScalarRange");Number.isFinite,Number.isNaN;function er(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function tr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rr=lt,ar=Bn.DefaultDataType;function or(e,t,n){var r,a,o,i,s=e.length;if(0===s)return{min:Number.MAX_VALUE,max:-Number.MAX_VALUE};for(r=e[t],a=r,i=t;i<s;i+=n)o=e[i],o<r?r=o:o>a&&(a=o);return{min:r,max:a}}function ir(){var e=Number.MAX_VALUE,t=-Number.MAX_VALUE,n=0,r=0;return{add:function(a){e>a&&(e=a),t<a&&(t=a),n++,r+=a},get:function(){return{min:e,max:t,count:n,sum:r,mean:r/n}},getRange:function(){return{min:e,max:t}}}}function sr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<0&&n>1){for(var r=e.length,a=r/n,o=new Float64Array(a),i=0,s=0;i<a;++i){for(var l,c=s+n;s<c;++s)o[i]+=e[s]*e[s];l=i,o[l]=Math.pow(o[l],.5)}return or(o,0,1)}return or(e,t<0?0:t,n)}function lr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e||[];while(n.length<=t)n.push(null);return n}function cr(e){return Object.prototype.toString.call(e).slice(8,-1)}function ur(e){for(var t=e.getNumberOfComponents(),n=0,r=new Array(t),a=0;a<e.getNumberOfTuples();++a){e.getTuple(a,r);var o=Xn(r,t);o>n&&(n=o)}return n}var fr={computeRange:sr,createRangeHelper:ir,fastComputeRange:or,getDataType:cr,getMaxNorm:ur};function dr(e,t){function n(n){if(n<0)return!1;var r=e.getNumberOfComponents(),a=t.values.length/(r>0?r:1);if(n===a)return!0;if(n>a){var o=t.values;return t.values=pt(t.dataType,(n+a)*r),t.values.set(o),!0}return t.size>n*r&&(t.size=n*r,e.dataChange()),!0}t.classHierarchy.push("vtkDataArray"),e.dataChange=function(){t.ranges=null,e.modified()},e.resize=function(r){n(r);var a=r*e.getNumberOfComponents();return t.size!==a&&(t.size=a,e.dataChange(),!0)},e.initialize=function(){e.resize(0)},e.getElementComponentSize=function(){return t.values.BYTES_PER_ELEMENT},e.getComponent=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.values[e*t.numberOfComponents+n]},e.setComponent=function(n,r,a){a!==t.values[n*t.numberOfComponents+r]&&(t.values[n*t.numberOfComponents+r]=a,e.dataChange())},e.getValue=function(n){var r=n/t.numberOfComponents,a=n%t.numberOfComponents;return e.getComponent(r,a)},e.setValue=function(n,r){var a=n/t.numberOfComponents,o=n%t.numberOfComponents;e.setComponent(a,o,r)},e.getData=function(){return t.size===t.values.length?t.values:t.values.subarray(0,t.size)},e.getRange=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=n<0?t.numberOfComponents:n,a=null;return t.ranges||(t.ranges=lr(t.ranges,t.numberOfComponents)),a=t.ranges[r],a?(t.rangeTuple[0]=a.min,t.rangeTuple[1]=a.max,t.rangeTuple):(a=sr(e.getData(),n,t.numberOfComponents),t.ranges[r]=a,t.rangeTuple[0]=a.min,t.rangeTuple[1]=a.max,t.rangeTuple)},e.setRange=function(e,n){t.ranges||(t.ranges=lr(t.ranges,t.numberOfComponents));var r={min:e.min,max:e.max};return t.ranges[n]=r,t.rangeTuple[0]=r.min,t.rangeTuple[1]=r.max,t.rangeTuple},e.setTuple=function(e,n){for(var r=e*t.numberOfComponents,a=0;a<t.numberOfComponents;a++)t.values[r+a]=n[a]},e.setTuples=function(e,n){for(var r=e*t.numberOfComponents,a=Math.min(n.length,t.size-r),o=0;o<a;)t.values[r++]=n[o++]},e.insertTuple=function(r,a){return t.size<=r*t.numberOfComponents&&(t.size=(r+1)*t.numberOfComponents,n(r+1)),e.setTuple(r,a),r},e.insertTuples=function(r,a){var o=r+a.length/t.numberOfComponents;return t.size<o*t.numberOfComponents&&(t.size=o*t.numberOfComponents,n(o)),e.setTuples(r,a),o},e.insertNextTuple=function(n){var r=t.size/t.numberOfComponents;return e.insertTuple(r,n)},e.insertNextTuples=function(n){var r=t.size/t.numberOfComponents;return e.insertTuples(r,n)},e.getTuple=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=t.numberOfComponents||1,a=e*r;switch(r){case 4:n[3]=t.values[a+3];case 3:n[2]=t.values[a+2];case 2:n[1]=t.values[a+1];case 1:n[0]=t.values[a];break;default:for(var o=r-1;o>=0;--o)n[o]=t.values[a+o]}return n},e.getTuples=function(n,r){var a=(null!==n&&void 0!==n?n:0)*t.numberOfComponents,o=(null!==r&&void 0!==r?r:e.getNumberOfTuples())*t.numberOfComponents,i=e.getData().subarray(a,o);return i.length>0?i:null},e.getTupleLocation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e*t.numberOfComponents},e.getNumberOfComponents=function(){return t.numberOfComponents},e.getNumberOfValues=function(){return t.size},e.getNumberOfTuples=function(){return t.size/t.numberOfComponents},e.getDataType=function(){return t.dataType},e.newClone=function(){return gr({empty:!0,name:t.name,dataType:t.dataType,numberOfComponents:t.numberOfComponents})},e.getName=function(){return t.name||(e.modified(),t.name="vtkDataArray".concat(e.getMTime())),t.name},e.setData=function(n,r){t.values=n,t.size=n.length,t.dataType=cr(n),r&&(t.numberOfComponents=r),t.size%t.numberOfComponents!==0&&(t.numberOfComponents=1),e.dataChange()},e.getState=function(){if(t.deleted)return null;var n=nr(nr({},t),{},{vtkClass:e.getClassName()});n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach((function(e){n[e]||delete n[e]}));var r={};return Object.keys(n).sort().forEach((function(e){r[e]=n[e]})),r.mtime&&delete r.mtime,r},e.deepCopy=function(t){e.shallowCopy(t),e.setData(t.getData().slice())},e.interpolateTuple=function(n,r,a,o,i,s){var l=t.numberOfComponents||1;l===r.getNumberOfComponents()&&l===o.getNumberOfComponents()||rr("numberOfComponents must match");var c=r.getTuple(a),u=o.getTuple(i),f=[];switch(f.length=l,l){case 4:f[3]=c[3]+(u[3]-c[3])*s;case 3:f[2]=c[2]+(u[2]-c[2])*s;case 2:f[1]=c[1]+(u[1]-c[1])*s;case 1:f[0]=c[0]+(u[0]-c[0])*s;break;default:for(var d=0;d<l;d++)f[d]=c[d]+(u[d]-c[d])*s}return e.insertTuple(n,f)}}var pr={name:"",numberOfComponents:1,dataType:ar,rangeTuple:[0,0]};function mr(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,pr,r),!t.empty&&!t.values&&!t.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");(t.values?Array.isArray(t.values)&&(t.values=mt(t.dataType,t.values)):t.values=pt(t.dataType,t.size),t.values)&&(t.size=null!==(n=t.size)&&void 0!==n?n:t.values.length,t.dataType=cr(t.values));Pt(e,t),Rt(e,t,["name","numberOfComponents"]),dr(e,t)}var gr=_t(mr,"vtkDataArray"),vr=nr(nr({newInstance:gr,extend:mr},fr),Bn);function hr(){var e=new z(3);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function yr(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function br(e,t,n){var r=new z(3);return r[0]=e,r[1]=t,r[2]=n,r}function xr(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Tr(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Sr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Or(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function wr(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Ar(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Pr(e,t){var n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Ir(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Cr(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],l=n[2];return e[0]=a*l-o*s,e[1]=o*i-r*l,e[2]=r*s-a*i,e}function Er(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function Mr(e,t,n){var r=t[0],a=t[1],o=t[2];return e[0]=r*n[0]+a*n[3]+o*n[6],e[1]=r*n[1]+a*n[4]+o*n[7],e[2]=r*n[2]+a*n[5]+o*n[8],e}function Rr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Dr(e,t){var n=e[0],r=e[1],a=e[2],o=t[0],i=t[1],s=t[2];return Math.abs(n-o)<=G*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=G*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-s)<=G*Math.max(1,Math.abs(a),Math.abs(s))}var kr=Sr,Lr=yr;(function(){var e=hr()})();function Br(){var e=new z(4);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Vr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Fr(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i,e}function Nr(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*o+n[12]*i,e[1]=n[1]*r+n[5]*a+n[9]*o+n[13]*i,e[2]=n[2]*r+n[6]*a+n[10]*o+n[14]*i,e[3]=n[3]*r+n[7]*a+n[11]*o+n[15]*i,e}(function(){var e=Br()})();function Ur(){var e=new z(4);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function _r(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Gr(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>G?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function zr(e,t,n,r){var a,o,i,s,l,c=t[0],u=t[1],f=t[2],d=t[3],p=n[0],m=n[1],g=n[2],v=n[3];return o=c*p+u*m+f*g+d*v,o<0&&(o=-o,p=-p,m=-m,g=-g,v=-v),1-o>G?(a=Math.acos(o),i=Math.sin(a),s=Math.sin((1-r)*a)/i,l=Math.sin(r*a)/i):(s=1-r,l=r),e[0]=s*c+l*p,e[1]=s*u+l*m,e[2]=s*f+l*g,e[3]=s*d+l*v,e}function jr(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*o+o]-t[3*i+i]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*o+i]-t[3*i+o])*n,e[o]=(t[3*o+a]+t[3*a+o])*n,e[i]=(t[3*i+a]+t[3*a+i])*n}return e}var Wr=Fr,Kr=(function(){var e=hr(),t=br(1,0,0),n=br(0,1,0)}(),function(){var e=Ur(),t=Ur()}(),function(){var e=oe()}(),{ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2}),Hr={ObjectType:Kr};function Xr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xr(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yr=Hr.ObjectType,Zr={};function $r(e,t){function n(e){switch(e){case Yr.ELEMENT_ARRAY_BUFFER:return t.context.ELEMENT_ARRAY_BUFFER;case Yr.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in t.context)return t.context.TEXTURE_BUFFER;case Yr.ARRAY_BUFFER:default:return t.context.ARRAY_BUFFER}}t.classHierarchy.push("vtkOpenGLBufferObject");var r=null,a=null,o=!0,i="";e.getType=function(){return r},e.setType=function(e){r=e},e.getHandle=function(){return a},e.isReady=function(){return!1===o},e.generateBuffer=function(e){var o=n(e);return null===a&&(a=t.context.createBuffer(),r=e),n(r)===o},e.upload=function(s,l){var c=e.generateBuffer(l);return c?(t.context.bindBuffer(n(r),a),t.context.bufferData(n(r),s,t.context.STATIC_DRAW),o=!1,!0):(i="Trying to upload array buffer to incompatible buffer.",!1)},e.bind=function(){return!!a&&(t.context.bindBuffer(n(r),a),!0)},e.release=function(){return!!a&&(t.context.bindBuffer(n(r),null),!0)},e.releaseGraphicsResources=function(){null!==a&&(t.context.bindBuffer(n(r),null),t.context.deleteBuffer(a),a=null)},e.setOpenGLRenderWindow=function(n){t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.getError=function(){return i}}var Jr={objectType:Yr.ARRAY_BUFFER,context:null};function Qr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Jr,n),nn.obj(e,t),nn.get(e,t,["_openGLRenderWindow"]),nn.moveToProtected(e,t,["openGLRenderWindow"]),$r(e,t)}var ea=nn.newInstance(Qr),ta=qr(qr({newInstance:ea,extend:Qr},Zr),Hr),na={FLAT:0,GOURAUD:1,PHONG:2},ra={POINTS:0,WIREFRAME:1,SURFACE:2},aa=na,oa={Shading:na,Representation:ra,Interpolation:aa},ia=nn.vtkErrorMacro;function sa(e,t){var n=new Float64Array(3);Ar(n,t);var r=new Float64Array(16);return ne(r,Ur(),e,n),r}function la(e,t){return null!==e&&null!==t&&!(Rr(e,[0,0,0])&&Rr(t,[1,1,1]))}function ca(e,t){t.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),e.setType(Kr.ARRAY_BUFFER),e.createVBO=function(n,r,a,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!n.getData()||!n.getData().length)return t.elementCount=0,0;t.blockSize=3,t.vertexOffset=0,t.normalOffset=0,t.tCoordOffset=0,t.tCoordComponents=0,t.colorComponents=0,t.colorOffset=0,t.customData=[];var s=o.points.getData(),l=null,c=null,u=null,f=o.colors?o.colors.getNumberOfComponents():0,d=o.tcoords?o.tcoords.getNumberOfComponents():0;o.normals&&(t.normalOffset=4*t.blockSize,t.blockSize+=3,l=o.normals.getData()),o.customAttributes&&o.customAttributes.forEach((function(e){e&&(t.customData.push({data:e.getData(),offset:4*t.blockSize,components:e.getNumberOfComponents(),name:e.getName()}),t.blockSize+=e.getNumberOfComponents())})),o.tcoords&&(t.tCoordOffset=4*t.blockSize,t.tCoordComponents=d,t.blockSize+=d,c=o.tcoords.getData()),o.colors?(t.colorComponents=o.colors.getNumberOfComponents(),t.colorOffset=0,u=o.colors.getData(),t.colorBO||(t.colorBO=ta.newInstance()),t.colorBO.setOpenGLRenderWindow(t._openGLRenderWindow)):t.colorBO=null,t.stride=4*t.blockSize;var p,m=0,g=0,v=0,h=0,y=0,b=0,x={anythingToPoints:function(e,t,n){for(var r=0;r<e;++r)p(t[n+r])},linesToWireframe:function(e,t,n){for(var r=0;r<e-1;++r)p(t[n+r]),p(t[n+r+1])},polysToWireframe:function(e,t,n){if(e>2)for(var r=0;r<e;++r)p(t[n+r]),p(t[n+(r+1)%e])},stripsToWireframe:function(e,t,n){if(e>2){for(var r=0;r<e-1;++r)p(t[n+r]),p(t[n+r+1]);for(var a=0;a<e-2;a++)p(t[n+a]),p(t[n+a+2])}},polysToSurface:function(e,t,n){for(var r=0;r<e-2;r++)p(t[n+0]),p(t[n+r+1]),p(t[n+r+2])},stripsToSurface:function(e,t,n){for(var r=0;r<e-2;r++)p(t[n+r]),p(t[n+r+1+r%2]),p(t[n+r+1+(r+1)%2])}},T={anythingToPoints:function(e,t){return e},linesToWireframe:function(e,t){return e>1?2*(e-1):0},polysToWireframe:function(e,t){return e>2?2*e:0},stripsToWireframe:function(e,t){return e>2?4*e-6:0},polysToSurface:function(e,t){return e>2?3*(e-2):0},stripsToSurface:function(e,t,n){return e>2?3*(e-2):0}},S=null,O=null;a===ra.POINTS||"verts"===r?(S=x.anythingToPoints,O=T.anythingToPoints):a===ra.WIREFRAME||"lines"===r?(S=x["".concat(r,"ToWireframe")],O=T["".concat(r,"ToWireframe")]):(S=x["".concat(r,"ToSurface")],O=T["".concat(r,"ToSurface")]);for(var w=n.getData(),A=w.length,P=0,I=0;I<A;)P+=O(w[I],w),I+=w[I]+1;var C=null,E=new Float32Array(P*t.blockSize);u&&(C=new Uint8Array(4*P));for(var M=0,R=0,D=0,k=0,L=0;L<3;++L){var B=o.points.getRange(L),V=B[1]-B[0];D+=V*V;var F=.5*(B[1]+B[0]);k+=F*F}var N=D>0&&(Math.abs(k)/D>1e6||Math.abs(Math.log10(D))>3||0===D&&k>1e6);if(N){for(var U=new Float64Array(3),_=new Float64Array(3),G=0;G<3;++G){var z=o.points.getRange(G),j=z[1]-z[0];U[G]=.5*(z[1]+z[0]),_[G]=j>0?1/j:1}e.setCoordShiftAndScale(U,_)}else!0===t.coordShiftAndScaleEnabled&&e.setCoordShiftAndScale(null,null);if(i)if(i.points||i.cells){var W=new Int32Array(P+i.points.length);W.set(i.points),i.points=W;var K=new Int32Array(P+i.cells.length);K.set(i.cells),i.cells=K}else i.points=new Int32Array(P),i.cells=new Int32Array(P);var H=o.vertexOffset;p=function(e){if(i&&(i.points[H]=e,i.cells[H]=b+o.cellOffset),++H,m=3*e,t.coordShiftAndScaleEnabled?(E[M++]=(s[m++]-t.coordShift[0])*t.coordScale[0],E[M++]=(s[m++]-t.coordShift[1])*t.coordScale[1],E[M++]=(s[m++]-t.coordShift[2])*t.coordScale[2]):(E[M++]=s[m++],E[M++]=s[m++],E[M++]=s[m++]),null!==l&&(g=o.haveCellNormals?3*(b+o.cellOffset):3*e,E[M++]=l[g++],E[M++]=l[g++],E[M++]=l[g++]),t.customData.forEach((function(t){y=e*t.components;for(var n=0;n<t.components;++n)E[M++]=t.data[y++]})),null!==c){v=e*d;for(var n=0;n<d;++n)E[M++]=c[v++]}null!==u&&(h=o.haveCellScalars?(b+o.cellOffset)*f:e*f,C[R++]=u[h++],C[R++]=u[h++],C[R++]=u[h++],C[R++]=4===f?u[h++]:255)};for(var X=0;X<A;)S(w[X],w,X+1),X+=w[X]+1,b++;return t.elementCount=P,e.upload(E,Kr.ARRAY_BUFFER),t.colorBO&&(t.colorBOStride=4,t.colorBO.upload(C,Kr.ARRAY_BUFFER)),b},e.setCoordShiftAndScale=function(e,n){null===e||e.constructor===Float64Array&&3===e.length?null===n||n.constructor===Float64Array&&3===n.length?(null!==t.coordShift&&null!==e&&Dr(e,t.coordShift)||(t.coordShift=e),null!==t.coordScale&&null!==n&&Dr(n,t.coordScale)||(t.coordScale=n),t.coordShiftAndScaleEnabled=la(t.coordShift,t.coordScale),t.coordShiftAndScaleEnabled?t.inverseShiftAndScaleMatrix=sa(t.coordShift,t.coordScale):t.inverseShiftAndScaleMatrix=null):ia("Wrong type for coordScale, expected vec3 or null"):ia("Wrong type for coordShift, expected vec3 or null")}}var ua={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function fa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ua,n),ta.extend(e,t,n),nn.setGet(e,t,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),nn.get(e,t,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),ca(e,t)}var da=nn.newInstance(fa),pa={newInstance:da,extend:fa},ma=nn.vtkErrorMacro;function ga(e,t){t.classHierarchy.push("vtkShader"),e.compile=function(){var e=t.context.VERTEX_SHADER;if(!t.source||!t.source.length||"Unknown"===t.shaderType)return!1;switch(0!==t.handle&&(t.context.deleteShader(t.handle),t.handle=0),t.shaderType){case"Fragment":e=t.context.FRAGMENT_SHADER;break;case"Vertex":default:e=t.context.VERTEX_SHADER;break}t.handle=t.context.createShader(e),t.context.shaderSource(t.handle,t.source),t.context.compileShader(t.handle);var n=t.context.getShaderParameter(t.handle,t.context.COMPILE_STATUS);if(!n){var r=t.context.getShaderInfoLog(t.handle);return ma("Error compiling shader '".concat(t.source,"': ").concat(r)),t.context.deleteShader(t.handle),t.handle=0,!1}return!0},e.cleanup=function(){"Unknown"!==t.shaderType&&0!==t.handle&&(t.context.deleteShader(t.handle),t.handle=0,t.dirty=!0)}}var va={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function ha(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,va,n),nn.obj(e,t),nn.setGet(e,t,["shaderType","source","error","handle","context"]),ga(e,t)}var ya=nn.newInstance(ha,"vtkShader"),ba={newInstance:ya,extend:ha},xa=nn.vtkErrorMacro;function Ta(e,t,n,r){var a="string"===typeof n?n:n.join("\n"),o=!1===r?t:new RegExp(t,"g"),i=e.replace(o,a);return{replace:i!==a,result:i}}function Sa(e,t){t.classHierarchy.push("vtkShaderProgram"),e.compileShader=function(){return t.vertexShader.compile()?t.fragmentShader.compile()?e.attachShader(t.vertexShader)&&e.attachShader(t.fragmentShader)?e.link()?(e.setCompiled(!0),1):(xa("Links failed: ".concat(t.error)),0):(xa(t.error),0):(xa(t.fragmentShader.getSource().split("\n").map((function(e,t){return"".concat(t,": ").concat(e)})).join("\n")),xa(t.fragmentShader.getError()),0):(xa(t.vertexShader.getSource().split("\n").map((function(e,t){return"".concat(t,": ").concat(e)})).join("\n")),xa(t.vertexShader.getError()),0)},e.cleanup=function(){"Unknown"!==t.shaderType&&0!==t.handle&&(t.context.deleteShader(t.handle),t.handle=0)},e.bind=function(){return!(!t.linked&&!e.link())&&(t.context.useProgram(t.handle),e.setBound(!0),!0)},e.isBound=function(){return!!t.bound},e.release=function(){t.context.useProgram(null),e.setBound(!1)},e.setContext=function(e){t.vertexShader.setContext(e),t.fragmentShader.setContext(e),t.geometryShader.setContext(e)},e.link=function(){if(t.inked)return!0;if(0===t.handle)return t.error="Program has not been initialized, and/or does not have shaders.",!1;t.uniformLocs={},t.context.linkProgram(t.handle);var n=t.context.getProgramParameter(t.handle,t.context.LINK_STATUS);if(!n){var r=t.context.getProgramInfoLog(t.handle);return xa("Error linking shader ".concat(r)),t.handle=0,!1}return e.setLinked(!0),t.attributeLocs={},!0},e.setUniformMatrix=function(n,r){var a=e.findUniform(n);if(-1===a)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;var o=new Float32Array(r);return t.context.uniformMatrix4fv(a,!1,o),!0},e.setUniformMatrix3x3=function(n,r){var a=e.findUniform(n);if(-1===a)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;var o=new Float32Array(r);return t.context.uniformMatrix3fv(a,!1,o),!0},e.setUniformf=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform1f(a,r),!0)},e.setUniformfv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform1fv(a,r),!0)},e.setUniformi=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform1i(a,r),!0)},e.setUniformiv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform1iv(a,r),!0)},e.setUniform2f=function(n,r,a){var o=e.findUniform(n);if(-1===o)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(void 0===a)throw new RangeError("Invalid number of values for array");return t.context.uniform2f(o,r,a),!0},e.setUniform2fv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform2fv(a,r),!0)},e.setUniform2i=function(n,r,a){var o=e.findUniform(n);if(-1===o)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(void 0===a)throw new RangeError("Invalid number of values for array");return t.context.uniform2i(o,r,a),!0},e.setUniform2iv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform2iv(a,r),!0)},e.setUniform3f=function(n,r,a,o){var i=e.findUniform(n);if(-1===i)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(void 0===o)throw new RangeError("Invalid number of values for array");return t.context.uniform3f(i,r,a,o),!0},e.setUniform3fArray=function(n,r){var a=e.findUniform(n);if(-1===a)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;if(!Array.isArray(r)||3!==r.length)throw new RangeError("Invalid number of values for array");return t.context.uniform3f(a,r[0],r[1],r[2]),!0},e.setUniform3fv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform3fv(a,r),!0)},e.setUniform3i=function(n){var r=e.findUniform(n);if(-1===r)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];var s=o;if(1===s.length&&Array.isArray(s[0])&&(s=s[0]),3!==s.length)throw new RangeError("Invalid number of values for array");return t.context.uniform3i(r,s[0],s[1],s[2]),!0},e.setUniform3iv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform3iv(a,r),!0)},e.setUniform4f=function(n){var r=e.findUniform(n);if(-1===r)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];var s=o;if(1===s.length&&Array.isArray(s[0])&&(s=s[0]),4!==s.length)throw new RangeError("Invalid number of values for array");return t.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},e.setUniform4fv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform4fv(a,r),!0)},e.setUniform4i=function(n){var r=e.findUniform(n);if(-1===r)return t.error="Could not set uniform ".concat(n," . No such uniform."),!1;for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];var s=o;if(1===s.length&&Array.isArray(s[0])&&(s=s[0]),4!==s.length)throw new RangeError("Invalid number of values for array");return t.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},e.setUniform4iv=function(n,r){var a=e.findUniform(n);return-1===a?(t.error="Could not set uniform ".concat(n," . No such uniform."),!1):(t.context.uniform4iv(a,r),!0)},e.findUniform=function(e){if(!e||!t.linked)return-1;var n=t.uniformLocs[e];return void 0!==n?n:(n=t.context.getUniformLocation(t.handle,e),null===n?(t.error="Uniform ".concat(e," not found in current shader program."),t.uniformLocs[e]=-1,-1):(t.uniformLocs[e]=n,n))},e.isUniformUsed=function(e){if(!e)return!1;var n=t.uniformLocs[e];return void 0!==n?null!==n:t.linked?(n=t.context.getUniformLocation(t.handle,e),t.uniformLocs[e]=n,null!==n):(xa("attempt to find uniform when the shader program is not linked"),!1)},e.isAttributeUsed=function(e){if(!e)return!1;if(e in t.attributeLocs)return!0;if(!t.linked)return xa("attempt to find uniform when the shader program is not linked"),!1;var n=t.context.getAttribLocation(t.handle,e);return-1!==n&&(t.attributeLocs[e]=n,!0)},e.attachShader=function(n){if(0===n.getHandle())return t.error="Shader object was not initialized, cannot attach it.",!1;if("Unknown"===n.getShaderType())return t.error="Shader object is of type Unknown and cannot be used.",!1;if(0===t.handle){var r=t.context.createProgram();if(0===r)return t.error="Could not create shader program.",!1;t.handle=r,t.linked=!1}return"Vertex"===n.getShaderType()&&(0!==t.vertexShaderHandle&&t.comntext.detachShader(t.handle,t.vertexShaderHandle),t.vertexShaderHandle=n.getHandle()),"Fragment"===n.getShaderType()&&(0!==t.fragmentShaderHandle&&t.context.detachShader(t.handle,t.fragmentShaderHandle),t.fragmentShaderHandle=n.getHandle()),t.context.attachShader(t.handle,n.getHandle()),e.setLinked(!1),!0},e.detachShader=function(e){if(0===e.getHandle())return t.error="shader object was not initialized, cannot attach it.",!1;if("Unknown"===e.getShaderType())return t.error="Shader object is of type Unknown and cannot be used.",!1;switch(0===t.handle&&(t.error="This shader program has not been initialized yet."),e.getShaderType()){case"Vertex":return t.vertexShaderHandle!==e.getHandle()?(t.error="The supplied shader was not attached to this program.",!1):(t.context.detachShader(t.handle,e.getHandle()),t.vertexShaderHandle=0,t.linked=!1,!0);case"Fragment":return t.fragmentShaderHandle!==e.getHandle()?(t.error="The supplied shader was not attached to this program.",!1):(t.context.detachShader(t.handle,e.getHandle()),t.fragmentShaderHandle=0,t.linked=!1,!0);default:return!1}},e.setContext=function(e){t.context=e,t.vertexShader.setContext(e),t.fragmentShader.setContext(e),t.geometryShader.setContext(e)},e.setLastCameraMTime=function(e){t.lastCameraMTime=e}}var Oa={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function wa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Oa,n),t.attributesLocs={},t.uniformLocs={},t.vertexShader=ba.newInstance(),t.vertexShader.setShaderType("Vertex"),t.fragmentShader=ba.newInstance(),t.fragmentShader.setShaderType("Fragment"),t.geometryShader=ba.newInstance(),t.geometryShader.setShaderType("Geometry"),nn.obj(e,t),nn.get(e,t,["lastCameraMTime"]),nn.setGet(e,t,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Sa(e,t)}var Aa=nn.newInstance(wa,"vtkShaderProgram"),Pa={newInstance:Aa,extend:wa,substitute:Ta};function Ia(e,t){t.classHierarchy.push("vtkOpenGLVertexArrayObject"),e.exposedMethod=function(){},e.initialize=function(){t.instancingExtension=null,t._openGLRenderWindow.getWebgl2()||(t.instancingExtension=t.context.getExtension("ANGLE_instanced_arrays")),!t.forceEmulation&&t._openGLRenderWindow&&t._openGLRenderWindow.getWebgl2()?(t.extension=null,t.supported=!0,t.handleVAO=t.context.createVertexArray()):(t.extension=t.context.getExtension("OES_vertex_array_object"),!t.forceEmulation&&t.extension?(t.supported=!0,t.handleVAO=t.extension.createVertexArrayOES()):t.supported=!1)},e.isReady=function(){return 0!==t.handleVAO||!1===t.supported},e.bind=function(){if(e.isReady()||e.initialize(),e.isReady()&&t.supported)t.extension?t.extension.bindVertexArrayOES(t.handleVAO):t.context.bindVertexArray(t.handleVAO);else if(e.isReady())for(var n=t.context,r=0;r<t.buffers.length;++r){var a=t.buffers[r];t.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(var o=0;o<a.attributes.length;++o)for(var i=a.attributes[o],s=i.isMatrix?i.size:1,l=0;l<s;++l)n.enableVertexAttribArray(i.index+l),n.vertexAttribPointer(i.index+l,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*l/i.size),i.divisor>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(i.index+l,1):n.vertexAttribDivisor(i.index+l,1))}},e.release=function(){if(e.isReady()&&t.supported)t.extension?t.extension.bindVertexArrayOES(null):t.context.bindVertexArray(null);else if(e.isReady())for(var n=t.context,r=0;r<t.buffers.length;++r){var a=t.buffers[r];t.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(var o=0;o<a.attributes.length;++o)for(var i=a.attributes[o],s=i.isMatrix?i.size:1,l=0;l<s;++l)n.enableVertexAttribArray(i.index+l),n.vertexAttribPointer(i.index+l,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*l/i.size),i.divisor>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(i.index+l,0):n.vertexAttribDivisor(i.index+l,0)),n.disableVertexAttribArray(i.index+l)}},e.shaderProgramChanged=function(){e.release(),t.handleVAO&&(t.extension?t.extension.deleteVertexArrayOES(t.handleVAO):t.context.deleteVertexArray(t.handleVAO)),t.handleVAO=0,t.handleProgram=0},e.releaseGraphicsResources=function(){e.shaderProgramChanged(),t.handleVAO&&(t.extension?t.extension.deleteVertexArrayOES(t.handleVAO):t.context.deleteVertexArray(t.handleVAO)),t.handleVAO=0,t.supported=!0,t.handleProgram=0},e.addAttributeArray=function(t,n,r,a,o,i,s,l){return e.addAttributeArrayWithDivisor(t,n,r,a,o,i,s,l,0,!1)},e.addAttributeArrayWithDivisor=function(n,r,a,o,i,s,l,c,u,f){if(!n)return!1;if(!n.isBound()||0===r.getHandle()||r.getType()!==Kr.ARRAY_BUFFER)return!1;if(0===t.handleProgram&&(t.handleProgram=n.getHandle()),e.isReady()||e.initialize(),!e.isReady()||t.handleProgram!==n.getHandle())return!1;var d=t.context,p={};if(p.name=a,p.index=d.getAttribLocation(t.handleProgram,a),p.offset=o,p.stride=i,p.type=s,p.size=l,p.normalize=c,p.isMatrix=f,p.divisor=u,-1===p.Index)return!1;if(r.bind(),d.enableVertexAttribArray(p.index),d.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),u>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(p.index,1):d.vertexAttribDivisor(p.index,1)),p.buffer=r.getHandle(),!t.supported){for(var m=!1,g=0;g<t.buffers.length;++g){var v=t.buffers[g];if(v.buffer===p.buffer){m=!0;for(var h=!1,y=0;y<v.attributes.length;++y){var b=v.attributes[y];b.name===a&&(h=!0,v.attributes[y]=p)}h||v.attributes.push(p)}}m||t.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},e.addAttributeMatrixWithDivisor=function(n,r,a,o,i,s,l,c,u){var f=e.addAttributeArrayWithDivisor(n,r,a,o,i,s,l,c,u,!0);if(!f)return f;for(var d=t.context,p=d.getAttribLocation(t.handleProgram,a),m=1;m<l;m++)d.enableVertexAttribArray(p+m),d.vertexAttribPointer(p+m,l,s,c,i,o+i*m/l),u>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(p+m,1):d.vertexAttribDivisor(p+m,1));return!0},e.removeAttributeArray=function(n){if(!e.isReady()||0===t.handleProgram)return!1;if(!t.supported)for(var r=0;r<t.buffers.length;++r)for(var a=t.buffers[r],o=0;o<a.attributes.length;++o){var i=a.attributes[o];if(i.name===n)return a.attributes.splice(o,1),a.attributes.length||t.buffers.splice(r,1),!0}return!0},e.setOpenGLRenderWindow=function(n){t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))}}var Ca={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function Ea(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ca,n),t.buffers=[],nn.obj(e,t),nn.get(e,t,["supported"]),nn.setGet(e,t,["forceEmulation"]),Ia(e,t)}var Ma=nn.newInstance(Ea,"vtkOpenGLVertexArrayObject"),Ra={newInstance:Ma,extend:Ea},Da={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function ka(e,t){t.classHierarchy.push("vtkOpenGLHelper"),e.setOpenGLRenderWindow=function(e){t.context=e.getContext(),t.program.setContext(t.context),t.VAO.setOpenGLRenderWindow(e),t.CABO.setOpenGLRenderWindow(e)},e.releaseGraphicsResources=function(e){t.VAO.releaseGraphicsResources(),t.CABO.releaseGraphicsResources(),t.CABO.setElementCount(0)},e.drawArrays=function(n,r,a,o){if(t.CABO.getElementCount()){var i=e.getOpenGLMode(a),s=e.haveWideLines(n,r),l=t.context,c=l.getParameter(l.DEPTH_WRITEMASK);t.pointPicking&&l.depthMask(!1);var u=i===l.LINES;u&&s?(e.updateShaders(n,r,o),l.drawArraysInstanced(i,0,t.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(l.lineWidth(r.getProperty().getLineWidth()),e.updateShaders(n,r,o),l.drawArrays(i,0,t.CABO.getElementCount()),l.lineWidth(1));var f=(i===l.POINTS?1:0)||(i===l.LINES?2:3);return t.pointPicking&&l.depthMask(c),t.CABO.getElementCount()/f}return 0},e.getOpenGLMode=function(e){if(t.pointPicking)return t.context.POINTS;var n=t.primitiveType;return e===ra.POINTS||n===Da.Points?t.context.POINTS:e===ra.WIREFRAME||n===Da.Lines||n===Da.TrisEdges||n===Da.TriStripsEdges?t.context.LINES:t.context.TRIANGLES},e.haveWideLines=function(e,n){return n.getProperty().getLineWidth()>1&&!(t.CABO.getOpenGLRenderWindow()&&t.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth())},e.getNeedToRebuildShaders=function(t,n,r){return!!(r.getNeedToRebuildShaders(e,t,n)||0===e.getProgram()||e.getShaderSourceTime().getMTime()<r.getMTime()||e.getShaderSourceTime().getMTime()<n.getMTime())},e.updateShaders=function(n,r,a){if(e.getNeedToRebuildShaders(n,r,a)){var o={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(o,n,r);var i=t.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);i!==e.getProgram()&&(e.setProgram(i),e.getVAO().releaseGraphicsResources()),e.getShaderSourceTime().modified()}else t.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(e.getProgram());e.getVAO().bind(),a.setMapperShaderParameters(e,n,r),a.setPropertyShaderParameters(e,n,r),a.setCameraShaderParameters(e,n,r),a.setLightingShaderParameters(e,n,r),a.invokeShaderCallbacks(e,n,r)},e.setMapperShaderParameters=function(n,r,a){if(e.haveWideLines(n,r)){e.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);var o=parseFloat(r.getProperty().getLineWidth()),i=o/2;e.getProgram().setUniformf("lineWidthStepSize",o/Math.ceil(o)),e.getProgram().setUniformf("halfLineWidth",i)}t.primitiveType===Da.Points||r.getProperty().getRepresentation()===ra.POINTS?e.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):t.pointPicking&&e.getProgram().setUniformf("pointSize",e.getPointPickingPrimitiveSize())},e.replaceShaderPositionVC=function(n,r,a){var o=n.Vertex;o=Pa.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,o=Pa.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,e.getOpenGLMode(a.getProperty().getRepresentation())===t.context.LINES&&e.haveWideLines(r,a)&&(o=Pa.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,o=Pa.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=o},e.getPointPickingPrimitiveSize=function(){return t.primitiveType===Da.Points?2:t.primitiveType===Da.Lines?4:6}}var La={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function Ba(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,La,n),nn.obj(e,t),t.shaderSourceTime={},nn.obj(t.shaderSourceTime),t.attributeUpdateTime={},nn.obj(t.attributeUpdateTime),nn.setGet(e,t,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),t.program=Pa.newInstance(),t.VAO=Ra.newInstance(),t.CABO=pa.newInstance(),ka(e,t)}var Va=nn.newInstance(Ba),Fa={newInstance:Va,extend:Ba,primTypes:Da},Na={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Ua={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},_a={Wrap:Na,Filter:Ua},Ga=new Float32Array(1),za=new Int32Array(Ga.buffer);function ja(e){Ga[0]=e;var t=za[0],n=t>>16&32768,r=t>>12&2047,a=t>>23&255;return a<103?n:a>142?(n|=31744,n|=(255===a?0:1)&&8388607&t,n):a<113?(r|=2048,n|=(r>>114-a)+(r>>113-a&1),n):(n|=a-112<<10|r>>1,n+=1&r,n)}function Wa(e){var t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31===n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}var Ka={fromHalf:Wa,toHalf:ja};function Ha(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ha(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ha(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qa=_a.Wrap,Ya=_a.Filter,Za=vr.VtkDataTypes,$a=st,Ja=lt,Qa=ct;function eo(e,t){function n(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[],o=t.width*t.height*t.components;if(r&&(o*=t.depth),e!==Za.FLOAT&&t.openGLDataType===t.context.FLOAT)for(var i=0;i<n.length;i++)if(n[i]){var s=n[i].length>o?n[i].subarray(0,o):n[i];a.push(new Float32Array(s))}else a.push(null);if(e!==Za.UNSIGNED_CHAR&&t.openGLDataType===t.context.UNSIGNED_BYTE)for(var l=0;l<n.length;l++)if(n[l]){var c=n[l].length>o?n[l].subarray(0,o):n[l];a.push(new Uint8Array(c))}else a.push(null);var u=!1;if(t._openGLRenderWindow.getWebgl2())u=t.openGLDataType===t.context.HALF_FLOAT;else{var f=t.context.getExtension("OES_texture_half_float");u=f&&t.openGLDataType===f.HALF_FLOAT_OES}if(u)for(var d=0;d<n.length;d++)if(n[d]){for(var p=new Uint16Array(o),m=0;m<o;m++)p[m]=Ka.toHalf(n[d][m]);a.push(p)}else a.push(null);if(0===a.length)for(var g=0;g<n.length;g++)a.push(n[g]);return a}function r(e){if(t._openGLRenderWindow.getWebgl2())return e;var n=[],r=t.width,a=t.height,o=t.components;if(e&&(!zn(r)||!zn(a)))for(var i=t.context.getExtension("OES_texture_half_float"),s=Gn(r),l=Gn(a),c=s*l*t.components,u=0;u<e.length;u++)if(null!==e[u]){var f=null,d=a/l,p=r/s,m=!1;t.openGLDataType===t.context.FLOAT?f=new Float32Array(c):i&&t.openGLDataType===i.HALF_FLOAT_OES?(f=new Uint16Array(c),m=!0):f=new Uint8Array(c);for(var g=0;g<l;g++){var v=g*s*o,h=g*d,y=Math.floor(h),b=Math.ceil(h);b>=a&&(b=a-1);var x=h-y,T=1-x;y=y*r*o,b=b*r*o;for(var S=0;S<s;S++){var O=S*o,w=S*p,A=Math.floor(w),P=Math.ceil(w);P>=r&&(P=r-1);var I=w-A;A*=o,P*=o;for(var C=0;C<o;C++)f[v+O+C]=m?Ka.toHalf(Ka.fromHalf(e[u][y+A+C])*T*(1-I)+Ka.fromHalf(e[u][y+P+C])*T*I+Ka.fromHalf(e[u][b+A+C])*x*(1-I)+Ka.fromHalf(e[u][b+P+C])*x*I):e[u][y+A+C]*T*(1-I)+e[u][y+P+C]*T*I+e[u][b+A+C]*x*(1-I)+e[u][b+P+C]*x*I}}n.push(f),t.width=s,t.height=l}else n.push(null);if(0===n.length)for(var E=0;E<e.length;E++)n.push(e[E]);return n}function a(e){if(t._openGLRenderWindow){if(t.resizable)return!1;if(t._openGLRenderWindow.getWebgl2()){var n=t._openGLRenderWindow.getGLInformations();return!(n.RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&t.oglNorm16Ext)||e!==Za.UNSIGNED_SHORT&&e!==Za.SHORT}return!1}return!1}function o(e,t,n){for(var r=[],a=[],o=0;o<e;++o)r[o]=n[o],a[o]=n[o];for(var i=0,s=0;s<t;++s)for(var l=0;l<e;++l)n[i]<r[l]&&(r[l]=n[i]),n[i]>a[l]&&(a[l]=n[i]),i++;for(var c=[],u=[],f=0;f<e;++f)r[f]===a[f]&&(a[f]=r[f]+1),c[f]=r[f],u[f]=a[f]-r[f];return{scale:u,offset:c}}function i(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=t[n]+r;if(r<-2048||r>2048||a<-2048||a>2048)return!1}return!0}function s(n,r,a,o){e.getOpenGLDataType(n);var s=!1;if(t._openGLRenderWindow.getWebgl2())s=t.openGLDataType===t.context.HALF_FLOAT;else{var l=t.context.getExtension("OES_texture_half_float");s=l&&t.openGLDataType===l.HALF_FLOAT_OES}return!!s&&!(!i(r,a)&&!o)}t.classHierarchy.push("vtkOpenGLTexture"),e.render=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n?t._openGLRenderWindow=n:(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent()),t.context=t._openGLRenderWindow.getContext(),t.renderable.getInterpolate()?(t.generateMipmap?e.setMinificationFilter(Ya.LINEAR_MIPMAP_LINEAR):e.setMinificationFilter(Ya.LINEAR),e.setMagnificationFilter(Ya.LINEAR)):(e.setMinificationFilter(Ya.NEAREST),e.setMagnificationFilter(Ya.NEAREST)),t.renderable.getRepeat()&&(e.setWrapR(qa.REPEAT),e.setWrapS(qa.REPEAT),e.setWrapT(qa.REPEAT)),t.renderable.getInputData()&&t.renderable.setImage(null),!t.handle||t.renderable.getMTime()>t.textureBuildTime.getMTime()){if(null!==t.renderable.getImage()&&(t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(Ya.LINEAR_MIPMAP_LINEAR)),t.renderable.getImage()&&t.renderable.getImageLoaded()&&(e.create2DFromImage(t.renderable.getImage()),e.activate(),e.sendParameters(),t.textureBuildTime.modified())),null!==t.renderable.getCanvas()){t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(Ya.LINEAR_MIPMAP_LINEAR));var r=t.renderable.getCanvas();e.create2DFromRaw(r.width,r.height,4,Za.UNSIGNED_CHAR,r,!0),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}if(null!==t.renderable.getJsImageData()){var a=t.renderable.getJsImageData();t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(Ya.LINEAR_MIPMAP_LINEAR)),e.create2DFromRaw(a.width,a.height,4,Za.UNSIGNED_CHAR,a.data,!0),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}var o=t.renderable.getInputData(0);if(o&&o.getPointData().getScalars()){for(var i=o.getExtent(),s=o.getPointData().getScalars(),l=[],c=0;c<t.renderable.getNumberOfInputPorts();++c){var u=t.renderable.getInputData(c),f=u?u.getPointData().getScalars().getData():null;f&&l.push(f)}t.renderable.getInterpolate()&&4===s.getNumberOfComponents()&&(t.generateMipmap=!0,e.setMinificationFilter(Ya.LINEAR_MIPMAP_LINEAR)),l.length%6===0?e.createCubeFromRaw(i[1]-i[0]+1,i[3]-i[2]+1,s.getNumberOfComponents(),s.getDataType(),l):e.create2DFromRaw(i[1]-i[0]+1,i[3]-i[2]+1,s.getNumberOfComponents(),s.getDataType(),s.getData()),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}}t.handle&&e.activate()},e.destroyTexture=function(){e.deactivate(),t.context&&t.handle&&t.context.deleteTexture(t.handle),t.handle=0,t.numberOfDimensions=0,t.target=0,t.components=0,t.width=0,t.height=0,t.depth=0,e.resetFormatAndType()},e.createTexture=function(){t.handle||(t.handle=t.context.createTexture(),t.target&&(t.context.bindTexture(t.target,t.handle),t.context.texParameteri(t.target,t.context.TEXTURE_MIN_FILTER,e.getOpenGLFilterMode(t.minificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_MAG_FILTER,e.getOpenGLFilterMode(t.magnificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_S,e.getOpenGLWrapMode(t.wrapS)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_T,e.getOpenGLWrapMode(t.wrapT)),t._openGLRenderWindow.getWebgl2()&&t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_R,e.getOpenGLWrapMode(t.wrapR)),t.context.bindTexture(t.target,null)))},e.getTextureUnit=function(){return t._openGLRenderWindow?t._openGLRenderWindow.getTextureUnitForTexture(e):-1},e.activate=function(){t._openGLRenderWindow.activateTexture(e),e.bind()},e.deactivate=function(){t._openGLRenderWindow&&t._openGLRenderWindow.deactivateTexture(e)},e.releaseGraphicsResources=function(n){n&&t.handle&&(n.activateTexture(e),n.deactivateTexture(e),t.context.deleteTexture(t.handle),t.handle=0,t.numberOfDimensions=0,t.target=0,t.internalFormat=0,t.format=0,t.openGLDataType=0,t.components=0,t.width=0,t.height=0,t.depth=0),t.shaderProgram&&(t.shaderProgram.releaseGraphicsResources(n),t.shaderProgram=null)},e.bind=function(){t.context.bindTexture(t.target,t.handle),t.autoParameters&&e.getMTime()>t.sendParametersTime.getMTime()&&e.sendParameters()},e.isBound=function(){var e=!1;if(t.context&&t.handle){var n=0;switch(t.target){case t.context.TEXTURE_2D:n=t.context.TEXTURE_BINDING_2D;break;default:Qa("impossible case");break}var r=t.context.getIntegerv(n);e=r===t.handle}return e},e.sendParameters=function(){t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_S,e.getOpenGLWrapMode(t.wrapS)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_T,e.getOpenGLWrapMode(t.wrapT)),t._openGLRenderWindow.getWebgl2()&&t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_R,e.getOpenGLWrapMode(t.wrapR)),t.context.texParameteri(t.target,t.context.TEXTURE_MIN_FILTER,e.getOpenGLFilterMode(t.minificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_MAG_FILTER,e.getOpenGLFilterMode(t.magnificationFilter)),t._openGLRenderWindow.getWebgl2()&&(t.context.texParameteri(t.target,t.context.TEXTURE_BASE_LEVEL,t.baseLevel),t.context.texParameteri(t.target,t.context.TEXTURE_MAX_LEVEL,t.maxLevel)),t.sendParametersTime.modified()},e.getInternalFormat=function(n,r){return t._forceInternalFormat||(t.internalFormat=e.getDefaultInternalFormat(n,r)),t.internalFormat||$a("Unable to find suitable internal format for T=".concat(n," NC= ").concat(r)),t.internalFormat},e.getDefaultInternalFormat=function(e,n){var r=0;return r=t._openGLRenderWindow.getDefaultTextureInternalFormat(e,n,t.oglNorm16Ext,t.useHalfFloat),r||(r||($a("Unsupported internal texture type!"),$a("Unable to find suitable internal format for T=".concat(e," NC= ").concat(n))),r)},e.setInternalFormat=function(n){t._forceInternalFormat=!0,n!==t.internalFormat&&(t.internalFormat=n,e.modified())},e.getFormat=function(n,r){return t.format=e.getDefaultFormat(n,r),t.format},e.getDefaultFormat=function(e,n){if(t._openGLRenderWindow.getWebgl2())switch(n){case 1:return t.context.RED;case 2:return t.context.RG;case 3:return t.context.RGB;case 4:return t.context.RGBA;default:return t.context.RGB}else switch(n){case 1:return t.context.LUMINANCE;case 2:return t.context.LUMINANCE_ALPHA;case 3:return t.context.RGB;case 4:return t.context.RGBA;default:return t.context.RGB}},e.resetFormatAndType=function(){t.format=0,t.internalFormat=0,t._forceInternalFormat=!1,t.openGLDataType=0},e.getDefaultDataType=function(e){if(t._openGLRenderWindow.getWebgl2())switch(e){case Za.UNSIGNED_CHAR:return t.context.UNSIGNED_BYTE;case t.oglNorm16Ext&&!t.useHalfFloat&&Za.SHORT:return t.context.SHORT;case t.oglNorm16Ext&&!t.useHalfFloat&&Za.UNSIGNED_SHORT:return t.context.UNSIGNED_SHORT;case t.useHalfFloat&&Za.SHORT:return t.context.HALF_FLOAT;case t.useHalfFloat&&Za.UNSIGNED_SHORT:return t.context.HALF_FLOAT;case Za.FLOAT:case Za.VOID:default:return t.context.FLOAT}switch(e){case Za.UNSIGNED_CHAR:return t.context.UNSIGNED_BYTE;case Za.FLOAT:case Za.VOID:default:if(t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear"))return t.context.FLOAT;var n=t.context.getExtension("OES_texture_half_float");return n&&t.context.getExtension("OES_texture_half_float_linear")?n.HALF_FLOAT_OES:t.context.UNSIGNED_BYTE}},e.getOpenGLDataType=function(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.openGLDataType&&!r||(t.openGLDataType=e.getDefaultDataType(n)),t.openGLDataType},e.getShiftAndScale=function(){var e=0,n=1;switch(t.openGLDataType){case t.context.BYTE:n=127.5,e=n-128;break;case t.context.UNSIGNED_BYTE:n=255,e=0;break;case t.context.SHORT:n=32767.5,e=n-32768;break;case t.context.UNSIGNED_SHORT:n=65536,e=0;break;case t.context.INT:n=2147483647.5,e=n-2147483648;break;case t.context.UNSIGNED_INT:n=4294967295,e=0;break;case t.context.FLOAT:}return{shift:e,scale:n}},e.getOpenGLFilterMode=function(e){switch(e){case Ya.NEAREST:return t.context.NEAREST;case Ya.LINEAR:return t.context.LINEAR;case Ya.NEAREST_MIPMAP_NEAREST:return t.context.NEAREST_MIPMAP_NEAREST;case Ya.NEAREST_MIPMAP_LINEAR:return t.context.NEAREST_MIPMAP_LINEAR;case Ya.LINEAR_MIPMAP_NEAREST:return t.context.LINEAR_MIPMAP_NEAREST;case Ya.LINEAR_MIPMAP_LINEAR:return t.context.LINEAR_MIPMAP_LINEAR;default:return t.context.NEAREST}},e.getOpenGLWrapMode=function(e){switch(e){case qa.CLAMP_TO_EDGE:return t.context.CLAMP_TO_EDGE;case qa.REPEAT:return t.context.REPEAT;case qa.MIRRORED_REPEAT:return t.context.MIRRORED_REPEAT;default:return t.context.CLAMP_TO_EDGE}},e.create2DFromRaw=function(o,i,s,l,c){var u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e.getOpenGLDataType(l,!0),e.getInternalFormat(l,s),e.getFormat(l,s),!t.internalFormat||!t.format||!t.openGLDataType)return Ja("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=s,t.width=o,t.height=i,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind();var f=[c],d=n(l,f),p=r(d);return t.context.pixelStorei(t.context.UNPACK_FLIP_Y_WEBGL,u),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),a(l)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=p[0]&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,p[0])):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,p[0]),t.generateMipmap&&t.context.generateMipmap(t.target),u&&t.context.pixelStorei(t.context.UNPACK_FLIP_Y_WEBGL,!1),e.deactivate(),!0},e.createCubeFromRaw=function(o,i,s,l,c){if(e.getOpenGLDataType(l),e.getInternalFormat(l,s),e.getFormat(l,s),!t.internalFormat||!t.format||!t.openGLDataType)return Ja("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_CUBE_MAP,t.components=s,t.width=o,t.height=i,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),t.maxLevel=c.length/6-1,e.createTexture(),e.bind();for(var u=n(l,c),f=r(u),d=[],p=t.width,m=t.height,g=0;g<f.length;g++){g%6===0&&0!==g&&(p/=2,m/=2),d[g]=pt(l,m*p*t.components);for(var v=0;v<m;++v){var h=v*p*t.components,y=(m-v-1)*p*t.components;d[g].set(f[g].slice(y,y+p*t.components),h)}}t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),a(l)&&t.context.texStorage2D(t.target,6,t.internalFormat,t.width,t.height);for(var b=0;b<6;b++){var x=0,T=t.width,S=t.height;while(T>=1&&S>=1){var O=null;x<=t.maxLevel&&(O=d[6*x+b]),t._openGLRenderWindow.getWebgl2()&&!t.resizable?null!=O&&t.context.texSubImage2D(t.context.TEXTURE_CUBE_MAP_POSITIVE_X+b,x,0,0,T,S,t.format,t.openGLDataType,O):t.context.texImage2D(t.context.TEXTURE_CUBE_MAP_POSITIVE_X+b,x,t.internalFormat,T,S,0,t.format,t.openGLDataType,O),x++,T/=2,S/=2}}return e.deactivate(),!0},e.createDepthFromRaw=function(n,r,o,i){return e.getOpenGLDataType(o),t.format=t.context.DEPTH_COMPONENT,t._openGLRenderWindow.getWebgl2()?o===Za.FLOAT?t.internalFormat=t.context.DEPTH_COMPONENT32F:t.internalFormat=t.context.DEPTH_COMPONENT16:t.internalFormat=t.context.DEPTH_COMPONENT,t.internalFormat&&t.format&&t.openGLDataType?(t.target=t.context.TEXTURE_2D,t.components=1,t.width=n,t.height=r,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),a(o)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=i&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,i)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,i),t.generateMipmap&&t.context.generateMipmap(t.target),e.deactivate(),!0):(Ja("Failed to determine texture parameters."),!1)},e.create2DFromImage=function(n){if(e.getOpenGLDataType(Za.UNSIGNED_CHAR),e.getInternalFormat(Za.UNSIGNED_CHAR,4),e.getFormat(Za.UNSIGNED_CHAR,4),!t.internalFormat||!t.format||!t.openGLDataType)return Ja("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=4,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1);var r=!t._openGLRenderWindow.getWebgl2()&&(!zn(n.width)||!zn(n.height)),o=document.createElement("canvas");o.width=r?Gn(n.width):n.width,o.height=r?Gn(n.height):n.height,t.width=o.width,t.height=o.height;var i=o.getContext("2d");i.translate(0,o.height),i.scale(1,-1),i.drawImage(n,0,0,n.width,n.height,0,0,o.width,o.height);var s=o;return a(Za.UNSIGNED_CHAR)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=s&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,s)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,s),t.generateMipmap&&t.context.generateMipmap(t.target),e.deactivate(),!0},e.create3DFromRaw=function(o,i,s,l,c,u){if(e.getOpenGLDataType(c),e.getInternalFormat(c,l),e.getFormat(c,l),!t.internalFormat||!t.format||!t.openGLDataType)return Ja("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_3D,t.components=l,t.width=o,t.height=i,t.depth=s,t.numberOfDimensions=3,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind();var f=[u],d=!0,p=n(c,f,d),m=r(p);return a(c)?(t.context.texStorage3D(t.target,1,t.internalFormat,t.width,t.height,t.depth),null!=m[0]&&t.context.texSubImage3D(t.target,0,0,0,0,t.width,t.height,t.depth,t.format,t.openGLDataType,m[0])):t.context.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.openGLDataType,m[0]),t.generateMipmap&&t.context.generateMipmap(t.target),e.deactivate(),!0},e.create3DFilterableFromRaw=function(n,r,i,l,c,u){for(var f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=n*r*i,p=[],m=[],g=0;g<l;++g)p[g]=0,m[g]=1;t.volumeInfo={scale:m,offset:p,width:n,height:r,depth:i};var v=o(l,d,u),h=v.offset,y=v.scale;if(t.volumeInfo.dataComputedScale=y,t.volumeInfo.dataComputedOffset=h,t.useHalfFloat=s(c,h,y,f),t.useHalfFloat||e.getOpenGLDataType(c,!0),t._openGLRenderWindow.getWebgl2()){if(t.oglNorm16Ext&&!t.useHalfFloat&&c===Za.SHORT){for(var b=0;b<l;++b)t.volumeInfo.scale[b]=32767;return e.create3DFromRaw(n,r,i,l,c,u)}if(t.oglNorm16Ext&&!t.useHalfFloat&&c===Za.UNSIGNED_SHORT){for(var x=0;x<l;++x)t.volumeInfo.scale[x]=65535;return e.create3DFromRaw(n,r,i,l,c,u)}if(c===Za.FLOAT||t.useHalfFloat&&(c===Za.SHORT||c===Za.UNSIGNED_SHORT))return e.create3DFromRaw(n,r,i,l,c,u);if(c===Za.UNSIGNED_CHAR){for(var T=0;T<l;++T)t.volumeInfo.scale[T]=255;return e.create3DFromRaw(n,r,i,l,c,u)}var S=new Float32Array(d*l);t.volumeInfo.offset=h,t.volumeInfo.scale=y;for(var O=0,w=y.map((function(e){return 1/e})),A=0;A<d;A++)for(var P=0;P<l;P++)S[O]=(u[O]-h[P])*w[P],O++;return e.create3DFromRaw(n,r,i,l,Za.FLOAT,S)}var I=o(l,d,u),C=function(e,t,n,r,a){e[t]=n},E=Za.UNSIGNED_CHAR;if(c===Za.UNSIGNED_CHAR)for(var M=0;M<l;++M)I.offset[M]=0,I.scale[M]=255;else t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear")?(E=Za.FLOAT,C=function(e,t,n,r,a){e[t]=(n-r)/a}):(E=Za.UNSIGNED_CHAR,C=function(e,t,n,r,a){e[t]=255*(n-r)/a});if(e.getOpenGLDataType(E),e.getInternalFormat(E,l),e.getFormat(E,l),!t.internalFormat||!t.format||!t.openGLDataType)return Ja("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=l,t.depth=1,t.numberOfDimensions=2;var R=t.context.getParameter(t.context.MAX_TEXTURE_SIZE);R>4096&&(E===Za.FLOAT||l>=3)&&(R=4096);var D=1,k=1;d>R*R&&(D=Math.ceil(Math.sqrt(d/(R*R))),k=D);var L=Math.sqrt(d)/D;L=Gn(L);var B,V=Math.floor(L*D/n),F=Math.ceil(i/V),N=Gn(r*F/k);t.width=L,t.height=N,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.volumeInfo.xreps=V,t.volumeInfo.yreps=F,t.volumeInfo.xstride=D,t.volumeInfo.ystride=k,t.volumeInfo.offset=I.offset,t.volumeInfo.scale=I.scale;var U=L*N*l;B=E===Za.FLOAT?new Float32Array(U):new Uint8Array(U);for(var _=0,G=Math.floor(n/D),z=Math.floor(r/k),j=0;j<F;j++)for(var W=Math.min(V,i-j*V),K=l*(t.width-W*Math.floor(n/D)),H=0;H<z;H++){for(var X=0;X<W;X++)for(var q=l*((j*V+X)*n*r+k*H*n),Y=0;Y<G;Y++)for(var Z=0;Z<l;Z++)C(B,_,u[q+D*Y*l+Z],I.offset[Z],I.scale[Z]),_++;_+=K}return t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),a(E)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=B&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,B)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,B),e.deactivate(),!0},e.setOpenGLRenderWindow=function(n){t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.getMaximumTextureSize=function(e){return e&&e.isCurrent()?e.getIntegerv(e.MAX_TEXTURE_SIZE):-1}}var to={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:qa.CLAMP_TO_EDGE,wrapT:qa.CLAMP_TO_EDGE,wrapR:qa.CLAMP_TO_EDGE,minificationFilter:Ya.NEAREST,magnificationFilter:Ya.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,useHalfFloat:!0,oglNorm16Ext:null};function no(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,to,n),un.extend(e,t,n),t.sendParametersTime={},Pt(t.sendParametersTime,{mtime:0}),t.textureBuildTime={},Pt(t.textureBuildTime,{mtime:0}),Rt(e,t,["format","openGLDataType"]),Dt(e,t,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Ct(e,t,["width","height","volumeInfo","components","handle","target"]),Vt(e,t,["openGLRenderWindow"]),eo(e,t)}var ro=_t(no,"vtkOpenGLTexture"),ao=Xa({newInstance:ro,extend:no},_a);hn("vtkTexture",ro);var oo={NEAREST:0,LINEAR:1},io={InterpolationType:oo},so="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyDataVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\nattribute vec4 vertexMC;\n\n// frag position in VC\n//VTK::PositionVC::Dec\n\n// optional normal declaration\n//VTK::Normal::Dec\n\n// extra lighting parameters\n//VTK::Light::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// material property values\n//VTK::Color::Dec\n\n// clipping plane vars\n//VTK::Clip::Dec\n\n// camera and actor matrix values\n//VTK::Camera::Dec\n\n// Apple Bug\n//VTK::PrimID::Dec\n\n// picking support\n//VTK::Picking::Dec\n\nvoid main()\n{\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Clip::Impl\n\n  //VTK::PrimID::Impl\n\n  //VTK::PositionVC::Impl\n\n  //VTK::Light::Impl\n\n  //VTK::Picking::Impl\n}\n",lo="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyDataFS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// Template for the polydata mappers fragment shader\n\nuniform int PrimitiveIDOffset;\n\n// VC position of this fragment\n//VTK::PositionVC::Dec\n\n// optional color passed in from the vertex shader, vertexColor\n//VTK::Color::Dec\n\n// optional surface normal declaration\n//VTK::Normal::Dec\n\n// extra lighting parameters\n//VTK::Light::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// picking support\n//VTK::Picking::Dec\n\n// Depth Peeling Support\n//VTK::DepthPeeling::Dec\n\n// clipping plane vars\n//VTK::Clip::Dec\n\n// the output of this shader\n//VTK::Output::Dec\n\n// Apple Bug\n//VTK::PrimID::Dec\n\n// handle coincident offsets\n//VTK::Coincident::Dec\n\n//VTK::ZBuffer::Dec\n\nvoid main()\n{\n  // VC position of this fragment. This should not branch/return/discard.\n  //VTK::PositionVC::Impl\n\n  // Place any calls that require uniform flow (e.g. dFdx) here.\n  //VTK::UniformFlow::Impl\n\n  // Set gl_FragDepth here (gl_FragCoord.z by default)\n  //VTK::Depth::Impl\n\n  // Early depth peeling abort:\n  //VTK::DepthPeeling::PreColor\n\n  // Apple Bug\n  //VTK::PrimID::Impl\n\n  //VTK::Clip::Impl\n\n  //VTK::Color::Impl\n\n  // Generate the normal if we are not passed in one\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Light::Impl\n\n  if (gl_FragData[0].a <= 0.0)\n    {\n    discard;\n    }\n\n  //VTK::DepthPeeling::Impl\n\n  //VTK::Picking::Impl\n\n  // handle coincident offsets\n  //VTK::Coincident::Impl\n\n  //VTK::ZBuffer::Impl\n\n  //VTK::RenderPassFragmentShader::Impl\n}\n";function co(e,t){e.replaceShaderCoincidentOffset=function(n,r,a){var o=e.getCoincidentParameters(r,a);if(o&&(0!==o.factor||0!==o.offset)){var i=n.Fragment;i=Pa.substitute(i,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,t.context.getExtension("EXT_frag_depth")&&(0!==o.factor?(i=Pa.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=Pa.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=Pa.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),t._openGLRenderWindow.getWebgl2()&&(0!==o.factor?(i=Pa.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=Pa.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=Pa.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=i}}}var uo={implementReplaceShaderCoincidentOffset:co},fo=lt,po=Rn.SlicingMode;function mo(e,t,n){var r=t.apply(e);if(r){var a=e.getIndependentComponents();return"".concat(e.getMTime(),"-").concat(a,"-").concat(n)}return"0"}function go(e,t){t.classHierarchy.push("vtkOpenGLImageMapper"),e.buildPass=function(n){if(n){t.currentRenderPass=null,t.openGLImageSlice=e.getFirstAncestorOfType("vtkOpenGLImageSlice"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext(),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow),t.openGLTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.colorTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.pwfTexture.setOpenGLRenderWindow(t._openGLRenderWindow);var r=t._openGLRenderer.getRenderable();t.openGLCamera=t._openGLRenderer.getViewNodeFor(r.getActiveCamera()),t.renderable.isA("vtkImageMapper")&&t.renderable.getSliceAtFocalPoint()&&t.renderable.setSliceFromCamera(r.getActiveCamera())}},e.translucentPass=function(n,r){n&&(t.currentRenderPass=r,e.render())},e.zBufferPass=function(n){n&&(t.haveSeenDepthRequest=!0,t.renderDepth=!0,e.render(),t.renderDepth=!1)},e.opaqueZBufferPass=function(t){return e.zBufferPass(t)},e.opaquePass=function(t){t&&e.render()},e.getCoincidentParameters=function(e,n){return t.renderable.getResolveCoincidentTopology()?t.renderable.getCoincidentTopologyPolygonOffsetParameters():null},e.render=function(){var n=t.openGLImageSlice.getRenderable(),r=t._openGLRenderer.getRenderable();e.renderPiece(r,n)},e.buildShaders=function(n,r,a){e.getShaderTemplate(n,r,a),t.lastRenderPassShaderReplacement=t.currentRenderPass?t.currentRenderPass.getShaderReplacement():null,t.lastRenderPassShaderReplacement&&t.lastRenderPassShaderReplacement(n),e.replaceShaderValues(n,r,a)},e.getShaderTemplate=function(e,t,n){e.Vertex=so,e.Fragment=lo,e.Geometry=""},e.replaceShaderValues=function(n,r,a){var o=n.Vertex,i=n.Fragment;o=Pa.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=Pa.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,o=Pa.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,o=Pa.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;var s=t.openGLTexture.getComponents(),l=a.getProperty().getIndependentComponents(),c=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(l){for(var u=1;u<s;u++)c=c.concat(["uniform float cshift".concat(u,";"),"uniform float cscale".concat(u,";"),"uniform float pwfshift".concat(u,";"),"uniform float pwfscale".concat(u,";")]);switch(s){case 1:c=c.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:c=c.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:fo("Unsupported number of independent coordinates.")}}if(i=Pa.substitute(i,"//VTK::TCoord::Dec",c).result,l){for(var f=["r","g","b","a"],d=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"],p=0;p<s;p++)d=d.concat(["vec3 tcolor".concat(p," = mix").concat(p," * texture2D(colorTexture1, vec2(tvalue.").concat(f[p]," * cscale").concat(p," + cshift").concat(p,", height").concat(p,")).rgb;"),"float compWeight".concat(p," = mix").concat(p," * texture2D(pwfTexture1, vec2(tvalue.").concat(f[p]," * pwfscale").concat(p," + pwfshift").concat(p,", height").concat(p,")).r;")]);switch(s){case 1:d=d.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:d=d.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:fo("Unsupported number of independent coordinates.")}i=Pa.substitute(i,"//VTK::TCoord::Impl",d).result}else switch(s){case 1:i=Pa.substitute(i,"//VTK::TCoord::Impl",["float intensity = texture2D(texture1, tcoordVCVSOutput).r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]).result;break;case 2:i=Pa.substitute(i,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:i=Pa.substitute(i,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:i=Pa.substitute(i,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}t.haveSeenDepthRequest&&(i=Pa.substitute(i,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,i=Pa.substitute(i,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=o,n.Fragment=i,e.replaceShaderClip(n,r,a),e.replaceShaderCoincidentOffset(n,r,a)},e.replaceShaderClip=function(e,n,r){var a=e.Vertex,o=e.Fragment;if(t.renderable.getNumberOfClippingPlanes()){var i=t.renderable.getNumberOfClippingPlanes();i>6&&(lt("OpenGL has a limit of 6 clipping planes"),i=6),a=Pa.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Pa.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=Pa.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=Pa.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}e.Vertex=a,e.Fragment=o},e.getNeedToRebuildShaders=function(e,n,r){var a=t.openGLTexture.getComponents(),o=r.getProperty().getIndependentComponents(),i=!1;return(!t.currentRenderPass&&t.lastRenderPassShaderReplacement||t.currentRenderPass&&t.currentRenderPass.getShaderReplacement()!==t.lastRenderPassShaderReplacement)&&(i=!0),!(!i&&t.lastHaveSeenDepthRequest===t.haveSeenDepthRequest&&0!==e.getProgram()&&t.lastTextureComponents===a&&t.lastIndependentComponents===o)&&(t.lastHaveSeenDepthRequest=t.haveSeenDepthRequest,t.lastTextureComponents=a,t.lastIndependentComponents=o,!0)},e.updateShaders=function(n,r,a){if(t.lastBoundBO=n,e.getNeedToRebuildShaders(n,r,a)){var o={Vertex:null,Fragment:null,Geometry:null};e.buildShaders(o,r,a);var i=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);i!==n.getProgram()&&(n.setProgram(i),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),e.setMapperShaderParameters(n,r,a),e.setCameraShaderParameters(n,r,a),e.setPropertyShaderParameters(n,r,a)},e.setMapperShaderParameters=function(n,r,a){n.getCABO().getElementCount()&&(t.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||fo("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),t.context.FLOAT,n.getCABO().getTCoordComponents(),t.context.FALSE)||fo("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());var o=t.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",o);var i=t.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();if(s)for(var l=0;l<i;l++)n.getProgram().setUniformf("mix".concat(l),a.getProperty().getComponentWeight(l));for(var c=t.openGLTexture.getShiftAndScale(),u=0;u<i;u++){var f=a.getProperty().getColorWindow(),d=a.getProperty().getColorLevel(),p=s?u:0,m=a.getProperty().getRGBTransferFunction(p);if(m&&a.getProperty().getUseLookupTableScalarRange()){var g=m.getRange();f=g[1]-g[0],d=.5*(g[1]+g[0])}var v=c.scale/f,h=(c.shift-d)/f+.5;n.getProgram().setUniformf("cshift".concat(u),h),n.getProgram().setUniformf("cscale".concat(u),v)}for(var y=0;y<i;y++){var b=1,x=0,T=s?y:0,S=a.getProperty().getPiecewiseFunction(T);if(S){var O=S.getRange(),w=O[1]-O[0],A=.5*(O[0]+O[1]);b=c.scale/w,x=(c.shift-A)/w+.5}n.getProgram().setUniformf("pwfshift".concat(y),x),n.getProgram().setUniformf("pwfscale".concat(y),b)}if(t.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",t.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){var P=e.getCoincidentParameters(r,a);n.getProgram().setUniformf("coffset",P.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",P.factor)}var I=t.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",I);var C=t.pwfTexture.getTextureUnit();if(n.getProgram().setUniformi("pwfTexture1",C),t.renderable.getNumberOfClippingPlanes()){var E=t.renderable.getNumberOfClippingPlanes();E>6&&(lt("OpenGL has a limit of 6 clipping planes"),E=6);var M=n.getCABO().getCoordShiftAndScaleEnabled(),R=M?n.getCABO().getInverseShiftAndScaleMatrix():null,D=R?j(t.imagematinv,a.getMatrix()):a.getMatrix();R&&(K(D,D),X(D,D,R),K(D,D)),K(t.imagemat,t.currentInput.getIndexToWorld()),X(t.imagematinv,D,t.imagemat);for(var k=[],L=0;L<E;L++){var B=[];t.renderable.getClippingPlaneInDataCoords(t.imagematinv,L,B);for(var V=0;V<4;V++)k.push(B[V])}n.getProgram().setUniformi("numClipPlanes",E),n.getProgram().setUniform4fv("clipPlanes",k)}},e.setCameraShaderParameters=function(e,n,r){var a=e.getProgram(),o=t.openGLImageSlice.getKeyMatrices(),i=t.currentInput,s=i.getIndexToWorld();X(t.imagemat,o.mcwc,s);var l=t.openGLCamera.getKeyMatrices(n);if(X(t.imagemat,l.wcpc,t.imagemat),e.getCABO().getCoordShiftAndScaleEnabled()){var c=e.getCABO().getInverseShiftAndScaleMatrix();X(t.imagemat,t.imagemat,c)}a.setUniformMatrix("MCPCMatrix",t.imagemat)},e.setPropertyShaderParameters=function(e,t,n){var r=e.getProgram(),a=n.getProperty(),o=a.getOpacity();r.setUniformf("opacity",o)},e.renderPieceStart=function(n,r){e.updateBufferObjects(n,r),t.lastBoundBO=null},e.renderPieceDraw=function(n,r){var a=t.context;t.openGLTexture.activate(),t.colorTexture.activate(),t.pwfTexture.activate(),t.tris.getCABO().getElementCount()&&(e.updateShaders(t.tris,n,r),a.drawArrays(a.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release()),t.openGLTexture.deactivate(),t.colorTexture.deactivate(),t.pwfTexture.deactivate()},e.renderPieceFinish=function(e,t){},e.renderPiece=function(n,r){e.invokeEvent({type:"StartEvent"}),t.renderable.update(),t.currentInput=t.renderable.getCurrentImage(),e.invokeEvent({type:"EndEvent"}),t.currentInput?(e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)):fo("No input!")},e.computeBounds=function(n,r){e.getInput()?t.bounds=e.getInput().getBounds():Jn(t.bounds)},e.updateBufferObjects=function(t,n){e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=function(n,r){return t.VBOBuildTime.getMTime()<e.getMTime()||t.VBOBuildTime.getMTime()<r.getMTime()||t.VBOBuildTime.getMTime()<t.renderable.getMTime()||t.VBOBuildTime.getMTime()<r.getProperty().getMTime()||t.VBOBuildTime.getMTime()<t.currentInput.getMTime()},e.buildBufferObjects=function(n,r){var a=t.currentInput;if(a){var o=a.getPointData()&&a.getPointData().getScalars();if(o){var i=o.getDataType(),s=o.getNumberOfComponents(),l=r.getProperty(),c=l.getInterpolationType();c===oo.NEAREST?(t.colorTexture.setMinificationFilter(Ua.NEAREST),t.colorTexture.setMagnificationFilter(Ua.NEAREST),t.pwfTexture.setMinificationFilter(Ua.NEAREST),t.pwfTexture.setMagnificationFilter(Ua.NEAREST)):(t.colorTexture.setMinificationFilter(Ua.LINEAR),t.colorTexture.setMagnificationFilter(Ua.LINEAR),t.pwfTexture.setMinificationFilter(Ua.LINEAR),t.pwfTexture.setMagnificationFilter(Ua.LINEAR));var u=l.getIndependentComponents(),f=u?s:1,d=u?2*f:1,p=mo(l,l.getRGBTransferFunction,f);if(t.colorTextureString!==p){var m=1024,g=m*d*3,v=new Uint8Array(g),h=l.getRGBTransferFunction();if(h){for(var y=new Float32Array(3*m),b=0;b<f;b++){h=l.getRGBTransferFunction(b);var x=h.getRange();if(h.getTable(x[0],x[1],m,y,1),u)for(var T=0;T<3*m;T++)v[b*m*6+T]=255*y[T],v[b*m*6+T+3*m]=255*y[T];else for(var S=0;S<3*m;S++)v[b*m*6+S]=255*y[S]}t.colorTexture.create2DFromRaw(m,d,3,kn.UNSIGNED_CHAR,v)}else{for(var O=0;O<3*m;++O)v[O]=255*O/(3*(m-1)),v[O+1]=255*O/(3*(m-1)),v[O+2]=255*O/(3*(m-1));t.colorTexture.create2DFromRaw(m,1,3,kn.UNSIGNED_CHAR,v)}t.colorTextureString=p}var w=mo(l,l.getPiecewiseFunction,f);if(t.pwfTextureString!==w){var A=1024,P=A*d,I=new Uint8Array(P),C=l.getPiecewiseFunction();if(t.pwfTexture.resetFormatAndType(),C){for(var E=new Float32Array(P),M=new Float32Array(A),R=0;R<f;++R)if(C=l.getPiecewiseFunction(R),null===C)E.fill(1);else{var D=C.getRange();if(C.getTable(D[0],D[1],A,M,1),u)for(var k=0;k<A;k++)E[R*A*2+k]=M[k],E[R*A*2+k+A]=M[k];else for(var L=0;L<A;L++)E[R*A*2+L]=M[L]}t.pwfTexture.create2DFromRaw(A,d,1,kn.FLOAT,E)}else I.fill(255),t.pwfTexture.create2DFromRaw(A,1,1,kn.UNSIGNED_CHAR,I);t.pwfTextureString=w}var B=t.renderable.getClosestIJKAxis(),V=B.ijkMode,F=t.renderable.getSlice();V!==t.renderable.getSlicingMode()&&(F=t.renderable.getSliceAtPosition(F));var N,U=t.renderable.isA("vtkImageArrayMapper")?t.renderable.getSubSlice():Math.round(F),_=a.getExtent();V===po.I&&(N=U-_[0]),V===po.J&&(N=U-_[2]),V!==po.K&&V!==po.NONE||(N=U-_[4]);var G="".concat(F,"A").concat(a.getMTime(),"A").concat(o.getMTime(),"B").concat(e.getMTime(),"C").concat(t.renderable.getSlicingMode(),"D").concat(r.getProperty().getMTime());if(t.VBOBuildString!==G){var z=a.getDimensions();c===oo.NEAREST?(new Set([1,3,4]).has(s)&&i===kn.UNSIGNED_CHAR&&!u?(t.openGLTexture.setGenerateMipmap(!0),t.openGLTexture.setMinificationFilter(Ua.NEAREST)):t.openGLTexture.setMinificationFilter(Ua.NEAREST),t.openGLTexture.setMagnificationFilter(Ua.NEAREST)):(4!==s||i!==kn.UNSIGNED_CHAR||u?t.openGLTexture.setMinificationFilter(Ua.LINEAR):(t.openGLTexture.setGenerateMipmap(!0),t.openGLTexture.setMinificationFilter(Ua.LINEAR_MIPMAP_LINEAR)),t.openGLTexture.setMagnificationFilter(Ua.LINEAR)),t.openGLTexture.setWrapS(Na.CLAMP_TO_EDGE),t.openGLTexture.setWrapT(Na.CLAMP_TO_EDGE);for(var j=z[0]*z[1]*s,W=new Float32Array(12),K=new Float32Array(8),H=0;H<4;H++)K[2*H]=H%2?1:0,K[2*H+1]=H>1?1:0;var X=[po.X,po.Y,po.Z].includes(t.renderable.getSlicingMode())?F:U,q=a.getSpatialExtent(),Y=o.getData(),Z=null;if(V===po.I){Z=new Y.constructor(z[2]*z[1]*s);for(var $=0,J=0;J<z[2];J++)for(var Q=0;Q<z[1];Q++){var ee=(N+Q*z[0]+J*z[0]*z[1])*s;$=(J*z[1]+Q)*s,Z.set(Y.subarray(ee,ee+s),$)}z[0]=z[1],z[1]=z[2],W[0]=X,W[1]=q[2],W[2]=q[4],W[3]=X,W[4]=q[3],W[5]=q[4],W[6]=X,W[7]=q[2],W[8]=q[5],W[9]=X,W[10]=q[3],W[11]=q[5]}else if(V===po.J){Z=new Y.constructor(z[2]*z[0]*s);for(var te=0,ne=0;ne<z[2];ne++)for(var re=0;re<z[0];re++){var ae=(re+N*z[0]+ne*z[0]*z[1])*s;te=(ne*z[0]+re)*s,Z.set(Y.subarray(ae,ae+s),te)}z[1]=z[2],W[0]=q[0],W[1]=X,W[2]=q[4],W[3]=q[1],W[4]=X,W[5]=q[4],W[6]=q[0],W[7]=X,W[8]=q[5],W[9]=q[1],W[10]=X,W[11]=q[5]}else V===po.K||V===po.NONE?(Z=Y.subarray(N*j,(N+1)*j),W[0]=q[0],W[1]=q[2],W[2]=X,W[3]=q[1],W[4]=q[2],W[5]=X,W[6]=q[0],W[7]=q[3],W[8]=X,W[9]=q[1],W[10]=q[3],W[11]=X):fo("Reformat slicing not yet supported.");t.openGLTexture.create2DFromRaw(z[0],z[1],s,o.getDataType(),Z),t.openGLTexture.activate(),t.openGLTexture.sendParameters(),t.openGLTexture.deactivate();var oe=vr.newInstance({numberOfComponents:3,values:W});oe.setName("points");var ie=vr.newInstance({numberOfComponents:2,values:K});ie.setName("tcoords");var se=new Uint16Array(8);se[0]=3,se[1]=0,se[2]=1,se[3]=3,se[4]=3,se[5]=0,se[6]=3,se[7]=2;var le=vr.newInstance({numberOfComponents:1,values:se});t.tris.getCABO().createVBO(le,"polys",ra.SURFACE,{points:oe,tcoords:ie,cellOffset:0}),t.VBOBuildTime.modified(),t.VBOBuildString=G}}}}}var vo={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function ho(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,vo,n),un.extend(e,t,n),uo.implementReplaceShaderCoincidentOffset(e,t,n),t.tris=Fa.newInstance(),t.openGLTexture=ao.newInstance({resizable:!0}),t.colorTexture=ao.newInstance({resizable:!0}),t.pwfTexture=ao.newInstance({resizable:!0}),t.imagemat=W(new Float64Array(16)),t.imagematinv=W(new Float64Array(16)),Dt(e,t,[]),t.VBOBuildTime={},Pt(t.VBOBuildTime),go(e,t)}var yo=_t(ho,"vtkOpenGLImageMapper");function bo(e,t){t.classHierarchy.push("vtkOpenGLImageSlice"),e.buildPass=function(n){if(t.renderable&&t.renderable.getVisibility()&&n){if(!t.renderable)return;t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t.context=t._openGLRenderWindow.getContext(),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes()}},e.traverseZBufferPass=function(n){t.renderable&&t.renderable.getNestedVisibility()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children.forEach((function(e){e.traverse(n)})),e.apply(n,!1))},e.traverseOpaqueZBufferPass=function(t){return e.traverseOpaquePass(t)},e.traverseOpaquePass=function(n){t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children.forEach((function(e){e.traverse(n)})),e.apply(n,!1))},e.traverseTranslucentPass=function(n){!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t._openGLRenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.children.forEach((function(e){e.traverse(n)})),e.apply(n,!1))},e.queryPass=function(e,n){if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.zBufferPass=function(t,n){return e.opaquePass(t,n)},e.opaqueZBufferPass=function(t,n){return e.opaquePass(t,n)},e.opaquePass=function(e,n){e&&t.context.depthMask(!0)},e.translucentPass=function(e,n){t.context.depthMask(!e)},e.getKeyMatrices=function(){return t.renderable.getMTime()>t.keyMatrixTime.getMTime()&&(j(t.keyMatrices.mcwc,t.renderable.getMatrix()),K(t.keyMatrices.mcwc,t.keyMatrices.mcwc),t.keyMatrixTime.modified()),t.keyMatrices}}hn("vtkAbstractImageMapper",yo);var xo={context:null,keyMatrixTime:null,keyMatrices:null};function To(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,xo,n),un.extend(e,t,n),t.keyMatrixTime={},Pt(t.keyMatrixTime,{mtime:0}),t.keyMatrices={mcwc:W(new Float64Array(16))},Dt(e,t,["context"]),bo(e,t)}var So=_t(To,"vtkOpenGLImageSlice");function Oo(e,t){t.classHierarchy.push("vtkOpenGLVolume"),e.buildPass=function(n){t.renderable&&t.renderable.getVisibility()&&n&&(t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t.context=t._openGLRenderWindow.getContext(),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes())},e.queryPass=function(e,n){if(e){if(!t.renderable||!t.renderable.getVisibility())return;n.incrementVolumeCount()}},e.traverseVolumePass=function(n){t.renderable&&t.renderable.getNestedVisibility()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children[0].traverse(n),e.apply(n,!1))},e.volumePass=function(e){t.renderable&&t.renderable.getVisibility()&&t.context.depthMask(!e)},e.getKeyMatrices=function(){return t.renderable.getMTime()>t.keyMatrixTime.getMTime()&&(t.renderable.computeMatrix(),j(t.MCWCMatrix,t.renderable.getMatrix()),K(t.MCWCMatrix,t.MCWCMatrix),t.renderable.getIsIdentity()?se(t.normalMatrix):(ie(t.normalMatrix,t.MCWCMatrix),le(t.normalMatrix,t.normalMatrix)),t.keyMatrixTime.modified()),{mcwc:t.MCWCMatrix,normalMatrix:t.normalMatrix}}}hn("vtkImageSlice",So);var wo={};function Ao(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,wo,n),un.extend(e,t,n),t.keyMatrixTime={},Pt(t.keyMatrixTime,{mtime:0}),t.normalMatrix=new Float64Array(9),t.MCWCMatrix=new Float64Array(16),Dt(e,t,["context"]),Oo(e,t)}var Po=_t(Ao,"vtkOpenGLVolume");function Io(e,t){t.classHierarchy.push("vtkFramebuffer"),e.getBothMode=function(){return t.context.FRAMEBUFFER},e.saveCurrentBindingsAndBuffers=function(t){var n="undefined"!==typeof t?t:e.getBothMode();e.saveCurrentBindings(n),e.saveCurrentBuffers(n)},e.saveCurrentBindings=function(e){if(t.context){var n=t.context;t.previousDrawBinding=n.getParameter(t.context.FRAMEBUFFER_BINDING),t.previousActiveFramebuffer=t._openGLRenderWindow.getActiveFramebuffer()}else lt("you must set the OpenGLRenderWindow before calling saveCurrentBindings")},e.saveCurrentBuffers=function(e){},e.restorePreviousBindingsAndBuffers=function(t){var n="undefined"!==typeof t?t:e.getBothMode();e.restorePreviousBindings(n),e.restorePreviousBuffers(n)},e.restorePreviousBindings=function(e){if(t.context){var n=t.context;n.bindFramebuffer(n.FRAMEBUFFER,t.previousDrawBinding),t._openGLRenderWindow.setActiveFramebuffer(t.previousActiveFramebuffer)}else lt("you must set the OpenGLRenderWindow before calling restorePreviousBindings")},e.restorePreviousBuffers=function(e){},e.bind=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=n;null===r&&(r=t.context.FRAMEBUFFER),t.context.bindFramebuffer(r,t.glFramebuffer);for(var a=0;a<t.colorBuffers.length;a++)t.colorBuffers[a].bind();t._openGLRenderWindow.setActiveFramebuffer(e)},e.create=function(e,n){t.context?(t.glFramebuffer=t.context.createFramebuffer(),t.glFramebuffer.width=e,t.glFramebuffer.height=n):lt("you must set the OpenGLRenderWindow before calling create")},e.setColorBuffer=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.context;if(r){var a=r.COLOR_ATTACHMENT0;if(n>0){if(!t._openGLRenderWindow.getWebgl2())return void lt("Using multiple framebuffer attachments requires WebGL 2");a+=n}t.colorBuffers[n]=e,r.framebufferTexture2D(r.FRAMEBUFFER,a,r.TEXTURE_2D,e.getHandle(),0)}else lt("you must set the OpenGLRenderWindow before calling setColorBuffer")},e.removeColorBuffer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=t.context;if(n){var r=n.COLOR_ATTACHMENT0;if(e>0){if(!t._openGLRenderWindow.getWebgl2())return void lt("Using multiple framebuffer attachments requires WebGL 2");r+=e}n.framebufferTexture2D(n.FRAMEBUFFER,r,n.TEXTURE_2D,null,0),t.colorBuffers=t.colorBuffers.splice(e,1)}else lt("you must set the OpenGLRenderWindow before calling removeColorBuffer")},e.setDepthBuffer=function(e){if(t.context)if(t._openGLRenderWindow.getWebgl2()){var n=t.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,e.getHandle(),0)}else lt("Attaching depth buffer textures to fbo requires WebGL 2");else lt("you must set the OpenGLRenderWindow before calling setDepthBuffer")},e.removeDepthBuffer=function(){if(t.context)if(t._openGLRenderWindow.getWebgl2()){var e=t.context;e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,null,0)}else lt("Attaching depth buffer textures to framebuffers requires WebGL 2");else lt("you must set the OpenGLRenderWindow before calling removeDepthBuffer")},e.getGLFramebuffer=function(){return t.glFramebuffer},e.setOpenGLRenderWindow=function(n){t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.releaseGraphicsResources=function(){t.glFramebuffer&&t.context.deleteFramebuffer(t.glFramebuffer)},e.getSize=function(){var e=[0,0];return null!==t.glFramebuffer&&(e[0]=t.glFramebuffer.width,e[1]=t.glFramebuffer.height),e},e.populateFramebuffer=function(){if(t.context){e.bind();var n=t.context,r=ao.newInstance();r.setOpenGLRenderWindow(t._openGLRenderWindow),r.setMinificationFilter(Ua.LINEAR),r.setMagnificationFilter(Ua.LINEAR),r.create2DFromRaw(t.glFramebuffer.width,t.glFramebuffer.height,4,kn.UNSIGNED_CHAR,null),e.setColorBuffer(r),t.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,t.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t.glFramebuffer.width,t.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t.depthTexture)}else lt("you must set the OpenGLRenderWindow before calling populateFrameBuffer")},e.getColorTexture=function(){return t.colorBuffers[0]}}hn("vtkVolume",Po);var Co={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function Eo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Co,n),Pt(e,t),t.colorBuffers&&lt("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),t.colorBuffers=[],kt(e,t,["colorBuffers"]),Io(e,t)}var Mo=_t(Eo,"vtkFramebuffer"),Ro={newInstance:Mo,extend:Eo},Do={NEAREST:0,LINEAR:1,FAST_LINEAR:2},ko={FRACTIONAL:0,PROPORTIONAL:1},Lo={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5},Bo="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyDataVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\nattribute vec4 vertexDC;\n\nvarying vec3 vertexVCVSOutput;\nuniform mat4 PCVCMatrix;\n\nuniform float dcxmin;\nuniform float dcxmax;\nuniform float dcymin;\nuniform float dcymax;\n\nvoid main()\n{\n  // dcsmall is the device coords reduced to the\n  // x y area covered by the volume\n  vec4 dcsmall = vec4(\n    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),\n    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),\n    vertexDC.z,\n    vertexDC.w);\n  vec4 vcpos = PCVCMatrix * dcsmall;\n  vertexVCVSOutput = vcpos.xyz/vcpos.w;\n  gl_Position = dcsmall;\n}\n",Vo="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkVolumeFS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// Template for the volume mappers fragment shader\n\n// the output of this shader\n//VTK::Output::Dec\n\nvarying vec3 vertexVCVSOutput;\n\n// first declare the settings from the mapper\n// that impact the code paths in here\n\n// always set vtkNumComponents 1,2,3,4\n//VTK::NumComponents\n\n// possibly define vtkTrilinearOn\n//VTK::TrilinearOn\n\n// possibly define vtkIndependentComponents\n//VTK::IndependentComponentsOn\n\n// possibly define any \"proportional\" components\n//VTK::vtkProportionalComponents\n\n// Define the blend mode to use\n#define vtkBlendMode //VTK::BlendMode\n\n// Possibly define vtkImageLabelOutlineOn\n//VTK::ImageLabelOutlineOn\n\n#ifdef vtkImageLabelOutlineOn\nuniform int outlineThickness;\nuniform float outlineOpacity;\nuniform float vpWidth;\nuniform float vpHeight;\nuniform float vpOffsetX;\nuniform float vpOffsetY;\nuniform mat4 PCWCMatrix;\nuniform mat4 vWCtoIDX;\n#endif\n\n// define vtkLightComplexity\n//VTK::LightComplexity\n#if vtkLightComplexity > 0\nuniform float vSpecularPower;\nuniform float vAmbient;\nuniform float vDiffuse;\nuniform float vSpecular;\n//VTK::Light::Dec\n#endif\n\n//VTK::VolumeShadowOn\n//VTK::SurfaceShadowOn\n//VTK::localAmbientOcclusionOn\n//VTK::LAO::Dec\n//VTK::VolumeShadow::Dec\n\n// define vtkComputeNormalFromOpacity\n//VTK::vtkComputeNormalFromOpacity\n\n// possibly define vtkGradientOpacityOn\n//VTK::GradientOpacityOn\n#ifdef vtkGradientOpacityOn\nuniform float goscale0;\nuniform float goshift0;\nuniform float gomin0;\nuniform float gomax0;\n#if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)\nuniform float goscale1;\nuniform float goshift1;\nuniform float gomin1;\nuniform float gomax1;\n#if vtkNumComponents >= 3\nuniform float goscale2;\nuniform float goshift2;\nuniform float gomin2;\nuniform float gomax2;\n#endif\n#if vtkNumComponents >= 4\nuniform float goscale3;\nuniform float goshift3;\nuniform float gomin3;\nuniform float gomax3;\n#endif\n#endif\n#endif\n\n// if you want to see the raw tiled\n// data in webgl1 uncomment the following line\n// #define debugtile\n\n// camera values\nuniform float camThick;\nuniform float camNear;\nuniform float camFar;\nuniform int cameraParallel;\n\n// values describing the volume geometry\nuniform vec3 vOriginVC;\nuniform vec3 vSpacing;\nuniform ivec3 volumeDimensions; // 3d texture dimensions\nuniform vec3 vPlaneNormal0;\nuniform float vPlaneDistance0;\nuniform vec3 vPlaneNormal1;\nuniform float vPlaneDistance1;\nuniform vec3 vPlaneNormal2;\nuniform float vPlaneDistance2;\nuniform vec3 vPlaneNormal3;\nuniform float vPlaneDistance3;\nuniform vec3 vPlaneNormal4;\nuniform float vPlaneDistance4;\nuniform vec3 vPlaneNormal5;\nuniform float vPlaneDistance5;\n\n//VTK::ClipPlane::Dec\n\n// opacity and color textures\nuniform sampler2D otexture;\nuniform float oshift0;\nuniform float oscale0;\nuniform sampler2D ctexture;\nuniform float cshift0;\nuniform float cscale0;\n\n// jitter texture\nuniform sampler2D jtexture;\n\n// some 3D texture values\nuniform float sampleDistance;\nuniform vec3 vVCToIJK;\n\n// the heights defined below are the locations\n// for the up to four components of the tfuns\n// the tfuns have a height of 2XnumComps pixels so the\n// values are computed to hit the middle of the two rows\n// for that component\n#ifdef vtkIndependentComponentsOn\n#if vtkNumComponents == 2\nuniform float mix0;\nuniform float mix1;\n#define height0 0.25\n#define height1 0.75\n#endif\n#if vtkNumComponents == 3\nuniform float mix0;\nuniform float mix1;\nuniform float mix2;\n#define height0 0.17\n#define height1 0.5\n#define height2 0.83\n#endif\n#if vtkNumComponents == 4\nuniform float mix0;\nuniform float mix1;\nuniform float mix2;\nuniform float mix3;\n#define height0 0.125\n#define height1 0.375\n#define height2 0.625\n#define height3 0.875\n#endif\n#endif\n\n#if vtkNumComponents >= 2\nuniform float oshift1;\nuniform float oscale1;\nuniform float cshift1;\nuniform float cscale1;\n#endif\n#if vtkNumComponents >= 3\nuniform float oshift2;\nuniform float oscale2;\nuniform float cshift2;\nuniform float cscale2;\n#endif\n#if vtkNumComponents >= 4\nuniform float oshift3;\nuniform float oscale3;\nuniform float cshift3;\nuniform float cscale3;\n#endif\n\nuniform vec4 ipScalarRangeMin;\nuniform vec4 ipScalarRangeMax;\n\n// declaration for intermixed geometry\n//VTK::ZBuffer::Dec\n\n//=======================================================================\n// global and custom variables (a temporary section before photorealistics rendering module is complete)\nvec3 rayDirVC;\nfloat sampleDistanceISVS;\nfloat sampleDistanceIS;\n\n#define SQRT3    1.7321\n#define INV4PI   0.0796\n#define EPSILON  0.001\n#define PI       3.1415\n#define PI2      9.8696\n\n//=======================================================================\n// Webgl2 specific version of functions\n#if __VERSION__ == 300\n\nuniform highp sampler3D texture1;\n\nvec4 getTextureValue(vec3 pos)\n{\n  vec4 tmp = texture(texture1, pos);\n#if vtkNumComponents == 1\n  tmp.a = tmp.r;\n#endif\n#if vtkNumComponents == 2\n  tmp.a = tmp.g;\n#endif\n#if vtkNumComponents == 3\n  tmp.a = length(tmp.rgb);\n#endif\n  return tmp;\n}\n\n//=======================================================================\n// WebGL1 specific version of functions\n#else\n\nuniform sampler2D texture1;\n\nuniform float texWidth;\nuniform float texHeight;\nuniform int xreps;\nuniform int xstride;\nuniform int ystride;\n\n// if computing trilinear values from multiple z slices\n#ifdef vtkTrilinearOn\nvec4 getTextureValue(vec3 ijk)\n{\n  float zoff = 1.0/float(volumeDimensions.z);\n  vec4 val1 = getOneTextureValue(ijk);\n  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));\n\n  float indexZ = float(volumeDimensions)*ijk.z;\n  float zmix =  indexZ - floor(indexZ);\n\n  return mix(val1, val2, zmix);\n}\n\nvec4 getOneTextureValue(vec3 ijk)\n#else // nearest or fast linear\nvec4 getTextureValue(vec3 ijk)\n#endif\n{\n  vec3 tdims = vec3(volumeDimensions);\n\n#ifdef debugtile\n  vec2 tpos = vec2(ijk.x, ijk.y);\n  vec4 tmp = texture2D(texture1, tpos);\n  tmp.a = 1.0;\n\n#else\n  int z = int(ijk.z * tdims.z);\n  int yz = z / xreps;\n  int xz = z - yz*xreps;\n\n  int tileWidth = volumeDimensions.x/xstride;\n  int tileHeight = volumeDimensions.y/ystride;\n\n  xz *= tileWidth;\n  yz *= tileHeight;\n\n  float ni = float(xz) + (ijk.x*float(tileWidth));\n  float nj = float(yz) + (ijk.y*float(tileHeight));\n\n  vec2 tpos = vec2(ni/texWidth, nj/texHeight);\n\n  vec4 tmp = texture2D(texture1, tpos);\n\n#if vtkNumComponents == 1\n  tmp.a = tmp.r;\n#endif\n#if vtkNumComponents == 2\n  tmp.g = tmp.a;\n#endif\n#if vtkNumComponents == 3\n  tmp.a = length(tmp.rgb);\n#endif\n#endif\n\n  return tmp;\n}\n\n// End of Webgl1 specific code\n//=======================================================================\n#endif\n\n//=======================================================================\n// transformation between VC and IS space\n\n// convert vector position from idx to vc\n#if vtkLightComplexity > 0\nvec3 IStoVC(vec3 posIS){\n  vec3 posVC = posIS / vVCToIJK;\n  return posVC.x * vPlaneNormal0 + \n         posVC.y * vPlaneNormal2 + \n         posVC.z * vPlaneNormal4 + \n         vOriginVC;\n}\n\n// convert vector position from vc to idx\nvec3 VCtoIS(vec3 posVC){\n  posVC = posVC - vOriginVC;\n  posVC = vec3(\n    dot(posVC, vPlaneNormal0),\n    dot(posVC, vPlaneNormal2),\n    dot(posVC, vPlaneNormal4));  \n  return posVC * vVCToIJK;\n}\n#endif\n\n//Rotate vector to view coordinate\n#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)\nvoid rotateToViewCoord(inout vec3 dirIS){\n  dirIS.xyz =\n    dirIS.x * vPlaneNormal0 +\n    dirIS.y * vPlaneNormal2 +\n    dirIS.z * vPlaneNormal4;\n}\n\n//Rotate vector to idx coordinate\nvec3 rotateToIDX(vec3 dirVC){\n  vec3 dirIS;\n  dirIS.xyz = vec3(\n    dot(dirVC, vPlaneNormal0),\n    dot(dirVC, vPlaneNormal2),\n    dot(dirVC, vPlaneNormal4));  \n  return dirIS;\n}\n#endif\n\n//=======================================================================\n// Given a normal compute the gradient opacity factors\nfloat computeGradientOpacityFactor(\n  float normalMag, float goscale, float goshift, float gomin, float gomax)\n{\n#if defined(vtkGradientOpacityOn)\n  return clamp(normalMag * goscale + goshift, gomin, gomax);\n#else\n  return 1.0;\n#endif\n}\n\n//=======================================================================\n// compute the normal and gradient magnitude for a position, uses forward difference\n#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)\n  #ifdef vtkComputeNormalFromOpacity\n    #ifdef vtkGradientOpacityOn\n      vec4 computeNormalForDensity(vec3 pos, float scalar, vec3 tstep, out mat3 scalarInterp, out vec3 secondaryGradientMag)\n      {\n        vec4 result;\n        scalarInterp[0][0] = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)).a;\n        scalarInterp[0][1] = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)).a;\n        scalarInterp[0][2] = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)).a;\n        // look up scalar values for computing secondary gradient\n        scalarInterp[1][0] = getTextureValue(pos + vec3(2.0*tstep.x, 0.0, 0.0)).a;\n        scalarInterp[1][1] = getTextureValue(pos + vec3(0.0, 2.0*tstep.y, 0.0)).a;\n        scalarInterp[1][2] = getTextureValue(pos + vec3(0.0, 0.0, 2.0*tstep.z)).a;\n        scalarInterp[2][0] = getTextureValue(pos + vec3(tstep.x, tstep.y, 0.0)).a;\n        scalarInterp[2][1] = getTextureValue(pos + vec3(tstep.x, 0.0, tstep.z)).a;\n        scalarInterp[2][2] = getTextureValue(pos + vec3(0.0, tstep.y, tstep.z)).a;\n        result.x = scalarInterp[0][0] - scalar;\n        result.y = scalarInterp[0][1] - scalar;\n        result.z = scalarInterp[0][2] - scalar;\n        // divide by spacing\n        result.xyz /= vSpacing;\n        result.w = length(result.xyz);\n        rotateToViewCoord(result.xyz);\n        secondaryGradientMag.x = length(vec3(scalarInterp[1][0] - scalarInterp[0][0],\n                                             scalarInterp[2][0] - scalarInterp[0][0],\n                                             scalarInterp[2][1] - scalarInterp[0][0]) / vSpacing);\n        secondaryGradientMag.y = length(vec3(scalarInterp[2][0] - scalarInterp[0][1],\n                                             scalarInterp[1][1] - scalarInterp[0][1],\n                                             scalarInterp[2][2] - scalarInterp[0][1]) / vSpacing);\n        secondaryGradientMag.z = length(vec3(scalarInterp[2][1] - scalarInterp[0][2],\n                                             scalarInterp[2][2] - scalarInterp[0][2],\n                                             scalarInterp[1][2] - scalarInterp[0][2]) / vSpacing);\n        if (length(result.xyz) > 0.0) {\n          return vec4(normalize(result.xyz),result.w);\n        } else {\n          return vec4(0.0);\n        }\n      }\n\n      vec4 computeDensityNormal(float scalar, float gradientMag, mat3 scalarInterp, vec3 secondaryGradientMag)\n      {\n        vec4 opacityG;\n        vec3 opacityInterp = vec3(0.0);\n        float opacity = texture2D(otexture, vec2(scalar * oscale0 + oshift0, 0.5)).r;\n        if (gradientMag >= 0.0){\n          opacity *= computeGradientOpacityFactor(gradientMag, goscale0, goshift0, gomin0, gomax0);\n        }\n        opacityInterp.x = texture2D(otexture, vec2(scalarInterp[0][0] * oscale0 + oshift0, 0.5)).r; \n        if (secondaryGradientMag.x >= 0.0){\n          opacityInterp.x *= computeGradientOpacityFactor(secondaryGradientMag.x, goscale0, goshift0, gomin0, gomax0);\n        }\n    \n        opacityInterp.y = texture2D(otexture, vec2(scalarInterp[0][1] * oscale0 + oshift0, 0.5)).r;\n        if (secondaryGradientMag.y >= 0.0){\n          opacityInterp.y *= computeGradientOpacityFactor(secondaryGradientMag.y, goscale0, goshift0, gomin0, gomax0);\n        }\n\n        opacityInterp.z = texture2D(otexture, vec2(scalarInterp[0][2] * oscale0 + oshift0, 0.5)).r;\n        if (secondaryGradientMag.z >= 0.0){\n          opacityInterp.z *= computeGradientOpacityFactor(secondaryGradientMag.z, goscale0, goshift0, gomin0, gomax0);\n        }\n\n        opacityG.xyz = opacityInterp - vec3(opacity,opacity,opacity);\n        // divide by spacing\n        opacityG.xyz /= vSpacing;\n        opacityG.w = length(opacityG.xyz);\n        rotateToViewCoord(opacityG.xyz);\n        if (length(opacityG.xyz) > 0.0) {  \n          return vec4(normalize(opacityG.xyz),opacityG.w);\n        } else {\n          return vec4(0.0);\n        }\n      } \n\n    #else\n    //if gradient opacity not on but using density gradient\n      vec4 computeDensityNormal(float scalar, vec3 scalarInterp) \n      { \n        vec4 opacityG; \n        float opacity = texture2D(otexture, vec2(scalar * oscale0 + oshift0, 0.5)).r; \n        opacityG.x = texture2D(otexture, vec2(scalarInterp.x * oscale0 + oshift0, 0.5)).r - opacity; \n        opacityG.y = texture2D(otexture, vec2(scalarInterp.y * oscale0 + oshift0, 0.5)).r - opacity; \n        opacityG.z = texture2D(otexture, vec2(scalarInterp.z * oscale0 + oshift0, 0.5)).r - opacity; \n        // divide by spacing \n        opacityG.xyz /= vSpacing; \n        opacityG.w = length(opacityG.xyz); \n        // rotate to View Coords \n        rotateToViewCoord(opacityG.xyz);\n        if (length(opacityG.xyz) > 0.0) {     \n          return vec4(normalize(opacityG.xyz),opacityG.w); \n        } else { \n          return vec4(0.0); \n        } \n      } \n      vec4 computeNormalForDensity(vec3 pos, float scalar, vec3 tstep, out vec3 scalarInterp) \n      { \n        vec4 result; \n        scalarInterp.x = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)).a; \n        scalarInterp.y = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)).a; \n        scalarInterp.z = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)).a; \n        result.x = scalarInterp.x - scalar; \n        result.y = scalarInterp.y - scalar; \n        result.z = scalarInterp.z - scalar;   \n        // divide by spacing\n        result.xyz /= vSpacing;\n        result.w = length(result.xyz); \n        // rotate to View Coords \n        rotateToViewCoord(result.xyz);      \n        if (length(result.xyz) > 0.0) {     \n          return vec4(normalize(result.xyz),result.w); \n        } else { \n          return vec4(0.0); \n        } \n      }           \n    #endif\n  #endif\n  // compute scalar density\n  vec4 computeNormal(vec3 pos, float scalar, vec3 tstep)  \n  {  \n    vec4 result;  \n    result.x = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)).a - scalar;  \n    result.y = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)).a - scalar;  \n    result.z = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)).a - scalar;  \n    // divide by spacing  \n    result.xyz /= vSpacing;  \n    result.w = length(result.xyz);\n    if (result.w > 0.0){\n      // rotate to View Coords  \n      rotateToViewCoord(result.xyz);\n      return vec4(normalize(result.xyz),result.w);  \n    } else {\n      return vec4(0.0);\n    }\n  }  \n#endif\n\n#ifdef vtkImageLabelOutlineOn\nvec3 fragCoordToIndexSpace(vec4 fragCoord) {\n  vec4 pcPos = vec4(\n    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,\n    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,\n    (fragCoord.z - 0.5) * 2.0,\n    1.0);\n\n  vec4 worldCoord = PCWCMatrix * pcPos;\n  vec4 vertex = (worldCoord/worldCoord.w);\n\n  vec3 index = (vWCtoIDX * vertex).xyz;\n\n  // half voxel fix for labelmapOutline \n  return (index + vec3(0.5)) / vec3(volumeDimensions);\n}\n#endif\n\n//=======================================================================\n// compute the normals and gradient magnitudes for a position\n// for independent components\nmat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)\n{\n  mat4 result;\n  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;\n  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;\n  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;\n\n  // divide by spacing\n  distX /= vSpacing.x;\n  distY /= vSpacing.y;\n  distZ /= vSpacing.z;\n\n  mat3 rot;\n  rot[0] = vPlaneNormal0;\n  rot[1] = vPlaneNormal2;\n  rot[2] = vPlaneNormal4;\n\n#if !defined(vtkComponent0Proportional)\n  result[0].xyz = vec3(distX.r, distY.r, distZ.r);\n  result[0].a = length(result[0].xyz);\n  result[0].xyz *= rot;\n  if (result[0].w > 0.0)\n  {\n    result[0].xyz /= result[0].w;\n  }\n#endif\n\n// optionally compute the 2nd component\n#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)\n  result[1].xyz = vec3(distX.g, distY.g, distZ.g);\n  result[1].a = length(result[1].xyz);\n  result[1].xyz *= rot;\n  if (result[1].w > 0.0)\n  {\n    result[1].xyz /= result[1].w;\n  }\n#endif\n\n// optionally compute the 3rd component\n#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)\n  result[2].xyz = vec3(distX.b, distY.b, distZ.b);\n  result[2].a = length(result[2].xyz);\n  result[2].xyz *= rot;\n  if (result[2].w > 0.0)\n  {\n    result[2].xyz /= result[2].w;\n  }\n#endif\n\n// optionally compute the 4th component\n#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)\n  result[3].xyz = vec3(distX.a, distY.a, distZ.a);\n  result[3].a = length(result[3].xyz);\n  result[3].xyz *= rot;\n  if (result[3].w > 0.0)\n  {\n    result[3].xyz /= result[3].w;\n  }\n#endif\n\n  return result;\n}\n\n//=======================================================================\n// global shadow - secondary ray\n#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)\nfloat random()\n{ \n  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);\n  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;\n  uint pcg_state = floatBitsToUint(jitter);\n  uint state = pcg_state;\n  pcg_state = pcg_state * uint(747796405) + uint(2891336453);\n  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);\n  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;\n}\n#endif\n\n#ifdef VolumeShadowOn\n// henyey greenstein phase function\nfloat phase_function(float cos_angle)\n{\n  // divide by 2.0 instead of 4pi to increase intensity\n  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;\n}\n\n// Computes the intersection between a ray and a box\nstruct Hit\n{\n  float tmin;\n  float tmax;\n};\n\nstruct Ray\n{\n  vec3 origin;\n  vec3 dir;\n  vec3 invDir;\n};\n\nbool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)\n{\n  vec3 tbot = r.invDir * (boundMin - r.origin);\n  vec3 ttop = r.invDir * (boundMax - r.origin);\n  vec3 tmin = min(ttop, tbot);\n  vec3 tmax = max(ttop, tbot);\n  vec2 t = max(tmin.xx, tmin.yz);\n  float t0 = max(t.x, t.y);\n  t = min(tmax.xx, tmax.yz);\n  float t1 = min(t.x, t.y);\n  hit.tmin = t0;\n  hit.tmax = t1;\n  return t1 > max(t0,0.0);\n}\n\n// As BBoxIntersect requires the inverse of the ray coords,\n// this function is used to avoid numerical issues\nvoid safe_0_vector(inout Ray ray)\n{\n  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;\n  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;\n  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;\n}\n\nfloat volume_shadow(vec3 posIS, vec3 lightDirNormIS)\n{\n  float shadow = 1.0;\n  float opacity = 0.0;\n\n  // modify sample distance with a random number between 1.5 and 3.0\n  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());\n  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;\n  \n  // in case the first sample near surface has a very tiled light ray, we need to offset start position \n  posIS += sampleDistanceISVS_jitter * lightDirNormIS;  \n\n  // compute the start and end points for the ray\n  Ray ray;\n  Hit hit;  \n  ray.origin = posIS;\n  ray.dir = lightDirNormIS;\n  safe_0_vector(ray);\n  ray.invDir = 1.0/ray.dir;\n  \n  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))\n  {\n    return 1.0;\n  }\n  float maxdist = hit.tmax;\n\n  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach\n  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);\n  maxdist = min(maxdist,maxgi);\n  if(maxdist < EPSILON) {\n    return 1.0;\n  }\n\n  // support gradient opacity\n  #ifdef vtkGradientOpacityOn\n    vec4 normal;\n  #endif\n\n  float current_dist = 0.0;\n  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);\n  float clamped_step = 0.0;\n\n  vec4 scalar = vec4(0.0);\n  while(current_dist < maxdist)\n  {\n    scalar = getTextureValue(posIS);\n    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;\n    #ifdef vtkGradientOpacityOn \n      normal = computeNormal(posIS, scalar.a, vec3(1.0/vec3(volumeDimensions))); \n      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);\n    #endif    \n    shadow *= 1.0 - opacity;\n\n    // optimization: early termination\n    if (shadow < EPSILON){\n      return 0.0;\n    }\n\n    clamped_step = min(maxdist - current_dist, current_step);\n    posIS += clamped_step * lightDirNormIS;\n    current_dist += current_step;\n  }\n\n  return shadow;\n}\n\nvec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)\n{\n  vec3 vertLight = vec3(0.0);\n  vec3 secondary_contrib = vec3(0.0);\n  // here we assume only positional light, no effect of cones\n  for (int i = 0; i < lightNum; i++)\n  {\n    #if(vtkLightComplexity==3)\n      if (lightPositional[i] == 1){\n        vertLight = lightPositionVC[i] - IStoVC(posIS);\n      }else{\n        vertLight = - lightDirectionVC[i];\n      }\n    #else\n      vertLight = - lightDirectionVC[i];\n    #endif\n    // here we assume achromatic light, only intensity\n    float dDotL = dot(viewDirectionVC, normalize(vertLight));\n    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity\n    float phase_attenuation = 0.5;\n    if (abs(anisotropy) > EPSILON){\n      phase_attenuation = phase_function(dDotL);\n    }\n    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));\n    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;     \n    secondary_contrib += tColor * vAmbient;\n  } \n  return secondary_contrib;\n}\n#endif\n\n//=======================================================================\n// local ambient occlusion\n#ifdef localAmbientOcclusionOn\nvec3 sample_direction_uniform(int i)\n{\n  float rand = random() * 0.5;\n  float theta = PI2 * (kernelSample[i][0] + rand);\n  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;\n  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));\n}\n\n// return a matrix that transform startDir into z axis; startDir should be normalized\nmat3 zBaseRotationalMatrix(vec3 startDir){\n  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));\n  float cosA = startDir.z;\n  float k = 1.0 / (1.0 + cosA);\n  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,\n              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,\n              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);\n  return matrix;\n}\n\nfloat computeLAO(vec3 posIS, float opacity, vec3 lightDir, vec4 normal){\n  // apply LAO only at selected locations, otherwise return full brightness\n  if (normal.w > 0.0 && opacity > 0.05){\n    float total_transmittance = 0.0;\n    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));\n    vec3 currPos, randomDirStep;\n    float weight, transmittance, opacity;\n    for (int i = 0; i < kernelSize; i++)\n    {\n      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;\n      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));\n      currPos = posIS;\n      transmittance = 1.0;\n      for (int j = 0; j < kernelRadius ; j++){\n        currPos += randomDirStep;\n        // check if it's at clipping plane, if so return full brightness\n        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){\n          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;\n          #ifdef vtkGradientOpacityOn\n             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);\n          #endif\n          transmittance *= 1.0 - opacity;\n        }\n        else{\n          break;\n        }\n      }\n      total_transmittance += transmittance / float(kernelRadius) * weight;\n\n      // early termination if fully translucent\n      if (total_transmittance > 1.0 - EPSILON){\n        return 1.0;\n      }\n    }\n    // average transmittance and reduce variance\n    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0); \n  } else {\n    return 1.0;\n  }\n}\n#endif\n\n//=======================================================================\n// surface light contribution\n#if vtkLightComplexity > 0\n  void applyLighting(inout vec3 tColor, vec4 normal)\n  {\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    float df, sf = 0.0;\n    for (int i = 0; i < lightNum; i++){\n        df = abs(dot(normal.rgb, -lightDirectionVC[i]));\n        diffuse += df * lightColor[i];\n        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);\n        specular += sf * lightColor[i];\n    }\n    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;\n  }\n  #ifdef SurfaceShadowOn\n  #if vtkLightComplexity < 3\n    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)\n    {\n      // everything in VC\n      vec3 diffuse = vec3(0.0);\n      vec3 specular = vec3(0.0);\n      #ifdef localAmbientOcclusionOn\n        vec3 ambient = vec3(0.0);\n      #endif        \n      vec3 vertLightDirection;\n      for (int i = 0; i < lightNum; i++){\n        float ndotL,vdotR;\n        vertLightDirection = lightDirectionVC[i];\n        ndotL = dot(normal.xyz, vertLightDirection);\n        if (ndotL < 0.0 && twoSidedLighting)\n        {\n          ndotL = -ndotL;\n        }\n        if (ndotL > 0.0)\n        {\n          diffuse += ndotL * lightColor[i];\n          //specular\n          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));\n          if (vdotR > 0.0)\n          {\n            specular += pow(vdotR, vSpecularPower) * lightColor[i];\n          }\n        }\n        #ifdef localAmbientOcclusionOn\n            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);\n        #endif\n      }  \n      #ifdef localAmbientOcclusionOn\n        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;\n      #else \n        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;\n      #endif    \n    }\n  #else\n    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)\n    {\n      // everything in VC\n      vec3 diffuse = vec3(0.0);\n      vec3 specular = vec3(0.0);\n      #ifdef localAmbientOcclusionOn\n        vec3 ambient = vec3(0.0);\n      #endif      \n      vec3 vertLightDirection;\n      for (int i = 0; i < lightNum; i++){\n        float distance,attenuation,ndotL,vdotR;\n        vec3 lightDir;\n        if (lightPositional[i] == 1){\n          lightDir = lightDirectionVC[i];\n          vertLightDirection = posVC - lightPositionVC[i]; \n          distance = length(vertLightDirection);\n          vertLightDirection = normalize(vertLightDirection);\n          attenuation = 1.0 / (lightAttenuation[i].x\n                              + lightAttenuation[i].y * distance\n                              + lightAttenuation[i].z * distance * distance);\n          // per OpenGL standard cone angle is 90 or less for a spot light\n          if (lightConeAngle[i] <= 90.0){\n            float coneDot = dot(vertLightDirection, lightDir);\n            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone\n              attenuation = attenuation * pow(coneDot, lightExponent[i]);\n            }\n            else {\n              attenuation = 0.0;\n            }\n          }\n          ndotL = dot(normal.xyz, vertLightDirection);\n          if (ndotL < 0.0 && twoSidedLighting)\n          {\n            ndotL = -ndotL;\n          }\n          if (ndotL > 0.0)\n          {\n            diffuse += ndotL * attenuation * lightColor[i];\n            //specular\n            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));\n            if (vdotR > 0.0)\n            {\n              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];\n            }\n          }\n          #ifdef localAmbientOcclusionOn\n            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);\n          #endif          \n        } else {\n          vertLightDirection = lightDirectionVC[i];\n          ndotL = dot(normal.xyz, vertLightDirection);\n          if (ndotL < 0.0 && twoSidedLighting)\n          {\n            ndotL = -ndotL;\n          }\n          if (ndotL > 0.0)\n          {\n            diffuse += ndotL * lightColor[i];\n            //specular\n            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));\n            if (vdotR > 0.0)\n            {\n              specular += pow(vdotR, vSpecularPower) * lightColor[i];\n            }\n          }\n          #ifdef localAmbientOcclusionOn\n            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);\n          #endif          \n        }\n      }\n      #ifdef localAmbientOcclusionOn\n        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;\n      #else \n        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;\n      #endif\n    }\n  #endif \n  #endif\n#endif\n\n//=======================================================================\n// Given a texture value compute the color and opacity\n//\nvec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)\n{\n#ifdef vtkImageLabelOutlineOn\n  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space\n  vec4 centerValue = getTextureValue(centerPosIS);\n  bool pixelOnBorder = false;\n  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));\n\n  // Get alpha of segment from opacity function.\n  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;\n\n  // Only perform outline check on fragments rendering voxels that aren't invisible.\n  // Saves a bunch of needless checks on the background.\n  // TODO define epsilon when building shader?\n  if (float(tColor.a) > 0.01) {\n    for (int i = -outlineThickness; i <= outlineThickness; i++) {\n      for (int j = -outlineThickness; j <= outlineThickness; j++) {\n        if (i == 0 || j == 0) {\n          continue;\n        }\n\n        vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),\n          gl_FragCoord.y + float(j),\n          gl_FragCoord.z, gl_FragCoord.w);\n\n        vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);\n        vec4 value = getTextureValue(neighborPosIS);\n\n        // If any of my neighbours are not the same value as I\n        // am, this means I am on the border of the segment.\n        // We can break the loops\n        if (any(notEqual(value, centerValue))) {\n          pixelOnBorder = true;\n          break;\n        }\n      }\n\n      if (pixelOnBorder == true) {\n        break;\n      }\n    }\n\n    // If I am on the border, I am displayed at full opacity\n    if (pixelOnBorder == true) {\n      tColor.a = outlineOpacity;\n    }\n  }\n\n#else\n  // compute the normal and gradient magnitude if needed\n  // We compute it as a vec4 if possible otherwise a mat4\n  //\n  vec4 goFactor = vec4(1.0,1.0,1.0,1.0);\n\n  // compute the normal vectors as needed\n  #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)\n    #if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)\n      mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);\n      #if !defined(vtkComponent0Proportional)\n        vec4 normal0 = normalMat[0];\n      #endif\n      #if !defined(vtkComponent1Proportional)\n        vec4 normal1 = normalMat[1];\n      #endif\n      #if vtkNumComponents > 2\n        #if !defined(vtkComponent2Proportional)\n          vec4 normal2 = normalMat[2];\n        #endif\n        #if vtkNumComponents > 3\n          #if !defined(vtkComponent3Proportional)\n            vec4 normal3 = normalMat[3];\n          #endif\n        #endif\n      #endif\n    #else\n      vec4 normalLight;\n      #ifdef vtkComputeNormalFromOpacity\n        #ifdef vtkGradientOpacityOn\n          mat3 scalarInterp;  \n          vec3 secondaryGradientMag;  \n          vec4 normal0 = computeNormalForDensity(posIS, tValue.a, tstep, scalarInterp, secondaryGradientMag);  \n          normalLight = computeDensityNormal(tValue.a, normal0.w, scalarInterp,secondaryGradientMag);       \n          if (length(normalLight) == 0.0){  \n            normalLight = normal0;   \n          }                      \n        #else\n          vec3 scalarInterp;  \n          vec4 normal0 = computeNormalForDensity(posIS, tValue.a, tstep, scalarInterp);  \n          if (length(normal0)>0.0){  \n            normalLight = computeDensityNormal(tValue.a,scalarInterp);  \n            if (length(normalLight)==0.0){  \n              normalLight = normal0;  \n            }  \n          }                \n        #endif\n      #else \n        vec4 normal0 = computeNormal(posIS, tValue.a, tstep);  \n        normalLight = normal0;             \n      #endif\n    #endif\n  #endif\n\n  // compute gradient opacity factors as needed\n  #if defined(vtkGradientOpacityOn)\n    #if !defined(vtkComponent0Proportional)\n      goFactor.x =\n        computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);\n    #endif\n    #if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)\n      #if !defined(vtkComponent1Proportional)\n        goFactor.y =\n          computeGradientOpacityFactor(normal1.a, goscale1, goshift1, gomin1, gomax1);\n      #endif\n      #if vtkNumComponents > 2\n        #if !defined(vtkComponent2Proportional)\n          goFactor.z =\n            computeGradientOpacityFactor(normal2.a, goscale2, goshift2, gomin2, gomax2);\n        #endif\n        #if vtkNumComponents > 3\n          #if !defined(vtkComponent3Proportional)\n            goFactor.w =\n              computeGradientOpacityFactor(normal3.a, goscale3, goshift3, gomin3, gomax3);\n          #endif\n        #endif\n      #endif\n    #endif\n  #endif\n\n  // single component is always independent\n  #if vtkNumComponents == 1\n    vec4 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5));\n    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;\n    if (tColor.a < EPSILON){\n      return vec4(0.0);\n    }    \n  #endif\n\n  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2\n    vec4 tColor = mix0*texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0));\n    #if !defined(vtkComponent0Proportional)\n      tColor.a = goFactor.x*mix0*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;\n    #else\n      float pwfValue = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;\n      tColor *= pwfValue;\n      tColor.a *= mix(pwfValue, 1.0, (1.0 - mix0));\n    #endif\n\n    vec3 tColor1 = mix1*texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;\n    #if !defined(vtkComponent1Proportional)\n      tColor.a += goFactor.y*mix1*texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;\n    #else\n      float pwfValue = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;\n      tColor1 *= pwfValue;\n      tColor.a *= mix(pwfValue, 1.0, (1.0 - mix1));\n    #endif\n\n    #if vtkNumComponents >= 3\n      vec3 tColor2 = mix2*texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;\n      #if !defined(vtkComponent2Proportional)\n        tColor.a += goFactor.z*mix2*texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;\n      #else\n        float pwfValue = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;\n        tColor2 *= pwfValue;\n        tColor.a *= mix(pwfValue, 1.0, (1.0 - mix2));\n      #endif\n\n      #if vtkNumComponents >= 4\n        vec3 tColor3 = mix3*texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;\n        #if !defined(vtkComponent3Proportional)\n          tColor.a += goFactor.w*mix3*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;\n        #else\n          float pwfValue = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;\n          tColor3 *= pwfValue;\n          tColor.a *= mix(pwfValue, 1.0, (1.0 - mix3));\n        #endif\n      #endif\n    #endif\n  #else // then not independent\n\n  #if vtkNumComponents == 2\n    float lum = tValue.r * cscale0 + cshift0;\n    float alpha = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;\n    vec4 tColor = vec4(lum, lum, lum, alpha);\n  #endif\n  #if vtkNumComponents == 3\n    vec4 tColor;\n    tColor.r = tValue.r * cscale0 + cshift0;\n    tColor.g = tValue.g * cscale1 + cshift1;\n    tColor.b = tValue.b * cscale2 + cshift2;\n    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;\n  #endif\n  #if vtkNumComponents == 4\n    vec4 tColor;\n    tColor.r = tValue.r * cscale0 + cshift0;\n    tColor.g = tValue.g * cscale1 + cshift1;\n    tColor.b = tValue.b * cscale2 + cshift2;\n    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;\n  #endif\n  #endif // dependent\n\n  // apply lighting if requested as appropriate\n  #if vtkLightComplexity > 0\n    #if !defined(vtkComponent0Proportional) \n      #if vtkNumComponents == 1\n    \n        #ifdef SurfaceShadowOn\n            #if vtkLightComplexity < 3\n                vec3 tColorS = applyLightingDirectional(posIS, tColor, normalLight);\n            #else\n                vec3 tColorS = applyLightingPositional(posIS, tColor, normalLight, IStoVC(posIS));\n            #endif\n        #endif\n\n        #ifdef VolumeShadowOn\n          vec3 tColorVS = applyShadowRay(tColor.rgb, posIS, rayDirVC);\n          #ifdef SurfaceShadowOn\n            float vol_coef = volumetricScatteringBlending * (1.0 - tColor.a / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);\n            tColor.rgb = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;\n          #else\n            tColor.rgb = tColorVS;\n          #endif\n        #else\n            tColor.rgb = tColorS;\n        #endif\n        \n      #else\n        applyLighting(tColor.rgb, normal0);\n      #endif\n    #endif\n\n    #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2\n      #if !defined(vtkComponent1Proportional)\n        applyLighting(tColor1, normal1);\n      #endif\n    #if vtkNumComponents >= 3\n      #if !defined(vtkComponent2Proportional)\n        applyLighting(tColor2, normal2);\n      #endif\n    #if vtkNumComponents >= 4\n      #if !defined(vtkComponent3Proportional)\n        applyLighting(tColor3, normal3);\n      #endif\n    #endif\n    #endif\n    #endif\n  #endif\n\n// perform final independent blend as needed\n#if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2\n  tColor.rgb += tColor1;\n#if vtkNumComponents >= 3\n  tColor.rgb += tColor2;\n#if vtkNumComponents >= 4\n  tColor.rgb += tColor3;\n#endif\n#endif\n#endif\n\n#endif\n\n\n\n\n\n\n\nreturn tColor;\n}\n\nbool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {\n  bool withinRange = false;\n  #if vtkNumComponents == 1\n    if (val.r >= min.r && val.r <= max.r) {\n      withinRange = true;\n    }\n  #endif\n  #if defined(vtkIndependentComponentsOn) && vtkNumComponents == 2\n     if (val.r >= min.r && val.r <= max.r &&\n        val.g >= min.g && val.g <= max.g) {\n      withinRange = true;\n    }\n  #endif\n  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 3\n    if (all(greaterThanEqual(val, ipScalarRangeMin)) &&\n        all(lessThanEqual(val, ipScalarRangeMax))) {\n      withinRange = true;\n    }\n  #endif\n  return withinRange;\n}\n\n//=======================================================================\n// Apply the specified blend mode operation along the ray's path.\n//\nvoid applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)\n{\n  vec3 tstep = 1.0/tdims;\n\n  // start slightly inside and apply some jitter\n  vec3 delta = endIS - posIS;\n  vec3 stepIS = normalize(delta)*sampleDistanceIS;\n  float raySteps = length(delta)/sampleDistanceIS;\n\n  // avoid 0.0 jitter\n  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;\n  float stepsTraveled = jitter;\n\n  // local vars for the loop\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 tValue;\n  vec4 tColor;\n\n  // if we have less than one step then pick the middle point\n  // as our value\n  // if (raySteps <= 1.0)\n  // {\n  //   posIS = (posIS + endIS)*0.5;\n  // }\n\n  // Perform initial step at the volume boundary\n  // compute the scalar\n  tValue = getTextureValue(posIS);\n\n  #if vtkBlendMode == 0 // COMPOSITE_BLEND\n    // now map through opacity and color\n    tColor = getColorForValue(tValue, posIS, tstep);\n\n    // handle very thin volumes\n    if (raySteps <= 1.0)\n    {\n      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);\n      gl_FragData[0] = tColor;\n      return;\n    }\n\n    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);\n    color = vec4(tColor.rgb*tColor.a, tColor.a);\n    posIS += (jitter*stepIS);\n\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // now map through opacity and color\n      tColor = getColorForValue(tValue, posIS, tstep);\n\n      float mix = (1.0 - color.a);\n\n      // this line should not be needed but nvidia seems to not handle\n      // the break correctly on windows/chrome 58 angle\n      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));\n\n      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;\n      stepsTraveled++;\n      posIS += stepIS;\n      if (color.a > 0.99) { color.a = 1.0; break; }\n    }\n\n    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)\n    {\n      posIS = endIS;\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // now map through opacity and color\n      tColor = getColorForValue(tValue, posIS, tstep);\n      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);\n\n      float mix = (1.0 - color.a);\n      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;\n    }\n\n    gl_FragData[0] = vec4(color.rgb/color.a, color.a);\n  #endif\n  #if vtkBlendMode == 1 || vtkBlendMode == 2\n    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND\n    // Find maximum/minimum intensity along the ray.\n\n    // Define the operation we will use (min or max)\n    #if vtkBlendMode == 1\n    #define OP max\n    #else\n    #define OP min\n    #endif\n\n    // If the clipping range is shorter than the sample distance\n    // we can skip the sampling loop along the ray.\n    if (raySteps <= 1.0)\n    {\n      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);\n      return;\n    }\n\n    vec4 value = tValue;\n    posIS += (jitter*stepIS);\n\n    // Sample along the ray until MaximumSamplesValue,\n    // ending slightly inside the total distance\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      // If we have reached the last step, break\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // Update the maximum value if necessary\n      value = OP(tValue, value);\n\n      // Otherwise, continue along the ray\n      stepsTraveled++;\n      posIS += stepIS;\n    }\n\n    // Perform the last step along the ray using the\n    // residual distance\n    posIS = endIS;\n    tValue = getTextureValue(posIS);\n    value = OP(tValue, value);\n\n    // Now map through opacity and color\n    gl_FragData[0] = getColorForValue(value, posIS, tstep);\n  #endif\n  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND\n    vec4 sum = vec4(0.);\n\n    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {\n      sum += tValue;\n    }\n\n    if (raySteps <= 1.0) {\n      gl_FragData[0] = getColorForValue(sum, posIS, tstep);\n      return;\n    }\n\n    posIS += (jitter*stepIS);\n\n    // Sample along the ray until MaximumSamplesValue,\n    // ending slightly inside the total distance\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      // If we have reached the last step, break\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.\n      // Notes:\n      // - We are comparing all values in the texture to see if any of them\n      //   are outside of the scalar range. In the future we might want to allow\n      //   scalar ranges for each component.\n      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {\n        // Sum the values across each step in the path\n        sum += tValue;\n      }\n      stepsTraveled++;\n      posIS += stepIS;\n    }\n\n    // Perform the last step along the ray using the\n    // residual distance\n    posIS = endIS;\n\n    // compute the scalar\n    tValue = getTextureValue(posIS);\n\n    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation\n    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {\n      sum += tValue;\n\n      stepsTraveled++;\n    }\n\n    #if vtkBlendMode == 3 // Average\n      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);\n    #endif\n\n    gl_FragData[0] = getColorForValue(sum, posIS, tstep);\n  #endif\n  #if vtkBlendMode == 5 // RADON\n    float normalizedRayIntensity = 1.0;\n\n    // handle very thin volumes\n    if (raySteps <= 1.0)\n    {\n      tValue = getTextureValue(posIS);\n      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;\n      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));\n      return;\n    }\n\n    posIS += (jitter*stepIS);\n\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar value\n      tValue = getTextureValue(posIS);\n\n      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity\n      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;\n\n      posIS += stepIS;\n      stepsTraveled++;\n    }\n\n    // map normalizedRayIntensity to color\n    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));\n\n  #endif\n}\n\n//=======================================================================\n// Compute a new start and end point for a given ray based\n// on the provided bounded clipping plane (aka a rectangle)\nvoid getRayPointIntersectionBounds(\n  vec3 rayPos, vec3 rayDir,\n  vec3 planeDir, float planeDist,\n  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,\n  float vSize1, float vSize2)\n{\n  float result = dot(rayDir, planeDir);\n  if (abs(result) < 1e-6)\n  {\n    return;\n  }\n  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;\n  vec3 xposVC = rayPos + rayDir*result;\n  vec3 vxpos = xposVC - vOriginVC;\n  vec2 vpos = vec2(\n    dot(vxpos, vPlaneX),\n    dot(vxpos, vPlaneY));\n\n  // on some apple nvidia systems this does not work\n  // if (vpos.x < 0.0 || vpos.x > vSize1 ||\n  //     vpos.y < 0.0 || vpos.y > vSize2)\n  // even just\n  // if (vpos.x < 0.0 || vpos.y < 0.0)\n  // fails\n  // so instead we compute a value that represents in and out\n  //and then compute the return using this value\n  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds\n  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out\n\n  tbounds = mix(\n   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value\n   tbounds, // out value\n   check);  // 0 in 1 out\n}\n\n//=======================================================================\n// given a\n// - ray direction (rayDir)\n// - starting point (vertexVCVSOutput)\n// - bounding planes of the volume\n// - optionally depth buffer values\n// - far clipping plane\n// compute the start/end distances of the ray we need to cast\nvec2 computeRayDistances(vec3 rayDir, vec3 tdims)\n{\n  vec2 dists = vec2(100.0*camFar, -1.0);\n\n  vec3 vSize = vSpacing*tdims;\n\n  // all this is in View Coordinates\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,\n    vSize.y, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,\n    vSize.y, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,\n    vSize.x, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,\n    vSize.x, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,\n    vSize.x, vSize.y);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,\n    vSize.x, vSize.y);\n\n  //VTK::ClipPlane::Impl\n\n  // do not go behind front clipping plane\n  dists.x = max(0.0,dists.x);\n\n  // do not go PAST far clipping plane\n  float farDist = -camThick/rayDir.z;\n  dists.y = min(farDist,dists.y);\n\n  // Do not go past the zbuffer value if set\n  // This is used for intermixing opaque geometry\n  //VTK::ZBuffer::Impl\n\n  return dists;\n}\n\n//=======================================================================\n// Compute the index space starting position (pos) and end\n// position\n//\nvoid computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)\n{\n  // compute starting and ending values in volume space\n  pos = vertexVCVSOutput + dists.x*rayDir;\n  pos = pos - vOriginVC;\n  // convert to volume basis and origin\n  pos = vec3(\n    dot(pos, vPlaneNormal0),\n    dot(pos, vPlaneNormal2),\n    dot(pos, vPlaneNormal4));\n\n  endPos = vertexVCVSOutput + dists.y*rayDir;\n  endPos = endPos - vOriginVC;\n  endPos = vec3(\n    dot(endPos, vPlaneNormal0),\n    dot(endPos, vPlaneNormal2),\n    dot(endPos, vPlaneNormal4));\n\n  float delta = length(endPos - pos);\n\n  pos *= vVCToIJK;\n  endPos *= vVCToIJK;\n\n  float delta2 = length(endPos - pos);\n  sampleDistanceIS = sampleDistance*delta2/delta;\n  #ifdef VolumeShadowOn\n    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;\n  #endif\n}\n\nvoid main()\n{\n\n  if (cameraParallel == 1)\n  {\n    // Camera is parallel, so the rayDir is just the direction of the camera.\n    rayDirVC = vec3(0.0, 0.0, -1.0);\n  } else {\n    // camera is at 0,0,0 so rayDir for perspective is just the vc coord\n    rayDirVC = normalize(vertexVCVSOutput);\n  }\n\n  vec3 tdims = vec3(volumeDimensions);\n\n  // compute the start and end points for the ray\n  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);\n\n  // do we need to composite? aka does the ray have any length\n  // If not, bail out early\n  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)\n  {\n    discard;\n  }\n\n  // IS = Index Space\n  vec3 posIS;\n  vec3 endIS;\n  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);\n\n  // Perform the blending operation along the ray\n  applyBlend(posIS, endIS, tdims);\n}\n";function Fo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function No(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Uo=ct,_o=lt;function Go(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}function zo(e,t){t.classHierarchy.push("vtkOpenGLVolumeMapper"),e.buildPass=function(){t.zBufferTexture=null},e.zBufferPass=function(e,n){if(e){var r=n.getZBufferTexture();r!==t.zBufferTexture&&(t.zBufferTexture=r)}},e.opaqueZBufferPass=function(t,n){return e.zBufferPass(t,n)},e.volumePass=function(n,r){if(n){t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t.context=t._openGLRenderWindow.getContext(),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow),t.jitterTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.framebuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.scalarTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.colorTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.opacityTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.openGLVolume=e.getFirstAncestorOfType("vtkOpenGLVolume");var a=t.openGLVolume.getRenderable();t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer");var o=t._openGLRenderer.getRenderable();t.openGLCamera=t._openGLRenderer.getViewNodeFor(o.getActiveCamera()),e.renderPiece(o,a)}},e.buildShaders=function(t,n,r){e.getShaderTemplate(t,n,r),e.replaceShaderValues(t,n,r)},e.getShaderTemplate=function(e,t,n){e.Vertex=Bo,e.Fragment=Vo,e.Geometry=""},e.replaceShaderValues=function(n,r,a){var o=n.Fragment,i=a.getProperty().getInterpolationType();i===Do.LINEAR&&(o=Pa.substitute(o,"//VTK::TrilinearOn","#define vtkTrilinearOn").result);var s=a.getProperty().getUseLabelOutline();!0===s&&(o=Pa.substitute(o,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result);var l=t.scalarTexture.getComponents();o=Pa.substitute(o,"//VTK::NumComponents","#define vtkNumComponents ".concat(l)).result;var c=a.getProperty().getIndependentComponents();if(c){o=Pa.substitute(o,"//VTK::IndependentComponentsOn","#define vtkIndependentComponentsOn").result;for(var u=[],f=0;f<l;f++)a.getProperty().getOpacityMode(f)===ko.PROPORTIONAL&&u.push("#define vtkComponent".concat(f,"Proportional"));u.length>0&&(o=Pa.substitute(o,"//VTK::vtkProportionalComponents",u.join("\n")).result)}var d=t.currentInput.getSpatialExtent(),p=t.currentInput.getSpacing(),m=new Float64Array(3);xr(m,(d[1]-d[0])*p[0],(d[3]-d[2])*p[1],(d[5]-d[4])*p[2]);var g=yr(m)/t.renderable.getSampleDistance();o=Pa.substitute(o,"//VTK::MaximumSamplesValue","".concat(Math.ceil(g))).result,o=Pa.substitute(o,"//VTK::LightComplexity","#define vtkLightComplexity ".concat(t.lastLightComplexity)).result,t.lastLightComplexity>0&&(t.renderable.getVolumetricScatteringBlending()>0&&(o=Pa.substitute(o,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),t.renderable.getVolumetricScatteringBlending()<1&&(o=Pa.substitute(o,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),0===t.renderable.getVolumetricScatteringBlending()&&t.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0&&(o=Pa.substitute(o,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result)),t.gopacity=a.getProperty().getUseGradientOpacity(0);for(var v=1;c&&!t.gopacity&&v<l;++v)a.getProperty().getUseGradientOpacity(v)&&(t.gopacity=!0);t.gopacity&&(o=Pa.substitute(o,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),t.renderable.getComputeNormalFromOpacity()&&(o=Pa.substitute(o,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),null!==t.zBufferTexture&&(o=Pa.substitute(o,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpWidth;","uniform float vpHeight;"]).result,o=Pa.substitute(o,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpWidth, gl_FragCoord.y/vpHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {","zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}\n","zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),o=Pa.substitute(o,"//VTK::BlendMode","".concat(t.renderable.getBlendMode())).result,n.Fragment=o,e.replaceShaderLight(n,r,a),e.replaceShaderClippingPlane(n,r,a)},e.replaceShaderLight=function(e,n,r){if(0!==t.lastLightComplexity){var a=e.Fragment,o=0;n.getLights().forEach((function(e){e.getSwitch()&&(o+=1)})),a=Pa.substitute(a,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;","uniform vec3 lightColor[".concat(o,"];"),"uniform vec3 lightDirectionVC[".concat(o,"]; // normalized"),"uniform vec3 lightHalfAngleVC[".concat(o,"];"),"//VTK::Light::Dec"],!1).result,3===t.lastLightComplexity&&(a=Pa.substitute(a,"//VTK::Light::Dec",["uniform vec3 lightPositionVC[".concat(o,"];"),"uniform vec3 lightAttenuation[".concat(o,"];"),"uniform float lightConeAngle[".concat(o,"];"),"uniform float lightExponent[".concat(o,"];"),"uniform int lightPositional[".concat(o,"];")],!1).result),t.renderable.getVolumetricScatteringBlending()>0&&(a=Pa.substitute(a,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),0===t.renderable.getVolumetricScatteringBlending()&&t.renderable.getLocalAmbientOcclusion()&&r.getProperty().getAmbient()>0&&(a=Pa.substitute(a,"//VTK::LAO::Dec",["uniform int kernelRadius;","uniform vec2 kernelSample[".concat(t.renderable.getLAOKernelRadius(),"];"),"uniform int kernelSize;"],!1).result),e.Fragment=a}},e.replaceShaderClippingPlane=function(e,n,r){var a=e.Fragment;if(t.renderable.getClippingPlanes().length>0){var o=t.renderable.getClippingPlanes().length;a=Pa.substitute(a,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","//VTK::ClipPlane::Dec"],!1).result,a=Pa.substitute(a,"//VTK::ClipPlane::Impl",["for(int i = 0; i < ".concat(o,"; i++) {"),"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}e.Fragment=a},e.getNeedToRebuildShaders=function(n,r,a){var o=0;a.getProperty().getShade()&&t.renderable.getBlendMode()===Lo.COMPOSITE_BLEND&&(o=0,t.numberOfLights=0,r.getLights().forEach((function(e){var n=e.getSwitch();n>0&&(t.numberOfLights++,0===o&&(o=1)),1===o&&(t.numberOfLights>1||1!==e.getIntensity()||!e.lightTypeIsHeadLight())&&(o=2),o<3&&e.getPositional()&&(o=3)})));var i=!1;t.lastLightComplexity!==o&&(t.lastLightComplexity=o,i=!0);var s=t.scalarTexture.getComponents(),l=a.getProperty().getIndependentComponents(),c=!1,u=[];if(l){for(var f=0;f<s;f++)u.push(a.getProperty().getOpacityMode(f));u.length>0&&(c=!0)}var d=t.currentInput.getSpatialExtent(),p=t.currentInput.getSpacing(),m=new Float64Array(3);xr(m,(d[1]-d[0])*p[0],(d[3]-d[2])*p[1],(d[5]-d[4])*p[2]);var g=yr(m)/t.renderable.getSampleDistance(),v={interpolationType:a.getProperty().getInterpolationType(),useLabelOutline:a.getProperty().getUseLabelOutline(),numComp:s,usesProportionalComponents:c,iComps:l,maxSamples:g,useGradientOpacity:a.getProperty().getUseGradientOpacity(0),blendMode:t.renderable.getBlendMode(),proportionalComponents:u};return t.previousState&&t.previousState.interpolationType===v.interpolationType&&t.previousState.useLabelOutline===v.useLabelOutline&&t.previousState.numComp===v.numComp&&t.previousState.usesProportionalComponents===v.usesProportionalComponents&&t.previousState.iComps===v.iComps&&t.previousState.maxSamples===v.maxSamples&&t.previousState.useGradientOpacity===v.useGradientOpacity&&t.previousState.blendMode===v.blendMode&&Go(t.previousState.proportionalComponents,v.proportionalComponents)?!!(0===n.getProgram()||i||t.lastHaveSeenDepthRequest!==t.haveSeenDepthRequest||!!t.lastZBufferTexture!==!!t.zBufferTexture||n.getShaderSourceTime().getMTime()<e.getMTime()||n.getShaderSourceTime().getMTime()<t.renderable.getMTime())&&(t.lastZBufferTexture=t.zBufferTexture,!0):(t.previousState=No({},v),!0)},e.updateShaders=function(n,r,a){if(t.lastBoundBO=n,e.getNeedToRebuildShaders(n,r,a)){var o={Vertex:null,Fragment:null,Geometry:null};e.buildShaders(o,r,a);var i=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);i!==n.getProgram()&&(n.setProgram(i),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),e.setMapperShaderParameters(n,r,a),e.setCameraShaderParameters(n,r,a),e.setPropertyShaderParameters(n,r,a),e.getClippingPlaneShaderParameters(n,r,a)},e.setMapperShaderParameters=function(e,n,r){var a=e.getProgram();e.getCABO().getElementCount()&&(t.VBOBuildTime.getMTime()>e.getAttributeUpdateTime().getMTime()||e.getShaderSourceTime().getMTime()>e.getAttributeUpdateTime().getMTime())&&(a.isAttributeUsed("vertexDC")&&(e.getVAO().addAttributeArray(a,e.getCABO(),"vertexDC",e.getCABO().getVertexOffset(),e.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||_o("Error setting vertexDC in shader VAO.")),e.getAttributeUpdateTime().modified()),a.setUniformi("texture1",t.scalarTexture.getTextureUnit()),a.setUniformf("sampleDistance",t.renderable.getSampleDistance());for(var o=t.scalarTexture.getVolumeInfo(),i=t.renderable.getIpScalarRange(),s=[],l=[],c=0;c<4;c++)s[c]=i[0]*o.dataComputedScale[c]+o.dataComputedOffset[c],l[c]=i[1]*o.dataComputedScale[c]+o.dataComputedOffset[c],s[c]=(s[c]-o.offset[c])/o.scale[c],l[c]=(l[c]-o.offset[c])/o.scale[c];if(a.setUniform4f("ipScalarRangeMin",s[0],s[1],s[2],s[3]),a.setUniform4f("ipScalarRangeMax",l[0],l[1],l[2],l[3]),null!==t.zBufferTexture){a.setUniformi("zBufferTexture",t.zBufferTexture.getTextureUnit());var u=t._useSmallViewport?[t._smallViewportWidth,t._smallViewportHeight]:t._openGLRenderWindow.getFramebufferSize();a.setUniformf("vpWidth",u[0]),a.setUniformf("vpHeight",u[1])}},e.setCameraShaderParameters=function(n,r,a){var o=t.openGLCamera.getKeyMatrices(r),i=t.openGLVolume.getKeyMatrices();X(t.modelToView,o.wcvc,i.mcwc);var s=n.getProgram(),l=t.openGLCamera.getRenderable(),c=l.getClippingRange();s.setUniformf("camThick",c[1]-c[0]),s.setUniformf("camNear",c[0]),s.setUniformf("camFar",c[1]);for(var u=t.currentInput.getBounds(),f=t.currentInput.getDimensions(),d=new Float64Array(3),p=new Float64Array(3),m=1,g=-1,v=1,h=-1,y=0;y<8;++y){if(xr(d,u[y%2],u[2+Math.floor(y/2)%2],u[4+Math.floor(y/4)]),Er(d,d,t.modelToView),!l.getParallelProjection()){Pr(p,d);var b=-c[0]/d[2];wr(d,p,b)}Er(d,d,o.vcpc),m=Math.min(d[0],m),g=Math.max(d[0],g),v=Math.min(d[1],v),h=Math.max(d[1],h)}s.setUniformf("dcxmin",m),s.setUniformf("dcxmax",g),s.setUniformf("dcymin",v),s.setUniformf("dcymax",h),s.isUniformUsed("cameraParallel")&&s.setUniformi("cameraParallel",l.getParallelProjection());var x=t.currentInput.getSpatialExtent(),T=t.currentInput.getSpacing(),S=new Float64Array(3);xr(S,(x[1]-x[0])*T[0],(x[3]-x[2])*T[1],(x[5]-x[4])*T[2]),s.setUniform3f("vSpacing",T[0],T[1],T[2]),xr(d,x[0],x[2],x[4]),t.currentInput.indexToWorldVec3(d,d),Er(d,d,t.modelToView),s.setUniform3f("vOriginVC",d[0],d[1],d[2]);var O=t.currentInput.getIndexToWorld();X(t.idxToView,t.modelToView,O),ce(t.idxNormalMatrix,o.normalMatrix,i.normalMatrix),ce(t.idxNormalMatrix,t.idxNormalMatrix,t.currentInput.getDirectionByReference());var w=yr(S)/t.renderable.getSampleDistance();w>t.renderable.getMaximumSamplesPerRay()&&Uo("The number of steps required ".concat(Math.ceil(w)," is larger than the\n        specified maximum number of steps ").concat(t.renderable.getMaximumSamplesPerRay(),".\n        Please either change the\n        volumeMapper sampleDistance or its maximum number of samples."));var A=new Float64Array(3);if(xr(A,1,1,1),Or(A,A,S),s.setUniform3f("vVCToIJK",A[0],A[1],A[2]),s.setUniform3i("volumeDimensions",f[0],f[1],f[2]),!t._openGLRenderWindow.getWebgl2()){var P=t.scalarTexture.getVolumeInfo();s.setUniformf("texWidth",t.scalarTexture.getWidth()),s.setUniformf("texHeight",t.scalarTexture.getHeight()),s.setUniformi("xreps",P.xreps),s.setUniformi("xstride",P.xstride),s.setUniformi("ystride",P.ystride)}for(var I=new Float64Array(3),C=new Float64Array(3),E=0;E<6;++E){switch(E){case 1:xr(I,-1,0,0),xr(C,x[0],x[2],x[4]);break;case 2:xr(I,0,1,0),xr(C,x[1],x[3],x[5]);break;case 3:xr(I,0,-1,0),xr(C,x[0],x[2],x[4]);break;case 4:xr(I,0,0,1),xr(C,x[1],x[3],x[5]);break;case 5:xr(I,0,0,-1),xr(C,x[0],x[2],x[4]);break;case 0:default:xr(I,1,0,0),xr(C,x[1],x[3],x[5]);break}Mr(I,I,t.idxNormalMatrix),Er(C,C,t.idxToView);var M=-1*Ir(C,I);s.setUniform3f("vPlaneNormal".concat(E),I[0],I[1],I[2]),s.setUniformf("vPlaneDistance".concat(E),M)}if(a.getProperty().getUseLabelOutline()){var R=t.currentInput,D=R.getWorldToIndex();s.setUniformMatrix("vWCtoIDX",D);var k=r.getActiveCamera(),L=k.getClippingRange(),B=ge(L,2),V=B[0],F=B[1],N=k.getDistance();k.setClippingRange(N,N+.1);var U=t.openGLCamera.getKeyMatrices(r);H(t.projectionToWorld,U.wcpc),k.setClippingRange(V,F),t.openGLCamera.getKeyMatrices(r),s.setUniformMatrix("PCWCMatrix",t.projectionToWorld);var _=e.getRenderTargetSize();s.setUniformf("vpWidth",_[0]),s.setUniformf("vpHeight",_[1]);var G=e.getRenderTargetOffset();s.setUniformf("vpOffsetX",G[0]/_[0]),s.setUniformf("vpOffsetY",G[1]/_[1])}if(H(t.projectionToView,o.vcpc),s.setUniformMatrix("PCVCMatrix",t.projectionToView),0!==t.lastLightComplexity){var z=0,j=[],W=[],K=[];if(r.getLights().forEach((function(e){var t=e.getSwitch();if(t>0){var n=e.getColor(),r=e.getIntensity();j[0+3*z]=n[0]*r,j[1+3*z]=n[1]*r,j[2+3*z]=n[2]*r;var a=e.getDirection();xr(I,a[0],a[1],a[2]),Mr(I,I,o.normalMatrix),Pr(I,I),W[0+3*z]=I[0],W[1+3*z]=I[1],W[2+3*z]=I[2],K[0+3*z]=-.5*I[0],K[1+3*z]=-.5*I[1],K[2+3*z]=-.5*(I[2]-1),z++}})),s.setUniformi("twoSidedLighting",r.getTwoSidedLighting()),s.setUniformi("lightNum",z),s.setUniform3fv("lightColor",j),s.setUniform3fv("lightDirectionVC",W),s.setUniform3fv("lightHalfAngleVC",K),3===t.lastLightComplexity){z=0;var q=[],Y=[],Z=[],$=[],J=[];r.getLights().forEach((function(e){var n=e.getSwitch();if(n>0){var r=e.getAttenuationValues();Y[0+3*z]=r[0],Y[1+3*z]=r[1],Y[2+3*z]=r[2],$[z]=e.getExponent(),Z[z]=e.getConeAngle(),J[z]=e.getPositional();var a=e.getTransformedPosition();Er(a,a,t.modelToView),q[0+3*z]=a[0],q[1+3*z]=a[1],q[2+3*z]=a[2],z+=1}})),s.setUniform3fv("lightPositionVC",q),s.setUniform3fv("lightAttenuation",Y),s.setUniformfv("lightConeAngle",Z),s.setUniformfv("lightExponent",$),s.setUniformiv("lightPositional",J)}if(t.renderable.getVolumetricScatteringBlending()>0&&(s.setUniformf("giReach",t.renderable.getGlobalIlluminationReach()),s.setUniformf("volumetricScatteringBlending",t.renderable.getVolumetricScatteringBlending()),s.setUniformf("volumeShadowSamplingDistFactor",t.renderable.getVolumeShadowSamplingDistFactor()),s.setUniformf("anisotropy",t.renderable.getAnisotropy()),s.setUniformf("anisotropy2",Math.pow(t.renderable.getAnisotropy(),2))),0===t.renderable.getVolumetricScatteringBlending()&&t.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0){var Q=t.renderable.getLAOKernelSize();s.setUniformi("kernelSize",Q);for(var ee=[],te=0;te<Q;te++)ee[2*te]=.5*Math.random(),ee[2*te+1]=.5*Math.random();s.setUniform2fv("kernelSample",ee),s.setUniformi("kernelRadius",t.renderable.getLAOKernelRadius())}}},e.setPropertyShaderParameters=function(e,n,r){var a=e.getProgram();a.setUniformi("ctexture",t.colorTexture.getTextureUnit()),a.setUniformi("otexture",t.opacityTexture.getTextureUnit()),a.setUniformi("jtexture",t.jitterTexture.getTextureUnit());var o=t.scalarTexture.getVolumeInfo(),i=r.getProperty(),s=t.scalarTexture.getComponents(),l=r.getProperty().getIndependentComponents();if(l&&s>=2)for(var c=0;c<s;c++)a.setUniformf("mix".concat(c),r.getProperty().getComponentWeight(c));for(var u=0;u<s;u++){var f=l?u:0,d=o.scale[u],p=i.getScalarOpacity(f),m=p.getRange(),g=d/(m[1]-m[0]),v=(o.offset[u]-m[0])/(m[1]-m[0]);a.setUniformf("oshift".concat(u),v),a.setUniformf("oscale".concat(u),g);var h=i.getRGBTransferFunction(f),y=h.getRange(),b=(o.offset[u]-y[0])/(y[1]-y[0]),x=d/(y[1]-y[0]);a.setUniformf("cshift".concat(u),b),a.setUniformf("cscale".concat(u),x)}if(t.gopacity)if(l)for(var T=0;T<s;++T){var S=o.scale[T],O=i.getUseGradientOpacity(T);if(O){var w=i.getGradientOpacityMinimumOpacity(T),A=i.getGradientOpacityMaximumOpacity(T);a.setUniformf("gomin".concat(T),w),a.setUniformf("gomax".concat(T),A);var P=[i.getGradientOpacityMinimumValue(T),i.getGradientOpacityMaximumValue(T)];a.setUniformf("goscale".concat(T),S*(A-w)/(P[1]-P[0])),a.setUniformf("goshift".concat(T),-P[0]*(A-w)/(P[1]-P[0])+w)}else a.setUniformf("gomin".concat(T),1),a.setUniformf("gomax".concat(T),1),a.setUniformf("goscale".concat(T),0),a.setUniformf("goshift".concat(T),1)}else{var I=o.scale[s-1],C=i.getGradientOpacityMinimumOpacity(0),E=i.getGradientOpacityMaximumOpacity(0);a.setUniformf("gomin0",C),a.setUniformf("gomax0",E);var M=[i.getGradientOpacityMinimumValue(0),i.getGradientOpacityMaximumValue(0)];a.setUniformf("goscale0",I*(E-C)/(M[1]-M[0])),a.setUniformf("goshift0",-M[0]*(E-C)/(M[1]-M[0])+C)}var R=r.getProperty().getUseLabelOutline();if(!0===R){var D=r.getProperty().getLabelOutlineThickness(),k=r.getProperty().getLabelOutlineOpacity();a.setUniformi("outlineThickness",D),a.setUniformf("outlineOpacity",k)}t.lastLightComplexity>0&&(a.setUniformf("vAmbient",i.getAmbient()),a.setUniformf("vDiffuse",i.getDiffuse()),a.setUniformf("vSpecular",i.getSpecular()),a.setUniformf("vSpecularPower",i.getSpecularPower()))},e.getClippingPlaneShaderParameters=function(e,n,r){if(t.renderable.getClippingPlanes().length>0){for(var a=t.openGLCamera.getKeyMatrices(n),o=[],i=[],s=t.renderable.getClippingPlanes(),l=s.length,c=0;c<l;++c){var u=s[c].getNormal(),f=s[c].getOrigin();Mr(u,u,a.normalMatrix),Er(f,f,a.wcvc);var d=-1*Ir(f,u);o.push(u[0]),o.push(u[1]),o.push(u[2]),i.push(d)}var p=e.getProgram();p.setUniform3fv("vClipPlaneNormals",o),p.setUniformfv("vClipPlaneDistances",i)}},e.delete=Gt((function(){t._animationRateSubscription&&(t._animationRateSubscription.unsubscribe(),t._animationRateSubscription=null)}),e.delete),e.getRenderTargetSize=function(){if(t._useSmallViewport)return[t._smallViewportWidth,t._smallViewportHeight];var e=t._openGLRenderer.getTiledSizeAndOrigin(),n=e.usize,r=e.vsize;return[n,r]},e.getRenderTargetOffset=function(){var e=t._openGLRenderer.getTiledSizeAndOrigin(),n=e.lowerLeftU,r=e.lowerLeftV;return[n,r]},e.renderPieceStart=function(n,r){var a=n.getVTKWindow().getInteractor();if(t._useSmallViewport=!1,a.isAnimating()&&t._lastScale>1.5&&(t._useSmallViewport=!0),t._animationRateSubscription||(t._animationRateSubscription=a.onAnimationFrameRateUpdate((function(){if(t.renderable.getAutoAdjustSampleDistances()){var e=a.getRecentAnimationFrameRate(),n=a.getDesiredUpdateRate()/e;(n>1.15||n<.85)&&(t._lastScale*=n),t._lastScale>400&&(t._lastScale=400),t._lastScale<1.5&&(t._lastScale=1.5)}else t._lastScale=t.renderable.getImageSampleDistance()*t.renderable.getImageSampleDistance();var r=t._openGLRenderWindow.getFramebufferSize();t._smallViewportWidth=Math.ceil(r[0]/Math.sqrt(t._lastScale)),t._smallViewportHeight=Math.ceil(r[1]/Math.sqrt(t._lastScale))}))),t._useSmallViewport){var o=t._openGLRenderWindow.getFramebufferSize();if(t._smallViewportHeight>o[1]&&(t._smallViewportHeight=o[1]),t._smallViewportWidth>o[0]&&(t._smallViewportWidth=o[0]),t.framebuffer.saveCurrentBindingsAndBuffers(),null===t.framebuffer.getGLFramebuffer())t.framebuffer.create(o[0],o[1]),t.framebuffer.populateFramebuffer();else{var i=t.framebuffer.getSize();i[0]===o[0]&&i[1]===o[1]||(t.framebuffer.create(o[0],o[1]),t.framebuffer.populateFramebuffer())}t.framebuffer.bind();var s=t.context;s.clearColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clear(s.COLOR_BUFFER_BIT),s.viewport(0,0,t._smallViewportWidth,t._smallViewportHeight),t.fvp=[t._smallViewportWidth/o[0],t._smallViewportHeight/o[1]]}t.context.disable(t.context.DEPTH_TEST),e.updateBufferObjects(n,r);var l=r.getProperty().getInterpolationType();l===Do.NEAREST?(t.scalarTexture.setMinificationFilter(Ua.NEAREST),t.scalarTexture.setMagnificationFilter(Ua.NEAREST)):(t.scalarTexture.setMinificationFilter(Ua.LINEAR),t.scalarTexture.setMagnificationFilter(Ua.LINEAR)),t.lastBoundBO=null,null!==t.zBufferTexture&&t.zBufferTexture.activate()},e.renderPieceDraw=function(n,r){var a=t.context;t.scalarTexture.activate(),t.opacityTexture.activate(),t.colorTexture.activate(),t.jitterTexture.activate(),e.updateShaders(t.tris,n,r),a.drawArrays(a.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release(),t.scalarTexture.deactivate(),t.colorTexture.deactivate(),t.opacityTexture.deactivate(),t.jitterTexture.deactivate()},e.renderPieceFinish=function(e,n){if(null!==t.zBufferTexture&&t.zBufferTexture.deactivate(),t._useSmallViewport){if(t.framebuffer.restorePreviousBindingsAndBuffers(),null===t.copyShader){t.copyShader=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join("\n"),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join("\n"),"");var r=t.copyShader;t.copyVAO=Ra.newInstance(),t.copyVAO.setOpenGLRenderWindow(t._openGLRenderWindow),t.tris.getCABO().bind(),t.copyVAO.addAttributeArray(r,t.tris.getCABO(),"vertexDC",t.tris.getCABO().getVertexOffset(),t.tris.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||_o("Error setting vertexDC in copy shader VAO.")}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(t.copyShader);var a=t._openGLRenderWindow.getFramebufferSize();t.context.viewport(0,0,a[0],a[1]);var o=t.framebuffer.getColorTexture();o.activate(),t.copyShader.setUniformi("texture",o.getTextureUnit()),t.copyShader.setUniform2f("tfactor",t.fvp[0],t.fvp[1]);var i=t.context;i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),t.context.drawArrays(t.context.TRIANGLES,0,t.tris.getCABO().getElementCount()),o.deactivate(),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}},e.renderPiece=function(n,r){e.invokeEvent({type:"StartEvent"}),t.renderable.update(),t.currentInput=t.renderable.getInputData(),e.invokeEvent({type:"EndEvent"}),t.currentInput?(e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)):_o("No input!")},e.computeBounds=function(n,r){e.getInput()?t.bounds=e.getInput().getBounds():Jn(t.Bounds)},e.updateBufferObjects=function(t,n){e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=function(n,r){return t.VBOBuildTime.getMTime()<e.getMTime()||t.VBOBuildTime.getMTime()<r.getMTime()||t.VBOBuildTime.getMTime()<t.renderable.getMTime()||t.VBOBuildTime.getMTime()<r.getProperty().getMTime()||t.VBOBuildTime.getMTime()<t.currentInput.getMTime()},e.buildBufferObjects=function(e,n){var r=t.currentInput;if(r){var a=r.getPointData()&&r.getPointData().getScalars();if(a){var o=n.getProperty();if(!t.jitterTexture.getHandle()){for(var i=new Uint8Array(1024),s=0;s<1024;++s)i[s]=255*Math.random();t.jitterTexture.setMinificationFilter(Ua.LINEAR),t.jitterTexture.setMagnificationFilter(Ua.LINEAR),t.jitterTexture.create2DFromRaw(32,32,1,kn.UNSIGNED_CHAR,i)}var l=a.getNumberOfComponents(),c=o.getIndependentComponents(),u=c?l:1,f="".concat(o.getMTime());if(t.opacityTextureString!==f){for(var d=1024,p=2*d*u,m=new Float32Array(p),g=new Float32Array(d),v=0;v<u;++v){var h=o.getScalarOpacity(v),y=t.renderable.getSampleDistance()/o.getScalarOpacityUnitDistance(v),b=h.getRange();h.getTable(b[0],b[1],d,g,1);for(var x=0;x<d;++x)m[v*d*2+x]=1-Math.pow(1-g[x],y),m[v*d*2+x+d]=m[v*d*2+x]}if(t.opacityTexture.releaseGraphicsResources(t._openGLRenderWindow),t.opacityTexture.setMinificationFilter(Ua.LINEAR),t.opacityTexture.setMagnificationFilter(Ua.LINEAR),t._openGLRenderWindow.getWebgl2()||t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear"))t.opacityTexture.create2DFromRaw(d,2*u,1,kn.FLOAT,m);else{for(var T=new Uint8Array(p),S=0;S<p;++S)T[S]=255*m[S];t.opacityTexture.create2DFromRaw(d,2*u,1,kn.UNSIGNED_CHAR,T)}t.opacityTextureString=f}if(f="".concat(o.getMTime()),t.colorTextureString!==f){for(var O=1024,w=2*O*u*3,A=new Uint8Array(w),P=new Float32Array(3*O),I=0;I<u;++I){var C=o.getRGBTransferFunction(I),E=C.getRange();C.getTable(E[0],E[1],O,P,1);for(var M=0;M<3*O;++M)A[I*O*6+M]=255*P[M],A[I*O*6+M+3*O]=255*P[M]}t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.setMinificationFilter(Ua.LINEAR),t.colorTexture.setMagnificationFilter(Ua.LINEAR),t.colorTexture.create2DFromRaw(O,2*u,3,kn.UNSIGNED_CHAR,A),t.colorTextureString=f}if(f="".concat(r.getMTime()),t.scalarTextureString!==f){var R=r.getDimensions();t.scalarTexture.setOglNorm16Ext(t.context.getExtension("EXT_texture_norm16")),t.scalarTexture.releaseGraphicsResources(t._openGLRenderWindow),t.scalarTexture.resetFormatAndType(),t.scalarTexture.create3DFilterableFromRaw(R[0],R[1],R[2],l,a.getDataType(),a.getData(),t.renderable.getPreferSizeOverAccuracy()),t.scalarTextureString=f}if(!t.tris.getCABO().getElementCount()){for(var D=new Float32Array(12),k=0;k<4;k++)D[3*k]=k%2*2-1,D[3*k+1]=k>1?1:-1,D[3*k+2]=-1;var L=new Uint16Array(8);L[0]=3,L[1]=0,L[2]=1,L[3]=3,L[4]=3,L[5]=0,L[6]=3,L[7]=2;var B=vr.newInstance({numberOfComponents:3,values:D});B.setName("points");var V=vr.newInstance({numberOfComponents:1,values:L});t.tris.getCABO().createVBO(V,"polys",ra.SURFACE,{points:B,cellOffset:0})}t.VBOBuildTime.modified()}}}}var jo={context:null,VBOBuildTime:null,scalarTexture:null,scalarTextureString:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lastLightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function Wo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,jo,n),un.extend(e,t,n),t.VBOBuildTime={},Pt(t.VBOBuildTime,{mtime:0}),t.tris=Fa.newInstance(),t.scalarTexture=ao.newInstance(),t.opacityTexture=ao.newInstance(),t.colorTexture=ao.newInstance(),t.jitterTexture=ao.newInstance(),t.jitterTexture.setWrapS(Na.REPEAT),t.jitterTexture.setWrapT(Na.REPEAT),t.framebuffer=Ro.newInstance(),t.idxToView=W(new Float64Array(16)),t.idxNormalMatrix=se(new Float64Array(9)),t.modelToView=W(new Float64Array(16)),t.projectionToView=W(new Float64Array(16)),t.projectionToWorld=W(new Float64Array(16)),t._lastScale=1,Dt(e,t,["context"]),zo(e,t)}var Ko=_t(Wo,"vtkOpenGLVolumeMapper");hn("vtkVolumeMapper",Ko);var Ho=st;function Xo(e,t){t.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),e.opaquePass=function(n,r){t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent();var a=t._openGLRenderer.getAspectRatio(),o=t._openGLRenderer?t._openGLRenderer.getRenderable().getActiveCamera():null,i=t._openGLRenderer.getTiledSizeAndOrigin(),s=null;if(t.renderable.getUseZValues()){var l=r.getZBufferTexture(),c=Math.floor(l.getWidth()),u=Math.floor(l.getHeight()),f=t._openGLRenderWindow.getContext();l.bind();var d=r.getFramebuffer();d?d.saveCurrentBindingsAndBuffers():Ho("No framebuffer to save/restore");var p=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,p),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(c*u*4),f.viewport(0,0,c,u),f.readPixels(0,0,c,u,f.RGBA,f.UNSIGNED_BYTE,s)),d&&d.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(p)}t.renderable.invokeCallback(t.renderable.getInputData(),o,a,i,s)},e.queryPass=function(e,n){e&&t.renderable.getUseZValues()&&n.requestDepth()}}var qo={};function Yo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,qo,n),un.extend(e,t,n),Xo(e,t)}var Zo=_t(Yo,"vtkOpenGLPixelSpaceCallbackMapper");hn("vtkPixelSpaceCallbackMapper",Zo);var $o=Object.create(null);function Jo(e,t){$o[e]=t}function Qo(e,t){t.classHierarchy.push("vtkWebGPUViewNodeFactory")}var ei={};function ti(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ei,n),t.overrides=$o,gn.extend(e,t,n),Qo(e,t)}nn.newInstance(ti,"vtkWebGPUViewNodeFactory");function ni(e,t){t.classHierarchy.push("vtkWebGPUCamera"),e.getProjectionMatrix=function(e,n,r,a){if(W(e),t.renderable.getParallelProjection()){var o=t.renderable.getParallelScale(),i=o*n,s=o,l=(a[0]-1)*i,c=(a[0]+1)*i,u=(a[1]-1)*s,f=(a[1]+1)*s,d=1/(c-l),p=1/(f-u);e[0]=2*d,e[5]=2*p,e[10]=1/(r[1]-r[0]),e[12]=(c+l)*d,e[13]=(f+u)*p,e[14]=r[1]/(r[1]-r[0])}else{var m,g,v=Math.tan(Math.PI*t.renderable.getViewAngle()/360);!0===t.renderable.getUseHorizontalViewAngle()?(m=r[0]*v,g=r[0]*v/n):(m=r[0]*v*n,g=r[0]*v);var h=(a[0]-1)*m,y=(a[0]+1)*m,b=(a[1]-1)*g,x=(a[1]+1)*g;e[0]=2*r[0]/(y-h),e[5]=2*r[0]/(x-b),e[12]=(h+y)/(y-h),e[13]=(b+x)/(x-b),e[10]=0,e[14]=r[0],e[11]=-1,e[15]=0}},e.convertToOpenGLDepth=function(e){if(t.renderable.getParallelProjection())return 1-e;var n=t.renderable.getClippingRangeByReference(),r=-n[0]/e;return r=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(r*(n[1]-n[0])),.5*r+.5},e.getKeyMatrices=function(n){var r=n.getRenderable(),a=n.getParent();if(Math.max(a.getMTime(),e.getMTime(),r.getMTime(),t.renderable.getMTime(),n.getStabilizedTime())>t.keyMatrixTime.getMTime()){var o=t.renderable.getViewMatrix();j(t.keyMatrices.normalMatrix,o),t.keyMatrices.normalMatrix[3]=0,t.keyMatrices.normalMatrix[7]=0,t.keyMatrices.normalMatrix[11]=0,H(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),K(t.keyMatrices.wcvc,o);var i=n.getStabilizedCenterByReference();q(t.keyMatrices.scvc,t.keyMatrices.wcvc,i);var s=n.getAspectRatio(),l=t.renderable.getClippingRangeByReference();e.getProjectionMatrix(t.keyMatrices.vcpc,s,l,t.renderable.getWindowCenterByReference()),X(t.keyMatrices.scpc,t.keyMatrices.vcpc,t.keyMatrices.scvc),H(t.keyMatrices.pcsc,t.keyMatrices.scpc),t.keyMatrixTime.modified()}return t.keyMatrices}}var ri={keyMatrixTime:null,keyMatrices:null};function ai(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ri,n),un.extend(e,t,n),t.keyMatrixTime={},nn.obj(t.keyMatrixTime),t.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},nn.setGet(e,t,["keyMatrixTime"]),ni(e,t)}var oi=nn.newInstance(ai);function ii(e,t){t.classHierarchy.push("vtkWebGPUBindGroup"),e.setBindables=function(n){if(t.bindables.length===n.length){for(var r=!0,a=0;a<t.bindables.length;a++)t.bindables[a]!==n[a]&&(r=!1);if(r)return}t.bindables=n,e.modified()},e.getBindGroupLayout=function(e){for(var n=[],r=0;r<t.bindables.length;r++){var a=t.bindables[r].getBindGroupLayoutEntry();a.binding=r,n.push(a)}return e.getBindGroupLayout({entries:n})},e.getBindGroup=function(n){for(var r=e.getMTime(),a=0;a<t.bindables.length;a++){var o=t.bindables[a].getBindGroupTime().getMTime();r=o>r?o:r}if(r<t.bindGroupTime.getMTime())return t.bindGroup;for(var i=[],s=0;s<t.bindables.length;s++){var l=t.bindables[s].getBindGroupEntry();l.binding=s,i.push(l)}return t.bindGroup=n.getHandle().createBindGroup({layout:e.getBindGroupLayout(n),entries:i,label:t.label}),t.bindGroupTime.modified(),t.bindGroup},e.getShaderCode=function(e){for(var n=[],r=e.getBindGroupLayoutCount(t.label),a=0;a<t.bindables.length;a++)n.push(t.bindables[a].getShaderCode(a,r));return n.join("\n")}}Jo("vtkCamera",oi);var si={device:null,handle:null,label:null};function li(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,si,n),nn.obj(e,t),t.bindables=[],t.bindGroupTime={},nn.obj(t.bindGroupTime,{mtime:0}),nn.get(e,t,["bindGroupTime","handle","sizeInBytes","usage"]),nn.setGet(e,t,["label","device","arrayInformation"]),ii(e,t)}var ci=nn.newInstance(li),ui={newInstance:ci,extend:li};function fi(e,t){t.classHierarchy.push("vtkWebGPUShaderModule"),e.initialize=function(e,n){t.device=e,t.handle=t.device.getHandle().createShaderModule({code:n.getCode()})}}var di={device:null,handle:null};function pi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,di,n),nn.obj(e,t),nn.get(e,t,["lastCameraMTime"]),nn.setGet(e,t,["device","handle"]),fi(e,t)}var mi=nn.newInstance(pi,"vtkWebGPUShaderModule"),gi={newInstance:mi,extend:pi};function vi(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Array.isArray(n)?n.join("\n"):n,o=!1;-1!==e.search(t)&&(o=!0);var i="";r&&(i="g");var s=new RegExp(t,i),l=e.replace(s,a);return{replace:o,result:l}}function hi(e,t){t.classHierarchy.push("vtkWebGPUShaderCache"),e.getShaderModule=function(e){for(var n=e.getType(),r=e.getHash(),a=t._shaderModules.keys(),o=0;o<a.length;o++){var i=a[o];if(i.getHash()===r&&i.getType()===n)return t._shaderModules.get(i)}var s=gi.newInstance();return s.initialize(t.device,e),t._shaderModules.set(e,s),s}}var yi={shaderModules:null,device:null,window:null};function bi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,yi,n),t._shaderModules=new Map,nn.obj(e,t),nn.setGet(e,t,["device","window"]),hi(e,t)}var xi=nn.newInstance(bi,"vtkWebGPUShaderCache"),Ti={newInstance:xi,extend:bi,substitute:vi};function Si(e,t){t.classHierarchy.push("vtkWebGPUPipeline"),e.getShaderDescriptions=function(){return t.shaderDescriptions},e.initialize=function(e,n){t.pipelineDescription=t.renderEncoder.getPipelineSettings(),t.pipelineDescription.primitive.topology=t.topology,t.pipelineDescription.vertex=t.vertexState,t.pipelineDescription.label=n;for(var r=[],a=0;a<t.layouts.length;a++)r.push(t.layouts[a].layout);t.pipelineLayout=e.getHandle().createPipelineLayout({bindGroupLayouts:r}),t.pipelineDescription.layout=t.pipelineLayout;for(var o=0;o<t.shaderDescriptions.length;o++){var i=t.shaderDescriptions[o],s=e.getShaderModule(i);"vertex"===i.getType()&&(t.pipelineDescription.vertex.module=s.getHandle(),t.pipelineDescription.vertex.entryPoint="main"),"fragment"===i.getType()&&(t.pipelineDescription.fragment.module=s.getHandle(),t.pipelineDescription.fragment.entryPoint="main")}t.handle=e.getHandle().createRenderPipeline(t.pipelineDescription)},e.getShaderDescription=function(e){for(var n=0;n<t.shaderDescriptions.length;n++)if(t.shaderDescriptions[n].getType()===e)return t.shaderDescriptions[n];return null},e.addBindGroupLayout=function(e){e&&t.layouts.push({layout:e.getBindGroupLayout(t.device),label:e.getLabel()})},e.getBindGroupLayout=function(e){return t.layouts[e].layout},e.getBindGroupLayoutCount=function(e){for(var n=0;n<t.layouts.length;n++)if(t.layouts[n].label===e)return n;return 0},e.bindVertexInput=function(e,t){t.bindBuffers(e)}}var Oi={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function wi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Oi,n),Pt(e,t),t.layouts=[],t.shaderDescriptions=[],Ct(e,t,["handle","pipelineDescription"]),Dt(e,t,["device","renderEncoder","topology","vertexState"]),Si(e,t)}var Ai=_t(wi,"vtkWebGPUPipeline"),Pi={newInstance:Ai,extend:wi};function Ii(e,t){t.classHierarchy.push("vtkWebGPUShaderDescription"),e.hasOutput=function(e){return t.outputNames.includes(e)},e.addOutput=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;t.outputTypes.push(e),t.outputNames.push(n),t.outputInterpolations.push(r)},e.addBuiltinOutput=function(e,n){t.builtinOutputTypes.push(e),t.builtinOutputNames.push(n)},e.addBuiltinInput=function(e,n){t.builtinInputTypes.push(e),t.builtinInputNames.push(n)},e.replaceShaderCode=function(e,n){var r=[],a=[];if(n&&r.push(n.getShaderCode()),e||t.builtinInputNames.length){var o=[];if(o.push("struct ".concat(t.type,"Input\n{")),e)for(var i=e.getOutputNamesByReference(),s=e.getOutputTypesByReference(),l=e.getOutputInterpolationsByReference(),c=0;c<i.length;c++)void 0!==l[c]?o.push("  @location(".concat(c,") @interpolate(").concat(l[c],") ").concat(i[c]," : ").concat(s[c],",")):o.push("  @location(".concat(c,") ").concat(i[c]," : ").concat(s[c],","));for(var u=0;u<t.builtinInputNames.length;u++)o.push("  ".concat(t.builtinInputNames[u]," : ").concat(t.builtinInputTypes[u],","));o.length>1&&(o.push("};"),a=o,r[r.length-1]+=",",r.push("input: ".concat(t.type,"Input")))}if(r.length&&(t.code=Ti.substitute(t.code,"//VTK::IOStructs::Input",r).result),t.outputNames.length+t.builtinOutputNames.length){for(var f=["struct ".concat(t.type,"Output\n{")],d=0;d<t.outputNames.length;d++)void 0!==t.outputInterpolations[d]?f.push("  @location(".concat(d,") @interpolate(").concat(t.outputInterpolations[d],") ").concat(t.outputNames[d]," : ").concat(t.outputTypes[d],",")):f.push("  @location(".concat(d,") ").concat(t.outputNames[d]," : ").concat(t.outputTypes[d],","));for(var p=0;p<t.builtinOutputNames.length;p++)f.push("  ".concat(t.builtinOutputNames[p]," : ").concat(t.builtinOutputTypes[p],","));f.push("};"),a=a.concat(f),t.code=Ti.substitute(t.code,"//VTK::IOStructs::Output",["-> ".concat(t.type,"Output")]).result}t.code=Ti.substitute(t.code,"//VTK::IOStructs::Dec",a).result}}var Ci={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function Ei(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ci,n),t.outputNames=[],t.outputTypes=[],t.outputInterpolations=[],t.builtinOutputNames=[],t.builtinOutputTypes=[],t.builtinInputNames=[],t.builtinInputTypes=[],nn.obj(e,t),nn.setGet(e,t,["type","hash","code"]),nn.getArray(e,t,["outputTypes","outputNames","outputInterpolations"]),Ii(e,t)}var Mi=nn.newInstance(Ei,"vtkWebGPUShaderDescription"),Ri={newInstance:Mi,extend:Ei},Di={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function ki(e){return!e||e.length<6?0:e in Di===!0?Di[e]:(lt("unknown format ".concat(e)),null)}function Li(e){if(!e||e.length<5)return 0;var t=1;"x"===e[e.length-2]&&(t=Number(e[e.length-1]));var n=1===t?e.length-1:e.length-3,r=Number(e[n]);if(Number.isNaN(r))return lt("unknown format ".concat(e)),0;var a=5-r/2;return t*a}function Bi(e){if(!e||e.length<5)return 0;var t=1;return"x"===e[e.length-2]&&(t=Number(e[e.length-1])),t}function Vi(e){if(!e||e.length<5)return 0;var t;if("f"===e[0])t="Float";else if("s"===e[0])t="Int";else{if("u"!==e[0])return void lt("unknown format ".concat(e));t="Uint"}var n=e.split("x")[0],r=Number(n[n.length-1]);if(!Number.isNaN(r))return t+=8*(5-r/2),t+="Array",t;lt("unknown format ".concat(e))}function Fi(e){var t;if("f"===e[0]||"n"===e[1])t="f32";else if("s"===e[0]&&"i"===e[1])t="i32";else{if("u"!==e[0]||"i"!==e[1])return void lt("unknown format ".concat(e));t="u32"}var n=1;return"x"===e[e.length-2]&&(n=Number(e[e.length-1])),4===n?"vec4<".concat(t,">"):3===n?"vec3<".concat(t,">"):2===n?"vec2<".concat(t,">"):t}function Ni(e){if(!e)return 0;var t=1;"vec"===e.substring(0,3)?t=Number(e[3]):"mat"===e.substring(0,3)&&(t=e[3]*e[5]);var n=4;return t*n}function Ui(e){if(e)return e.includes("f32")?"Float32Array":e.includes("i32")?"Int32Array":e.includes("u32")?"Uint32Array":void lt("unknown format ".concat(e))}var _i={getDetailsFromTextureFormat:ki,getByteStrideFromBufferFormat:Li,getNumberOfComponentsFromBufferFormat:Bi,getNativeTypeFromBufferFormat:Vi,getShaderTypeFromBufferFormat:Fi,getByteStrideFromShaderFormat:Ni,getNativeTypeFromShaderFormat:Ui};function Gi(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!t.includes(e[n]))return!1;return!0}function zi(e,t){t.classHierarchy.push("vtkWebGPUVertexInput"),e.addBuffer=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertex",a=n;Array.isArray(a)||(a=[a]);for(var o=0;o<t.inputs.length;o++)if(Gi(t.inputs[o].names,a)){if(t.inputs[o].buffer===e)return;return void(t.inputs[o].buffer=e)}t.inputs.push({buffer:e,stepMode:r,names:a}),t.inputs=t.inputs.sort((function(e,t){return e.names[0]<t.names[0]?-1:e.names[0]>t.names[0]?1:0}))},e.removeBufferIfPresent=function(e){for(var n=0;n<t.inputs.length;n++)t.inputs[n].names.includes(e)&&t.inputs.splice(n,1)},e.getBuffer=function(e){for(var n=0;n<t.inputs.length;n++)if(t.inputs[n].names.includes(e))return t.inputs[n].buffer;return null},e.hasAttribute=function(e){for(var n=0;n<t.inputs.length;n++)if(t.inputs[n].names.includes(e))return!0;return!1},e.getAttributeTime=function(e){for(var n=0;n<t.inputs.length;n++)if(t.inputs[n].names.includes(e))return t.inputs[n].buffer.getSourceTime();return 0},e.getShaderCode=function(){for(var e="",n=0,r=0;r<t.inputs.length;r++)for(var a=0;a<t.inputs[r].names.length;a++){var o=t.inputs[r].buffer.getArrayInformation()[a],i=_i.getShaderTypeFromBufferFormat(o.format);n>0&&(e+=",\n"),e="".concat(e,"  @location(").concat(n,") ").concat(t.inputs[r].names[a]," : ").concat(i),n++}return e},e.getVertexInputInformation=function(){var e={};if(t.inputs.length){for(var n=[],r=0,a=0;a<t.inputs.length;a++){for(var o=t.inputs[a].buffer,i={arrayStride:o.getStrideInBytes(),stepMode:t.inputs[a].stepMode,attributes:[]},s=o.getArrayInformation(),l=0;l<t.inputs[a].names.length;l++)i.attributes.push({shaderLocation:r,offset:s[l].offset,format:s[l].format}),r++;n.push(i)}e.buffers=n}return e},e.bindBuffers=function(e){for(var n=0;n<t.inputs.length;n++)e.setVertexBuffer(n,t.inputs[n].buffer.getHandle());t.indexBuffer&&e.setIndexBuffer(t.indexBuffer.getHandle(),t.indexBuffer.getArrayInformation()[0].format)},e.getReady=function(){},e.releaseGraphicsResources=function(){t.created&&(t.inputs=[],t.bindingDescriptions=[],t.attributeDescriptions=[])}}var ji={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function Wi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ji,n),Pt(e,t),t.bindingDescriptions=[],t.attributeDescriptions=[],t.inputs=[],Dt(e,t,["created","device","handle","indexBuffer"]),zi(e,t)}var Ki=_t(Wi,"vtkWebGPUVertexInput"),Hi={newInstance:Ki,extend:Wi},Xi="\n//VTK::Renderer::Dec\n\n//VTK::Color::Dec\n\n//VTK::Normal::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Select::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::IOStructs::Dec\n\n@vertex\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output : vertexOutput;\n\n  // var vertex: vec4<f32> = vertexBC;\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Select::Impl\n\n  //VTK::Position::Impl\n\n  return output;\n}\n",qi="\n//VTK::Renderer::Dec\n\n//VTK::Color::Dec\n\n//VTK::Normal::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Select::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output : fragmentOutput;\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::Light::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Select::Impl\n\n  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);\n\n  //VTK::RenderEncoder::Impl\n  return output;\n}\n";function Yi(e,t){t.classHierarchy.push("vtkWebGPUSimpleMapper"),e.generateShaderDescriptions=function(n,r,a){var o=Ri.newInstance({type:"vertex",hash:n,code:t.vertexShaderTemplate}),i=Ri.newInstance({type:"fragment",hash:n,code:t.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(o),s.push(i);for(var l=t.vertexShaderTemplate+t.fragmentShaderTemplate,c=new RegExp("//VTK::[^:]*::","g"),u=l.match(c).filter((function(e,t,n){return n.indexOf(e)===t})),f=u.map((function(e){return"replaceShader".concat(e.substring(7,e.length-2))})),d=0;d<f.length;d++){var p=f[d];"replaceShaderIOStructs"!==p&&t.shaderReplacements.has(p)&&t.shaderReplacements.get(p)(n,r,a)}e.replaceShaderIOStructs(n,r,a)},e.replaceShaderIOStructs=function(e,t,n){var r=t.getShaderDescription("vertex");r.replaceShaderCode(null,n);var a=t.getShaderDescription("fragment");a.replaceShaderCode(r)},e.replaceShaderRenderEncoder=function(e,n,r){t.renderEncoder.replaceShaderCode(n)},t.shaderReplacements.set("replaceShaderRenderEncoder",e.replaceShaderRenderEncoder),e.replaceShaderRenderer=function(e,n,r){if(t.WebGPURenderer){var a=t.WebGPURenderer.getBindGroup().getShaderCode(n),o=n.getShaderDescription("vertex"),i=o.getCode();i=Ti.substitute(i,"//VTK::Renderer::Dec",[a]).result,o.setCode(i);var s=n.getShaderDescription("fragment");i=s.getCode(),i=Ti.substitute(i,"//VTK::Renderer::Dec",[a]).result,s.setCode(i)}},t.shaderReplacements.set("replaceShaderRenderer",e.replaceShaderRenderer),e.replaceShaderMapper=function(e,n,r){var a=t.bindGroup.getShaderCode(n),o=n.getShaderDescription("vertex"),i=o.getCode();i=Ti.substitute(i,"//VTK::Mapper::Dec",[a]).result,o.setCode(i);var s=n.getShaderDescription("fragment");s.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),i=s.getCode(),i=Ti.substitute(i,"//VTK::Mapper::Dec",[a]).result,s.setCode(i)},t.shaderReplacements.set("replaceShaderMapper",e.replaceShaderMapper),e.replaceShaderPosition=function(e,t,n){var r=t.getShaderDescription("vertex");r.addBuiltinOutput("vec4<f32>","@builtin(position) Position");var a=r.getCode();a=Ti.substitute(a,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,r.setCode(a)},t.shaderReplacements.set("replaceShaderPosition",e.replaceShaderPosition),e.replaceShaderTCoord=function(e,t,n){var r=t.getShaderDescription("vertex");r.addOutput("vec2<f32>","tcoordVS")},t.shaderReplacements.set("replaceShaderTCoord",e.replaceShaderTCoord),e.addTextureView=function(e){t.textureViews.includes(e)||t.textureViews.push(e)},e.prepareToDraw=function(n){t.renderEncoder=n,e.updateInput(),e.updateBuffers(),e.updateBindings(),e.updatePipeline()},e.updateInput=function(){},e.updateBuffers=function(){},e.updateBindings=function(){t.bindGroup.setBindables(e.getBindables())},e.computePipelineHash=function(){},e.registerDrawCallback=function(n){n.registerDrawCallback(t.pipeline,e.draw)},e.prepareAndDraw=function(n){e.prepareToDraw(n),n.setPipeline(t.pipeline),e.draw(n)},e.draw=function(e){var n=e.getBoundPipeline();e.activateBindGroup(t.bindGroup),t.WebGPURenderer&&t.WebGPURenderer.bindUBO(e),n.bindVertexInput(e,t.vertexInput);var r=t.vertexInput.getIndexBuffer();r?e.drawIndexed(r.getIndexCount(),t.numberOfInstances,0,0,0):e.draw(t.numberOfVertices,t.numberOfInstances,0,0)},e.getBindables=function(){var e=Te(t.additionalBindables);t.UBO&&e.push(t.UBO),t.SSBO&&e.push(t.SSBO);for(var n=0;n<t.textureViews.length;n++){e.push(t.textureViews[n]);var r=t.textureViews[n].getSampler();r&&e.push(r)}return e},e.updatePipeline=function(){e.computePipelineHash(),t.pipeline=t.device.getPipeline(t.pipelineHash),t.pipeline||(t.pipeline=Pi.newInstance(),t.pipeline.setDevice(t.device),t.WebGPURenderer&&t.pipeline.addBindGroupLayout(t.WebGPURenderer.getBindGroup()),t.pipeline.addBindGroupLayout(t.bindGroup),e.generateShaderDescriptions(t.pipelineHash,t.pipeline,t.vertexInput),t.pipeline.setTopology(t.topology),t.pipeline.setRenderEncoder(t.renderEncoder),t.pipeline.setVertexState(t.vertexInput.getVertexInputInformation()),t.device.createPipeline(t.pipelineHash,t.pipeline))}}var Zi={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function $i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Zi,n),un.extend(e,t,n),t.textureViews=[],t.vertexInput=Hi.newInstance(),t.bindGroup=ui.newInstance({label:"mapperBG"}),t.additionalBindables=[],t.fragmentShaderTemplate=t.fragmentShaderTemplate||qi,t.vertexShaderTemplate=t.vertexShaderTemplate||Xi,t.shaderReplacements=new Map,nn.get(e,t,["pipeline","vertexInput"]),nn.setGet(e,t,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),Yi(e,t)}var Ji=nn.newInstance($i,"vtkWebGPUSimpleMapper"),Qi={newInstance:Ji,extend:$i};function es(e,t){t.classHierarchy.push("vtkWebGPUFullScreenQuad"),e.replaceShaderPosition=function(e,t,n){var r=t.getShaderDescription("vertex");r.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),r.addOutput("vec4<f32>","vertexVC");var a=r.getCode();a=Ti.substitute(a,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,r.setCode(a)},t.shaderReplacements.set("replaceShaderPosition",e.replaceShaderPosition),e.updateBuffers=function(){var e=t.device.getBufferManager().getFullScreenQuadBuffer();t.vertexInput.addBuffer(e,["vertexBC"]),t.numberOfVertices=6}}var ts={};function ns(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ts,n),Qi.extend(e,t,n),es(e,t)}var rs=nn.newInstance(ns,"vtkWebGPUFullScreenQuad"),as={newInstance:rs,extend:ns},os={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},is={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6},ss={BufferUsage:os,PrimitiveTypes:is};function ls(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ls(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ls(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var us=["getMappedRange","mapAsync","unmap"];function fs(e,t,n,r){var a=r.byteLength,o=e.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),i=o.getMappedRange(0,a);new Uint8Array(i).set(new Uint8Array(r)),o.unmap();var s=e.createCommandEncoder();s.copyBufferToBuffer(o,0,t,n,a);var l=s.finish(),c=e.queue;c.submit([l]),o.destroy()}function ds(e,t){t.classHierarchy.push("vtkWebGPUBuffer"),e.create=function(e,n){t.handle=t.device.getHandle().createBuffer({size:e,usage:n,label:t.label}),t.sizeInBytes=e,t.usage=n},e.write=function(e){fs(t.device.getHandle(),t.handle,0,e.buffer)},e.createAndWrite=function(e,n){t.handle=t.device.getHandle().createBuffer({size:e.byteLength,usage:n,mappedAtCreation:!0,label:t.label}),t.sizeInBytes=e.byteLength,t.usage=n,new Uint8Array(t.handle.getMappedRange()).set(new Uint8Array(e.buffer)),t.handle.unmap()};for(var n=function(n){e[us[n]]=function(){var e;return(e=t.handle)[us[n]].apply(e,arguments)}},r=0;r<us.length;r++)n(r)}var ps={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ps,n),nn.obj(e,t),nn.get(e,t,["handle","sizeInBytes","usage"]),nn.setGet(e,t,["strideInBytes","device","arrayInformation","label","sourceTime"]),ds(e,t)}var gs=nn.newInstance(ms),vs=cs({newInstance:gs,extend:ms},ss);function hs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ys(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hs(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bs=oa.Representation,xs=oa.Interpolation;function Ts(e){return function(){return nn.vtkErrorMacro("vtkProperty::".concat(e," - NOT IMPLEMENTED"))}}function Ss(e,t){t.classHierarchy.push("vtkProperty"),e.setColor=function(n,r,a){Array.isArray(n)?t.color[0]===n[0]&&t.color[1]===n[1]&&t.color[2]===n[2]||(t.color[0]=n[0],t.color[1]=n[1],t.color[2]=n[2],e.modified()):t.color[0]===n&&t.color[1]===r&&t.color[2]===a||(t.color[0]=n,t.color[1]=r,t.color[2]=a,e.modified()),e.setDiffuseColor(t.color),e.setAmbientColor(t.color),e.setSpecularColor(t.color)},e.computeCompositeColor=Ts("ComputeCompositeColor"),e.getColor=function(){var e=0;t.ambient+t.diffuse+t.specular>0&&(e=1/(t.ambient+t.diffuse+t.specular));for(var n=0;n<3;n++)t.color[n]=e*(t.ambient*t.ambientColor[n]+t.diffuse*t.diffuseColor[n]+t.specular*t.specularColor[n]);return[].concat(t.color)},e.setSpecularPower=function(n){var r=1/Math.max(1,n);t.roughness===r&&t.specularPower===n||(t.specularPower=n,t.roughness=r,e.modified())},e.addShaderVariable=Ts("AddShaderVariable"),e.setInterpolationToFlat=function(){return e.setInterpolation(xs.FLAT)},e.setInterpolationToGouraud=function(){return e.setInterpolation(xs.GOURAUD)},e.setInterpolationToPhong=function(){return e.setInterpolation(xs.PHONG)},e.getInterpolationAsString=function(){return nn.enumToString(xs,t.interpolation)},e.setRepresentationToWireframe=function(){return e.setRepresentation(bs.WIREFRAME)},e.setRepresentationToSurface=function(){return e.setRepresentation(bs.SURFACE)},e.setRepresentationToPoints=function(){return e.setRepresentation(bs.POINTS)},e.getRepresentationAsString=function(){return nn.enumToString(bs,t.representation)}}var Os={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:xs.GOURAUD,representation:bs.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function ws(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Os,n),nn.obj(e,t),nn.setGet(e,t,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),nn.setGetArray(e,t,["ambientColor","specularColor","diffuseColor","edgeColor"],3),Ss(e,t)}var As=nn.newInstance(ws,"vtkProperty"),Ps=ys({newInstance:As,extend:ws},oa);function Is(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Is(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Is(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Es,Ms=Ps.Representation,Rs=ss.PrimitiveTypes,Ds=function(){function e(){Be(this,e),this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}return Fe(e,[{key:"clear",value:function(){this.count=0}},{key:"has",value:function(e){for(var t=0;t<this.count;t++)if(this.keys[t]===e)return!0}},{key:"get",value:function(e){for(var t=0;t<this.count;t++)if(this.keys[t]===e)return this.values[t]}},{key:"set",value:function(e,t){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=t)}}]),e}();function ks(e){switch(e){case Rs.Points:return"points";case Rs.Lines:return"lines";case Rs.Triangles:case Rs.TriangleEdges:return"polys";case Rs.TriangleStripEdges:case Rs.TriangleStrips:return"strips";default:return""}}function Ls(e,t,n){var r=e.pointIdToFlatId[t];return r<0&&(r=e.flatId,e.pointIdToFlatId[t]=r,e.flatIdToPointId[e.flatId]=t,e.flatIdToCellId[e.flatId]=n,e.flatId++),r}function Bs(e,t,n){for(var r=e.length,a=0;a<r;a++){var o=e[a];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(var i=a+1;i<a+r;i++){o=e[i%r];var s=Ls(n,o,t);n.ibo[n.iboId++]=s}return}}for(var l=0;l<r;l++){var c=e[l];if(!n.provokedPointIds[c]){var u=Ls(n,c,t);n.provokedPointIds[c]=1,n.cellProvokedMap.set(c,u),n.flatIdToCellId[u]=t,n.ibo[n.iboId++]=u;for(var f=l+1;f<l+r;f++)c=e[f%r],u=Ls(n,c,t),n.ibo[n.iboId++]=u;return}}var d=e[0],p=n.flatId;n.cellProvokedMap.set(d,p),n.flatIdToPointId[n.flatId]=d,n.flatIdToCellId[n.flatId]=t,n.flatId++,n.ibo[n.iboId++]=p;for(var m=1;m<r;m++)d=e[m],p=Ls(n,d,t),n.ibo[n.iboId++]=p}function Vs(e,t,n){var r=e.length;n.iboSize+=r;for(var a=0;a<r;a++){var o=e[a];if(n.cellProvokedMap.has(o))return}for(var i=0;i<r;i++){var s=e[i];if(!n.provokedPointIds[s])return n.provokedPointIds[s]=1,void n.cellProvokedMap.set(s,1)}n.cellProvokedMap.set(e[0],1),n.extraPoints++}var Fs=new Uint32Array(1),Ns=new Uint32Array(2),Us=new Uint32Array(3),_s={anythingToPoints:function(e,t,n,r,a){for(var o=0;o<e;++o)Fs[0]=t[n+o],Es(Fs,r,a)},linesToWireframe:function(e,t,n,r,a){for(var o=0;o<e-1;++o)Ns[0]=t[n+o],Ns[1]=t[n+o+1],Es(Ns,r,a)},polysToWireframe:function(e,t,n,r,a){if(e>2)for(var o=0;o<e;++o)Ns[0]=t[n+o],Ns[1]=t[n+(o+1)%e],Es(Ns,r,a)},stripsToWireframe:function(e,t,n,r,a){if(e>2){for(var o=0;o<e-1;++o)Ns[0]=t[n+o],Ns[1]=t[n+o+1],Es(Ns,r,a);for(var i=0;i<e-2;i++)Ns[0]=t[n+i],Ns[1]=t[n+i+2],Es(Ns,r,a)}},polysToSurface:function(e,t,n,r,a){for(var o=0;o<e-2;o++)Us[0]=t[n],Us[1]=t[n+o+1],Us[2]=t[n+o+2],Es(Us,r,a)},stripsToSurface:function(e,t,n,r,a){for(var o=0;o<e-2;o++)Us[0]=t[n+o],Us[1]=t[n+o+1+o%2],Us[2]=t[n+o+1+(o+1)%2],Es(Us,r,a)}};function Gs(e,t){t.classHierarchy.push("vtkWebGPUIndexBuffer"),e.buildIndexBuffer=function(e){var n=e.cells,r=e.primitiveType,a=e.representation,o=e.cellOffset,i=n.getData(),s=i.length,l=ks(r),c=e.numberOfPoints,u={provokedPointIds:new Uint8Array(c),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new Ds},f=null;f=a===Ms.POINTS||r===Rs.Points?_s.anythingToPoints:a===Ms.WIREFRAME||r===Rs.Lines?_s["".concat(l,"ToWireframe")]:_s["".concat(l,"ToSurface")],Es=Vs;for(var d=o||0,p=0;p<s;)u.cellProvokedMap.clear(),f(i[p],i,p+1,d,u),p+=i[p]+1,d++;u.flatIdToPointId=c<=65535?new Uint16Array(c+u.extraPoints):new Uint32Array(c+u.extraPoints),c+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(c):u.pointIdToFlatId=new Int32Array(c),c+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),e.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),e.format="uint32"),u.flatIdToCellId=d<=65535?new Uint16Array(c+u.extraPoints):new Uint32Array(c+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),Es=Bs,d=o||0;for(var m=0;m<s;)u.cellProvokedMap.clear(),f(i[m],i,m+1,d,u),m+=i[m]+1,d++;delete u.provokedPointIds,delete u.pointIdToFlatId,e.nativeArray=u.ibo,t.flatIdToPointId=u.flatIdToPointId,t.flatIdToCellId=u.flatIdToCellId,t.flatSize=u.flatId,t.indexCount=u.iboId}}var zs={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function js(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,zs,n),vs.extend(e,t,n),nn.setGet(e,t,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),Gs(e,t)}var Ws=nn.newInstance(js),Ks=Cs({newInstance:Ws,extend:js},ss);function Hs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hs(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qs=ss.BufferUsage,Ys=lt,Zs=vr.VtkDataTypes,$s={};function Js(e){var t;switch(e.getDataType()){case Zs.UNSIGNED_CHAR:t="uint8";break;case Zs.FLOAT:t="float32";break;case Zs.UNSIGNED_INT:t="uint32";break;case Zs.INT:t="sint32";break;case Zs.DOUBLE:t="float32";break;case Zs.UNSIGNED_SHORT:t="uint16";break;case Zs.SHORT:t="sin16";break;default:t="float32";break}switch(e.getNumberOfComponents()){case 2:t+="x2";break;case 3:t.includes("32")||Ys("unsupported x3 type for ".concat(t)),t+="x3";break;case 4:t+="x4";break}return t}function Qs(e,t,n,r,a){var o={},i=e.getFlatSize();if(!i)return o;var s=[0,0,0,0];a.shift&&(a.shift.length?s=a.shift:s.fill(a.shift));var l=[1,1,1,1];a.scale&&(a.scale.length?l=a.scale:l.fill(a.scale));var c,u=!!Object.prototype.hasOwnProperty.call(a,"packExtra")&&a.packExtra,f=0,d=n+(u?1:0),p=pt(r,i*d),m=e.getFlatIdToPointId();a.cellData&&(m=e.getFlatIdToCellId()),1===n?c=function(e){p[f++]=l[0]*t[e]+s[0]}:2===n?c=function(e){p[f++]=l[0]*t[e]+s[0],p[f++]=l[1]*t[e+1]+s[1]}:3!==n||u?3===n&&u?c=function(e){p[f++]=l[0]*t[e]+s[0],p[f++]=l[1]*t[e+1]+s[1],p[f++]=l[2]*t[e+2]+s[2],p[f++]=1*l[3]+s[3]}:4===n&&(c=function(e){p[f++]=l[0]*t[e]+s[0],p[f++]=l[1]*t[e+1]+s[1],p[f++]=l[2]*t[e+2]+s[2],p[f++]=l[3]*t[e+3]+s[3]}):c=function(e){p[f++]=l[0]*t[e]+s[0],p[f++]=l[1]*t[e+1]+s[1],p[f++]=l[2]*t[e+2]+s[2]};for(var g=0;g<i;g++){var v=n*m[g];c(v)}return o.nativeArray=p,o}function el(e,t,n,r){var a=[e[3*r]-e[3*n],e[3*r+1]-e[3*n+1],e[3*r+2]-e[3*n+2]],o=[e[3*t]-e[3*n],e[3*t+1]-e[3*n+1],e[3*t+2]-e[3*n+2]],i=[];return Hn(a,o,i),qn(i),i}function tl(e,t){var n=t.getData(),r=e.getData();if(!r||!n)return null;for(var a=new Int8Array(4*e.getNumberOfCells()),o=r.length,i=0,s=0;s<o;){var l=el(n,r[s+1],r[s+2],r[s+3]);a[i++]=127*l[0],a[i++]=127*l[1],a[i++]=127*l[2],a[i++]=127,s+=r[s]+1}return a}function nl(e,t){function n(e){var n,r;if(e.dataArray&&!e.nativeArray&&(e.nativeArray=e.dataArray.getData()),e.usage===qs.Index&&(n=Ks.newInstance({label:e.label}),n.setDevice(t.device),r=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,n.buildIndexBuffer(e),n.createAndWrite(e.nativeArray,r),n.setArrayInformation([{format:e.format}])),n||(n=vs.newInstance({label:e.label}),n.setDevice(t.device)),e.usage===qs.UniformArray&&(r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,n.createAndWrite(e.nativeArray,r)),e.usage===qs.Storage&&(r=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,n.createAndWrite(e.nativeArray,r)),e.usage===qs.Texture&&(r=GPUBufferUsage.COPY_SRC,n.createAndWrite(e.nativeArray,r)),e.usage===qs.PointArray){r=GPUBufferUsage.VERTEX;var a=_i.getNativeTypeFromBufferFormat(e.format),o=Qs(e.indexBuffer,e.dataArray.getData(),e.dataArray.getNumberOfComponents(),a,{packExtra:e.packExtra,shift:e.shift,scale:e.scale,cellData:e.cellData,cellOffset:e.cellOffset});n.createAndWrite(o.nativeArray,r),n.setStrideInBytes(_i.getByteStrideFromBufferFormat(e.format)),n.setArrayInformation([{offset:0,format:e.format,interpolation:e.cellData?"flat":"perspective"}])}if(e.usage===qs.NormalsFromPoints){r=GPUBufferUsage.VERTEX;var i=_i.getNativeTypeFromBufferFormat(e.format),s=tl(e.cells,e.dataArray),l=Qs(e.indexBuffer,s,4,i,{cellData:!0});n.createAndWrite(l.nativeArray,r),n.setStrideInBytes(_i.getByteStrideFromBufferFormat(e.format)),n.setArrayInformation([{offset:0,format:e.format,interpolation:"flat"}])}return e.usage===qs.RawVertex&&(r=GPUBufferUsage.VERTEX,n.createAndWrite(e.nativeArray,r),n.setStrideInBytes(_i.getByteStrideFromBufferFormat(e.format)),n.setArrayInformation([{offset:0,format:e.format}])),n.setSourceTime(e.time),n}t.classHierarchy.push("vtkWebGPUBufferManager"),e.hasBuffer=function(e){return t.device.hasCachedObject(e)},e.getBuffer=function(e){return e.hash?t.device.getCachedObject(e.hash,n,e):n(e)},e.getBufferForPointArray=function(t,n){var r=Js(t),a={hash:"".concat(t.getMTime(),"I").concat(n.getMTime()).concat(r),usage:qs.PointArray,format:r,dataArray:t,indexBuffer:n};return e.getBuffer(a)},e.getFullScreenQuadBuffer=function(){if(t.fullScreenQuadBuffer)return t.fullScreenQuadBuffer;t.fullScreenQuadBuffer=vs.newInstance(),t.fullScreenQuadBuffer.setDevice(t.device);var e=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return t.fullScreenQuadBuffer.createAndWrite(e,GPUBufferUsage.VERTEX),t.fullScreenQuadBuffer.setStrideInBytes(12),t.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),t.fullScreenQuadBuffer}}var rl={device:null,fullScreenQuadBuffer:null};function al(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,rl,n),Pt(e,t),Dt(e,t,["device"]),nl(e,t)}var ol=_t(al),il=Xs(Xs({newInstance:ol,extend:al},$s),ss),sl=il.BufferUsage,ll=nn.vtkErrorMacro;function cl(e,t){t.classHierarchy.push("vtkWebGPUStorageBuffer"),e.addEntry=function(e,n){if(t._bufferEntryNames.has(e))ll("entry named ".concat(e," already exists"));else{t._bufferEntryNames.set(e,t.bufferEntries.length);var r=_i.getByteStrideFromShaderFormat(n);t.bufferEntries.push({name:e,type:n,sizeInBytes:r,offset:t.sizeInBytes,nativeType:_i.getNativeTypeFromShaderFormat(n)}),t.sizeInBytes+=r}},e.send=function(e){if(!t._buffer){var n={nativeArray:t.Float32Array,usage:sl.Storage,label:t.label};return t._buffer=e.getBufferManager().getBuffer(n),t.bindGroupTime.modified(),void t._sendTime.modified()}e.getHandle().queue.writeBuffer(t._buffer.getHandle(),0,t.arrayBuffer,0,t.sizeInBytes*t.numberOfInstances),t._sendTime.modified()},e.createView=function(e){e in t===!1&&(t.arrayBuffer||(t.arrayBuffer=new ArrayBuffer(t.sizeInBytes*t.numberOfInstances)),t[e]=nn.newTypedArray(e,t.arrayBuffer))},e.setValue=function(n,r,a){var o=t._bufferEntryNames.get(n);if(void 0!==o){var i=t.bufferEntries[o];e.createView(i.nativeType);var s=t[i.nativeType];s[(i.offset+r*t.sizeInBytes)/s.BYTES_PER_ELEMENT]=a}else ll("entry named ".concat(n," not found in UBO"))},e.setArray=function(n,r,a){var o=t._bufferEntryNames.get(n);if(void 0!==o){var i=t.bufferEntries[o];e.createView(i.nativeType);for(var s=t[i.nativeType],l=(i.offset+r*t.sizeInBytes)/s.BYTES_PER_ELEMENT,c=0;c<a.length;c++)s[l+c]=a[c]}else ll("entry named ".concat(n," not found in UBO"))},e.setAllInstancesFromArray=function(n,r){var a=t._bufferEntryNames.get(n);if(void 0!==a){var o=t.bufferEntries[a];e.createView(o.nativeType);for(var i=t[o.nativeType],s=r.length/t.numberOfInstances,l=0;l<t.numberOfInstances;l++)for(var c=(o.offset+l*t.sizeInBytes)/i.BYTES_PER_ELEMENT,u=0;u<s;u++)i[c+u]=r[l*s+u]}else ll("entry named ".concat(n," not found in UBO"))},e.setAllInstancesFromArrayColorToFloat=function(n,r){var a=t._bufferEntryNames.get(n);if(void 0!==a){var o=t.bufferEntries[a];e.createView(o.nativeType);for(var i=t[o.nativeType],s=r.length/t.numberOfInstances,l=0;l<t.numberOfInstances;l++)for(var c=(o.offset+l*t.sizeInBytes)/i.BYTES_PER_ELEMENT,u=0;u<s;u++)i[c+u]=r[l*s+u]/255}else ll("entry named ".concat(n," not found in UBO"))},e.setAllInstancesFromArray3x3To4x4=function(n,r){var a=t._bufferEntryNames.get(n);if(void 0!==a){var o=t.bufferEntries[a];e.createView(o.nativeType);for(var i=t[o.nativeType],s=9,l=0;l<t.numberOfInstances;l++)for(var c=(o.offset+l*t.sizeInBytes)/i.BYTES_PER_ELEMENT,u=0;u<3;u++)for(var f=0;f<3;f++)i[c+4*u+f]=r[l*s+3*u+f]}else ll("entry named ".concat(n," not found in UBO"))},e.getSendTime=function(){return t._sendTime.getMTime()},e.getShaderCode=function(e,n){for(var r=["struct ".concat(t.label,"StructEntry\n{")],a=0;a<t.bufferEntries.length;a++){var o=t.bufferEntries[a];r.push("  ".concat(o.name,": ").concat(o.type,","))}return r.push("\n};\nstruct ".concat(t.label,"Struct\n{\n  values: array<").concat(t.label,"StructEntry>,\n};\n@binding(").concat(e,") @group(").concat(n,") var<storage, read> ").concat(t.label,": ").concat(t.label,"Struct;\n")),r.join("\n")},e.getBindGroupEntry=function(){var e={resource:{buffer:t._buffer.getHandle()}};return e},e.clearData=function(){t.numberOfInstances=0,t.sizeInBytes=0,t.bufferEntries=[],t._bufferEntryNames=new Map,t._buffer=null,delete t.arrayBuffer,delete t.Float32Array}}var ul={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function fl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ul,n),nn.obj(e,t),t._bufferEntryNames=new Map,t.bufferEntries=[],t._sendTime={},nn.obj(t._sendTime,{mtime:0}),t.bindGroupTime={},nn.obj(t.bindGroupTime,{mtime:0}),t.bindGroupLayoutEntry=t.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},nn.get(e,t,["bindGroupTime"]),nn.setGet(e,t,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),cl(e,t)}var dl=nn.newInstance(fl,"vtkWebGPUStorageBuffer"),pl={newInstance:dl,extend:fl},ml=il.BufferUsage,gl=nn.vtkErrorMacro;function vl(e,t){t.classHierarchy.push("vtkWebGPUUniformBuffer"),e.addEntry=function(e,n){t._bufferEntryNames.has(e)?gl("entry named ".concat(e," already exists")):(t.sortDirty=!0,t._bufferEntryNames.set(e,t.bufferEntries.length),t.bufferEntries.push({name:e,type:n,sizeInBytes:_i.getByteStrideFromShaderFormat(n),offset:-1,nativeType:_i.getNativeTypeFromShaderFormat(n),packed:!1}))},e.sortBufferEntries=function(){if(t.sortDirty){for(var e=0,n=[],r=4,a=0;a<t.bufferEntries.length;a++){var o=t.bufferEntries[a];o.sizeInBytes%16===0&&(r=Math.max(16,r)),o.sizeInBytes%8===0&&(r=Math.max(8,r))}for(var i=0;i<t.bufferEntries.length;i++){var s=t.bufferEntries[i];!1===s.packed&&s.sizeInBytes%16===0&&(s.packed=!0,s.offset=e,n.push(s),e+=s.sizeInBytes)}for(var l=0;l<t.bufferEntries.length;l++){var c=t.bufferEntries[l];if(!1===c.packed&&12===c.sizeInBytes)for(var u=0;u<t.bufferEntries.length;u++){var f=t.bufferEntries[u];if(!1===f.packed&&4===f.sizeInBytes){c.packed=!0,c.offset=e,n.push(c),e+=c.sizeInBytes,f.packed=!0,f.offset=e,n.push(f),e+=f.sizeInBytes;break}}}for(var d=0;d<t.bufferEntries.length;d++){var p=t.bufferEntries[d];if(!p.packed&&p.sizeInBytes%8===0)for(var m=d+1;m<t.bufferEntries.length;m++){var g=t.bufferEntries[m];if(!g.packed&&g.sizeInBytes%8===0){p.packed=!0,p.offset=e,n.push(p),e+=p.sizeInBytes,g.packed=!0,g.offset=e,n.push(g),e+=g.sizeInBytes;break}}}for(var v=0;v<t.bufferEntries.length;v++){var h=t.bufferEntries[v];if(!h.packed&&h.sizeInBytes%8===0)for(var y=!1,b=0;!y&&b<t.bufferEntries.length;b++){var x=t.bufferEntries[b];if(!x.packed&&4===x.sizeInBytes)for(var T=b+1;T<t.bufferEntries.length;T++){var S=t.bufferEntries[T];if(!S.packed&&4===S.sizeInBytes){h.packed=!0,h.offset=e,n.push(h),e+=h.sizeInBytes,x.packed=!0,x.offset=e,n.push(x),e+=x.sizeInBytes,S.packed=!0,S.offset=e,n.push(S),e+=S.sizeInBytes,y=!0;break}}}}for(var O=0;O<t.bufferEntries.length;O++){var w=t.bufferEntries[O];!w.packed&&w.sizeInBytes>4&&(w.packed=!0,w.offset=e,n.push(w),e+=w.sizeInBytes)}for(var A=0;A<t.bufferEntries.length;A++){var P=t.bufferEntries[A];P.packed||(P.packed=!0,P.offset=e,n.push(P),e+=P.sizeInBytes)}t.bufferEntries=n,t._bufferEntryNames.clear();for(var I=0;I<t.bufferEntries.length;I++)t._bufferEntryNames.set(t.bufferEntries[I].name,I);t.sizeInBytes=e,t.sizeInBytes=r*Math.ceil(t.sizeInBytes/r),t.sortDirty=!1}},e.sendIfNeeded=function(e){if(!t.UBO){var n={nativeArray:t.Float32Array,usage:ml.UniformArray,label:t.label};t.UBO=e.getBufferManager().getBuffer(n),t.bindGroupTime.modified(),t.sendDirty=!1}t.sendDirty&&(e.getHandle().queue.writeBuffer(t.UBO.getHandle(),0,t.arrayBuffer,0,t.sizeInBytes),t.sendDirty=!1),t.sendTime.modified()},e.createView=function(e){e in t===!1&&(t.arrayBuffer||(t.arrayBuffer=new ArrayBuffer(t.sizeInBytes)),t[e]=nn.newTypedArray(e,t.arrayBuffer))},e.setValue=function(n,r){e.sortBufferEntries();var a=t._bufferEntryNames.get(n);if(void 0!==a){var o=t.bufferEntries[a];e.createView(o.nativeType);var i=t[o.nativeType];o.lastValue!==r&&(i[o.offset/i.BYTES_PER_ELEMENT]=r,t.sendDirty=!0),o.lastValue=r}else gl("entry named ".concat(n," not found in UBO"))},e.setArray=function(n,r){e.sortBufferEntries();var a=t._bufferEntryNames.get(n);if(void 0!==a){var o=t.bufferEntries[a];e.createView(o.nativeType);for(var i=t[o.nativeType],s=!1,l=0;l<r.length;l++)o.lastValue&&o.lastValue[l]===r[l]||(i[o.offset/i.BYTES_PER_ELEMENT+l]=r[l],s=!0);s&&(t.sendDirty=!0,o.lastValue=Te(r))}else gl("entry named ".concat(n," not found in UBO"))},e.getBindGroupEntry=function(){var e={resource:{buffer:t.UBO.getHandle()}};return e},e.getSendTime=function(){return t.sendTime.getMTime()},e.getShaderCode=function(n,r){e.sortBufferEntries();for(var a=["struct ".concat(t.label,"Struct\n{")],o=0;o<t.bufferEntries.length;o++){var i=t.bufferEntries[o];a.push("  ".concat(i.name,": ").concat(i.type,","))}return a.push("};\n@binding(".concat(n,") @group(").concat(r,") var<uniform> ").concat(t.label,": ").concat(t.label,"Struct;")),a.join("\n")}}var hl={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function yl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,hl,n),nn.obj(e,t),t._bufferEntryNames=new Map,t.bufferEntries=[],t.bindGroupLayoutEntry=t.bindGroupLayoutEntry||{buffer:{type:"uniform"}},t.sendTime={},nn.obj(t.sendTime,{mtime:0}),t.bindGroupTime={},nn.obj(t.bindGroupTime,{mtime:0}),t.sendDirty=!0,t.sortDirty=!0,nn.get(e,t,["binding","bindGroupTime"]),nn.setGet(e,t,["bindGroupLayoutEntry","device","label","sizeInBytes"]),vl(e,t)}var bl=nn.newInstance(yl,"vtkWebGPUUniformBuffer"),xl={newInstance:bl,extend:yl},Tl=st,Sl="\n//VTK::Renderer::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output: fragmentOutput;\n\n  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;\n\n  //VTK::RenderEncoder::Impl\n  return output;\n}\n",Ol="\nfn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {\n  var tau: f32 = 6.28318530718;\n  var pi: f32 = 3.14159265359;\n  var out: vec2<f32> = vec2<f32>(0.0);\n\n  out.x = atan2(dir.z, dir.x) / tau;\n  out.x += 0.5;\n\n  var phix: f32 = length(vec2(dir.x, dir.z));\n  out.y = atan2(dir.y, phix) / pi + 0.5;\n\n  return out;\n}\n\n//VTK::Renderer::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output: fragmentOutput;\n\n  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);\n  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);\n  // textureSampleLevel gets rid of some ugly artifacts\n  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0);\n  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);\n\n  //VTK::RenderEncoder::Impl\n  return output;\n}\n",wl=new Float64Array(16),Al=new Float64Array(16);function Pl(e){return e.getPositional()?e.getConeAngle()>=90?0:2:1}function Il(e,t){t.classHierarchy.push("vtkWebGPURenderer"),e.buildPass=function(n){if(n){if(!t.renderable)return;t.camera=t.renderable.getActiveCamera(),e.updateLights(),e.prepareNodes(),e.addMissingNode(t.camera),e.addMissingNodes(t.renderable.getViewPropsWithNestedProps()),e.removeUnusedNodes(),t.webgpuCamera=e.getViewNodeFor(t.camera),e.updateStabilizedMatrix()}},e.updateStabilizedMatrix=function(){var e=t.camera.getClippingRange(),n=t.camera.getPositionByReference(),r=t.camera.getDirectionOfProjectionByReference(),a=[],o=[];wr(o,r,.5*(e[0]+e[1])),Tr(a,n,o),kr(o,a,t.stabilizedCenter);var i=Lr(o);i/(e[1]-e[0])>t.recenterThreshold&&(t.stabilizedCenter=a,t.stabilizedTime.modified())},e.updateLights=function(){for(var e=0,n=t.renderable.getLightsByReference(),r=0;r<n.length;++r)n[r].getSwitch()>0&&e++;return e||(Tl("No lights are on, creating one."),t.renderable.createLight()),e},e.updateUBO=function(){var n=t.UBO.getSendTime();if(t._parent.getMTime()>n||e.getMTime()>n||t.camera.getMTime()>n||t.renderable.getMTime()>n){var r,a=t.webgpuCamera.getKeyMatrices(e);t.UBO.setArray("WCVCMatrix",a.wcvc),t.UBO.setArray("SCPCMatrix",a.scpc),t.UBO.setArray("PCSCMatrix",a.pcsc),t.UBO.setArray("SCVCMatrix",a.scvc),t.UBO.setArray("VCPCMatrix",a.vcpc),t.UBO.setArray("WCVCNormals",a.normalMatrix),t.UBO.setValue("LightCount",t.renderable.getLights().length),t.UBO.setValue("MaxEnvironmentMipLevel",null===(r=t.renderable.getEnvironmentTexture())||void 0===r?void 0:r.getMipLevel()),t.UBO.setValue("BackgroundDiffuseStrength",t.renderable.getEnvironmentTextureDiffuseStrength()),t.UBO.setValue("BackgroundSpecularStrength",t.renderable.getEnvironmentTextureSpecularStrength());var o=e.getYInvertedTiledSizeAndOrigin();t.UBO.setArray("viewportSize",[o.usize,o.vsize]),t.UBO.setValue("cameraParallel",t.camera.getParallelProjection());var i=t._parent.getDevice();t.UBO.sendIfNeeded(i)}},e.updateSSBO=function(){for(var n=t.renderable.getLights(),r=t.webgpuCamera.getKeyMatrices(e),a="".concat(t.renderable.getMTime()),o=0;o<n.length;o++)a+=n[o].getMTime();if(a!==t.lightTimeString){for(var i=new Float32Array(4*n.length),s=new Float32Array(4*n.length),l=new Float32Array(4*n.length),c=new Float32Array(4*n.length),u=0;u<n.length;u++){var f=4*u,d=n[u].getPosition();Er(d,d,r.wcvc),i[f]=d[0],i[f+1]=d[1],i[f+2]=d[2],i[f+3]=0,s[f]=-n[u].getDirection()[0],s[f+1]=-n[u].getDirection()[1],s[f+2]=-n[u].getDirection()[2],s[f+3]=0,l[f]=n[u].getColor()[0],l[f+1]=n[u].getColor()[1],l[f+2]=n[u].getColor()[2],l[f+3]=5*n[u].getIntensity(),c[f]=Pl(n[u]),c[f+1]=Math.cos(Un(n[u].getConeAngle())),c[f+2]=Math.cos(Un(n[u].getConeAngle()+n[u].getConeFalloff())),c[f+3]=0}t.SSBO.clearData(),t.SSBO.setNumberOfInstances(n.length),t.SSBO.addEntry("LightPos","vec4<f32>"),t.SSBO.addEntry("LightDir","vec4<f32>"),t.SSBO.addEntry("LightColor","vec4<f32>"),t.SSBO.addEntry("LightData","vec4<f32>"),t.SSBO.setAllInstancesFromArray("LightPos",i),t.SSBO.setAllInstancesFromArray("LightDir",s),t.SSBO.setAllInstancesFromArray("LightColor",l),t.SSBO.setAllInstancesFromArray("LightData",c);var p=t._parent.getDevice();t.SSBO.send(p)}t.lightTimeString=a},e.scissorAndViewport=function(t){var n=e.getYInvertedTiledSizeAndOrigin();t.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),t.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},e.bindUBO=function(e){e.activateBindGroup(t.bindGroup)},e.opaquePass=function(n){n?(t.renderEncoder.begin(t._parent.getCommandEncoder()),e.updateUBO(),e.updateSSBO()):(e.scissorAndViewport(t.renderEncoder),e.clear(),t.renderEncoder.end())},e.clear=function(){var n;if(!t.renderable.getTransparent()&&!t.suppressClear){var r=t._parent.getDevice();if(!t.clearFSQ){t.clearFSQ=as.newInstance(),t.clearFSQ.setDevice(r),t.clearFSQ.setPipelineHash("clearfsq"),t.clearFSQ.setFragmentShaderTemplate(Sl);var a=xl.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),t.clearFSQ.setUBO(a),t.backgroundTex=t.renderable.getEnvironmentTexture()}if("clearfsqwithtexture"!==t.clearFSQ.getPipelineHash()&&t.renderable.getUseEnvironmentTextureAsBackground()&&null!==(n=t.backgroundTex)&&void 0!==n&&n.getImageLoaded()){t.clearFSQ.setFragmentShaderTemplate(Ol);var o=xl.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),t.clearFSQ.setUBO(o);var i=r.getTextureManager().getTextureForVTKTexture(t.backgroundTex);if(i.getReady()){var s=i.createView("EnvironmentTexture");t.clearFSQ.setTextureViews([s]),t.backgroundTexLoaded=!0;var l=t.backgroundTex.getInterpolate()?"linear":"nearest";s.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:l,magFilter:l,mipmapFilter:"linear"})}t.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if("clearfsqwithtexture"===t.clearFSQ.getPipelineHash()&&!t.renderable.getUseEnvironmentTextureAsBackground()){t.clearFSQ=as.newInstance(),t.clearFSQ.setDevice(r),t.clearFSQ.setPipelineHash("clearfsq"),t.clearFSQ.setFragmentShaderTemplate(Sl);var c=xl.newInstance({label:"mapperUBO"});c.addEntry("FSQMatrix","mat4x4<f32>"),c.addEntry("BackgroundColor","vec4<f32>"),t.clearFSQ.setUBO(c)}var u=t.webgpuCamera.getKeyMatrices(e),f=t.renderable.getBackgroundByReference();t.clearFSQ.getUBO().setArray("BackgroundColor",f),K(Al,u.normalMatrix),ae(wl,u.scvc,u.pcsc),ae(wl,Al,wl),t.clearFSQ.getUBO().setArray("FSQMatrix",wl),t.clearFSQ.getUBO().sendIfNeeded(r),t.clearFSQ.prepareAndDraw(t.renderEncoder)}},e.translucentPass=function(n){n?t.renderEncoder.begin(t._parent.getCommandEncoder()):(e.scissorAndViewport(t.renderEncoder),t.renderEncoder.end())},e.volumeDepthRangePass=function(n){n?t.renderEncoder.begin(t._parent.getCommandEncoder()):(e.scissorAndViewport(t.renderEncoder),t.renderEncoder.end())},e.getAspectRatio=function(){var e=t._parent.getSizeByReference(),n=t.renderable.getViewportByReference();return e[0]*(n[2]-n[0])/((n[3]-n[1])*e[1])},e.convertToOpenGLDepth=function(e){return t.webgpuCamera.convertToOpenGLDepth(e)},e.getYInvertedTiledSizeAndOrigin=function(){var n=e.getTiledSizeAndOrigin(),r=t._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},e.getTiledSizeAndOrigin=function(){var e=t.renderable.getViewportByReference(),n=[0,0,1,1],r=e[0]-n[0],a=e[1]-n[1],o=t._parent.normalizedDisplayToDisplay(r,a),i=Math.round(o[0]),s=Math.round(o[1]),l=e[2]-n[0],c=e[3]-n[1],u=t._parent.normalizedDisplayToDisplay(l,c),f=Math.round(u[0])-i,d=Math.round(u[1])-s;return f<0&&(f=0),d<0&&(d=0),{usize:f,vsize:d,lowerLeftU:i,lowerLeftV:s}},e.getPropFromID=function(e){for(var n=0;n<t.children.length;n++){var r=t.children[n].getPropID?t.children[n].getPropID():-1;if(r===e)return t.children[n]}return null},e.getStabilizedTime=function(){return t.stabilizedTime.getMTime()},e.releaseGraphicsResources=function(){null!==t.selector&&t.selector.releaseGraphicsResources()}}var Cl={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function El(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Cl,n),un.extend(e,t,n),t.UBO=xl.newInstance({label:"rendererUBO"}),t.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),t.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),t.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),t.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),t.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),t.UBO.addEntry("WCVCNormals","mat4x4<f32>"),t.UBO.addEntry("viewportSize","vec2<f32>"),t.UBO.addEntry("LightCount","i32"),t.UBO.addEntry("MaxEnvironmentMipLevel","f32"),t.UBO.addEntry("BackgroundDiffuseStrength","f32"),t.UBO.addEntry("BackgroundSpecularStrength","f32"),t.UBO.addEntry("cameraParallel","u32"),t.SSBO=pl.newInstance({label:"rendererLightSSBO"}),t.lightTimeString="",t.bindGroup=ui.newInstance({label:"rendererBG"}),t.bindGroup.setBindables([t.UBO,t.SSBO]),t.tmpMat4=W(new Float64Array(16)),t.stabilizedTime={},Pt(t.stabilizedTime,{mtime:0}),Ct(e,t,["bindGroup","stabilizedTime"]),kt(e,t,["stabilizedCenter"]),Dt(e,t,["renderEncoder","selector","suppressClear","UBO"]),Il(e,t)}var Ml=_t(El,"vtkWebGPURenderer");function Rl(e,t){t.classHierarchy.push("vtkWebGPUSampler"),e.create=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.device=e,t.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",t.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",t.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",t.options.magFilter=n.magFilter?n.magFilter:"nearest",t.options.minFilter=n.minFilter?n.minFilter:"nearest",t.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",t.options.label=t.label,t.handle=t.device.getHandle().createSampler(t.options),t.bindGroupTime.modified()},e.getShaderCode=function(e,n){var r="@binding(".concat(e,") @group(").concat(n,") var ").concat(t.label,": sampler;");return r},e.getBindGroupEntry=function(){var e={resource:t.handle};return e}}Jo("vtkRenderer",Ml);var Dl={device:null,handle:null,label:null,options:null};function kl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Dl,n),nn.obj(e,t),t.options={},t.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},t.bindGroupTime={},nn.obj(t.bindGroupTime,{mtime:0}),nn.get(e,t,["bindGroupTime","handle","options"]),nn.setGet(e,t,["bindGroupLayoutEntry","device","label"]),Rl(e,t)}var Ll=nn.newInstance(kl),Bl={newInstance:Ll,extend:kl},Vl=Rn.SlicingMode,Fl="\n//VTK::Renderer::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Image::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output: fragmentOutput;\n\n  //VTK::Image::Sample\n\n  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);\n\n//VTK::RenderEncoder::Impl\n\n  return output;\n}\n";function Nl(e,t,n){var r=t.apply(e);if(r){var a=e.getIndependentComponents();return"".concat(e.getMTime(),"-").concat(a,"-").concat(n)}return"0"}var Ul=new Float64Array(16),_l=new Float64Array(16),Gl=new Float64Array(16),zl=new Float64Array(4),jl=new Float64Array(4);function Wl(e,t){t.classHierarchy.push("vtkWebGPUImageMapper"),e.buildPass=function(n){if(n){t.WebGPUImageSlice=e.getFirstAncestorOfType("vtkWebGPUImageSlice"),t.WebGPURenderer=t.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent(),t.device=t.WebGPURenderWindow.getDevice();var r=t.WebGPURenderer.getRenderable();t.renderable.getSliceAtFocalPoint()&&t.renderable.setSliceFromCamera(r.getActiveCamera())}},e.translucentPass=function(t){t&&e.render()},e.opaquePass=function(t){t&&e.render()},e.render=function(){t.renderable.update(),t.currentInput=t.renderable.getInputData(),e.prepareToDraw(t.WebGPURenderer.getRenderEncoder()),t.renderEncoder.registerDrawCallback(t.pipeline,e.draw)},e.computePipelineHash=function(){var e=t.currentInput.getExtent();e[0]===e[1]||e[2]===e[3]||e[4]===e[5]?(t.dimensions=2,t.pipelineHash="img2"):(t.dimensions=3,t.pipelineHash="img3")},e.updateUBO=function(){var n=t.UBO.getSendTime(),r=t.WebGPUImageSlice.getRenderable(),a=r.getMapper();if(e.getMTime()>n||t.renderable.getMTime()>n||r.getProperty().getMTime()>n){var o=a.getInputData(),i=t.WebGPURenderer.getStabilizedCenterByReference();W(Ul),q(Ul,Ul,i);var s=r.getMatrix();K(_l,s),H(_l,_l),X(Ul,_l,Ul);var l=o.getWorldToIndex();X(Ul,l,Ul),H(Gl,Ul),Q(_l,[.5,.5,.5]),X(Ul,_l,Ul);var c=o.getDimensions();W(_l),Y(_l,_l,[1/c[0],1/c[1],1/c[2]]),X(Ul,_l,Ul),t.UBO.setArray("SCTCMatrix",Ul);var u=t.currentInput.getExtent(),f=t.renderable.getClosestIJKAxis(),d=f.ijkMode,p=t.renderable.getSlice();d!==t.renderable.getSlicingMode()&&(p=t.renderable.getSliceAtPosition(p));var m=2,g=0,v=1;d===Vl.I?(m=0,g=1,v=2):d===Vl.J&&(m=1,g=2,v=0),zl[m]=p,zl[g]=u[2*g]-.5,zl[v]=u[2*v]-.5,zl[3]=1,Nr(zl,zl,Gl),t.UBO.setArray("Origin",zl),jl[m]=p,jl[g]=u[2*g+1]+.5,jl[v]=u[2*v]-.5,jl[3]=1,Nr(jl,jl,Gl),Vr(jl,jl,zl),jl[3]=1,t.UBO.setArray("Axis1",jl),jl[m]=p,jl[g]=u[2*g]-.5,jl[v]=u[2*v+1]+.5,jl[3]=1,Nr(jl,jl,Gl),Vr(jl,jl,zl),jl[3]=1,t.UBO.setArray("Axis2",jl);for(var h=[1,1,1,1],y=[0,0,0,0],b=t.textureViews[0],x=b.getTexture().getScale(),T=b.getTexture().getNumberOfComponents(),S=!1,O=0;O<T;O++){var w=r.getProperty().getColorWindow(),A=r.getProperty().getColorLevel(),P=S?O:0,I=r.getProperty().getRGBTransferFunction(P);if(I){var C=I.getRange();w=C[1]-C[0],A=.5*(C[1]+C[0])}h[O]=x/w,y[O]=-A/w+.5}t.UBO.setArray("cScale",h),t.UBO.setArray("cShift",y),t.UBO.sendIfNeeded(t.device)}},e.updateLUTImage=function(){var n=t.WebGPUImageSlice.getRenderable().getProperty(),r=e.getTextureViews()[0];r.getTexture().getNumberOfComponents();var a=1,o=Nl(n,n.getRGBTransferFunction,a);if(t.colorTextureString!==o){t.numRows=a;var i=new Uint8Array(2*t.numRows*t.rowLength*4),s=n.getRGBTransferFunction();if(s)for(var l=new Float32Array(3*t.rowLength),c=0;c<a;c++){s=n.getRGBTransferFunction(c);var u=s.getRange();s.getTable(u[0],u[1],t.rowLength,l,1);for(var f=0;f<t.rowLength;f++){var d=c*t.rowLength*8+4*f;i[d]=255*l[3*f],i[d+1]=255*l[3*f+1],i[d+2]=255*l[3*f+2],i[d+3]=255;for(var p=0;p<4;p++)i[d+4*t.rowLength+p]=i[d+p]}}else for(var m=0;m<t.rowLength;++m){var g=255*m/(t.rowLength-1);i[4*m]=g,i[4*m+1]=g,i[4*m+2]=g,i[4*m+3]=255;for(var v=0;v<4;v++)i[4*m+4*t.rowLength+v]=i[4*m+v]}var h={nativeArray:i,width:t.rowLength,height:2*t.numRows,depth:1,format:"rgba8unorm"},y=t.device.getTextureManager().getTexture(h),b=y.createView("tfunTexture");t.textureViews[1]=b,t.colorTextureString=o}};var n=e.updateBuffers;e.updateBuffers=function(){n();var r=t.device.getTextureManager().getTextureForImageData(t.currentInput),a=t.textureViews;if(!a[0]||a[0].getTexture()!==r){var o=r.createView("imgTexture");a[0]=o}e.updateLUTImage(),e.updateUBO();var i=t.WebGPUImageSlice.getRenderable().getProperty(),s=i.getInterpolationType()===oo.NEAREST?"nearest":"linear";t.clampSampler&&s===t.clampSampler.getOptions().minFilter||(t.clampSampler=Bl.newInstance({label:"clampSampler"}),t.clampSampler.create(t.device,{minFilter:s,magFilter:s}),t.additionalBindables=[t.clampSampler])};var r=e.getShaderReplacements();e.replaceShaderPosition=function(e,n,r){var a=n.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");var o=a.getCode(),i=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];2===t.dimensions?i.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):i.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),i.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),o=Ti.substitute(o,"//VTK::Position::Impl",i).result,a.setCode(o)},r.set("replaceShaderPosition",e.replaceShaderPosition),e.replaceShaderTCoord=function(e,n,r){var a=n.getShaderDescription("vertex");2===t.dimensions?a.addOutput("vec2<f32>","tcoordVS"):a.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",e.replaceShaderTCoord),e.replaceShaderImage=function(e,n,r){var a=n.getShaderDescription("fragment"),o=a.getCode();o=(t.dimensions,Ti.substitute(o,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result),o=Ti.substitute(o,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,a.setCode(o)},r.set("replaceShaderImage",e.replaceShaderImage)}var Kl={rowLength:1024};function Hl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Kl,n),as.extend(e,t,n),e.setFragmentShaderTemplate(Fl),t.UBO=xl.newInstance({label:"mapperUBO"}),t.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),t.UBO.addEntry("Origin","vec4<f32>"),t.UBO.addEntry("Axis2","vec4<f32>"),t.UBO.addEntry("Axis1","vec4<f32>"),t.UBO.addEntry("cScale","vec4<f32>"),t.UBO.addEntry("cShift","vec4<f32>"),t.lutBuildTime={},Pt(t.lutBuildTime,{mtime:0}),t.imagemat=W(new Float64Array(16)),t.imagematinv=W(new Float64Array(16)),t.VBOBuildTime={},Pt(t.VBOBuildTime),Wl(e,t)}var Xl=_t(Hl,"vtkWebGPUImageMapper");function ql(e,t){t.classHierarchy.push("vtkWebGPUImageSlice"),e.buildPass=function(n){if(t.renderable&&t.renderable.getVisibility()&&n){if(!t.renderable)return;t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),void 0===t.propID&&(t.propID=t.WebGPURenderWindow.getUniquePropID()),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes()}},e.traverseOpaquePass=function(n){t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t.WebGPURenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children.forEach((function(e){e.traverse(n)})),e.apply(n,!1))},e.traverseTranslucentPass=function(n){!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t.WebGPURenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.children.forEach((function(e){e.traverse(n)})),e.apply(n,!1))},e.queryPass=function(e,n){if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.getBufferShift=function(n){return e.getKeyMatrices(n),t.bufferShift},e.getKeyMatrices=function(e){if(Math.max(t.renderable.getMTime(),e.getStabilizedTime())>t.keyMatricesTime.getMTime()){t.renderable.computeMatrix();var n=t.renderable.getMatrix(),r=e.getStabilizedCenterByReference();t.bufferShift[0]=n[3]-r[0],t.bufferShift[1]=n[7]-r[1],t.bufferShift[2]=n[11]-r[2],K(t.keyMatrices.bcwc,n),t.renderable.getIsIdentity()?W(t.keyMatrices.normalMatrix):(j(t.keyMatrices.normalMatrix,t.keyMatrices.bcwc),t.keyMatrices.normalMatrix[3]=0,t.keyMatrices.normalMatrix[7]=0,t.keyMatrices.normalMatrix[11]=0,H(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),K(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix)),q(t.keyMatrices.bcwc,t.keyMatrices.bcwc,[-t.bufferShift[0],-t.bufferShift[1],-t.bufferShift[2]]),q(t.keyMatrices.bcsc,t.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]),t.keyMatricesTime.modified()}return t.keyMatrices}}Jo("vtkImageMapper",Xl);var Yl={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function Zl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Yl,n),un.extend(e,t,n),t.keyMatricesTime={},Pt(t.keyMatricesTime,{mtime:0}),t.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},t.keyMatrixTime={},Pt(t.keyMatrixTime,{mtime:0}),t.keyMatrices={mcwc:W(new Float64Array(16))},t.bufferShift=[0,0,0,0],Ct(e,t,["propID","keyMatricesTime"]),ql(e,t)}var $l=_t(Zl,"vtkWebGPUImageSlice");function Jl(e,t){t.classHierarchy.push("vtkWebGPUVolume"),e.buildPass=function(n){t.renderable&&t.renderable.getVisibility()&&n&&(t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),void 0===t.propID&&(t.propID=t.WebGPURenderWindow.getUniquePropID()),t.renderable.getMapper().update())},e.queryPass=function(n,r){if(n){if(!t.renderable||!t.renderable.getVisibility())return;var a=t.renderable.getMapper().getBounds();if(!a||6!==a.length||a[0]>a[1])return;r.addVolume(e)}};var n=new Float64Array(3),r=new Float64Array(3);e.getBoundingCubePoints=function(e,a){var o=t.renderable.getMapper().getInputData();if(o)for(var i=o.getExtent(),s=t.renderable.getMatrix(),l=0,c=4;c<6;c++){n[2]=i[c];for(var u=2;u<4;u++){n[1]=i[u];for(var f=0;f<2;f++){n[0]=i[f],o.indexToWorld(n,r);var d=a+3*l;e[d++]=s[0]*r[0]+s[1]*r[1]+s[2]*r[2]+s[3],e[d++]=s[4]*r[0]+s[5]*r[1]+s[6]*r[2]+s[7],e[d++]=s[8]*r[0]+s[9]*r[1]+s[10]*r[2]+s[11],l++}}}},e.getKeyMatrices=function(e){if(Math.max(t.renderable.getMTime(),e.getStabilizedTime())>t.keyMatricesTime.getMTime()){t.renderable.computeMatrix();var n=t.renderable.getMatrix(),r=e.getStabilizedCenterByReference();K(t.keyMatrices.bcwc,n),q(t.keyMatrices.bcsc,t.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]),t.keyMatricesTime.modified()}return t.keyMatrices}}Jo("vtkImageSlice",$l);var Ql={propID:void 0,keyMatricesTime:null};function ec(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ql,n),un.extend(e,t,n),t.keyMatricesTime={},nn.obj(t.keyMatricesTime,{mtime:0}),t.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},nn.get(e,t,["propID","keyMatricesTime"]),Jl(e,t)}var tc=nn.newInstance(ec,"vtkWebGPUVolume");function nc(e,t){t.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),e.opaquePass=function(n,r){t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent();var a=t.WebGPURenderer.getAspectRatio(),o=t.WebGPURenderer?t.WebGPURenderer.getRenderable().getActiveCamera():null,i=t.WebGPURenderer.getTiledSizeAndOrigin(),s=null;t.renderable.getUseZValues(),t.renderable.invokeCallback(t.renderable.getInputData(),o,a,i,s)}}Jo("vtkVolume",tc);var rc={};function ac(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,rc,n),un.extend(e,t,n),nc(e,t)}var oc=nn.newInstance(ac,"vtkWebGPUPixelSpaceCallbackMapper");Jo("vtkPixelSpaceCallbackMapper",oc);n(2801),n(541);var ic=Uint8Array,sc=Uint16Array,lc=Uint32Array,cc=new ic([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uc=new ic([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fc=new ic([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dc=function(e,t){for(var n=new sc(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var a=new lc(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)a[o]=o-n[r]<<5|r;return[n,a]},pc=dc(cc,2),mc=pc[0],gc=pc[1];mc[28]=258,gc[258]=28;for(var vc=dc(uc,0),hc=vc[0],yc=(vc[1],new sc(32768)),bc=0;bc<32768;++bc){var xc=(43690&bc)>>>1|(21845&bc)<<1;xc=(52428&xc)>>>2|(13107&xc)<<2,xc=(61680&xc)>>>4|(3855&xc)<<4,yc[bc]=((65280&xc)>>>8|(255&xc)<<8)>>>1}var Tc=function(e,t,n){for(var r=e.length,a=0,o=new sc(t);a<r;++a)e[a]&&++o[e[a]-1];var i,s=new sc(t);for(a=0;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;if(n){i=new sc(1<<t);var l=15-t;for(a=0;a<r;++a)if(e[a])for(var c=a<<4|e[a],u=t-e[a],f=s[e[a]-1]++<<u,d=f|(1<<u)-1;f<=d;++f)i[yc[f]>>>l]=c}else for(i=new sc(r),a=0;a<r;++a)e[a]&&(i[a]=yc[s[e[a]-1]++]>>>15-e[a]);return i},Sc=new ic(288);for(bc=0;bc<144;++bc)Sc[bc]=8;for(bc=144;bc<256;++bc)Sc[bc]=9;for(bc=256;bc<280;++bc)Sc[bc]=7;for(bc=280;bc<288;++bc)Sc[bc]=8;var Oc=new ic(32);for(bc=0;bc<32;++bc)Oc[bc]=5;var wc=Tc(Sc,9,1),Ac=Tc(Oc,5,1),Pc=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Ic=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},Cc=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Ec=function(e){return(e+7)/8|0},Mc=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(2==e.BYTES_PER_ELEMENT?sc:4==e.BYTES_PER_ELEMENT?lc:ic)(n-t);return r.set(e.subarray(t,n)),r},Rc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Dc=function(e,t,n){var r=new Error(t||Rc[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Dc),!n)throw r;return r},kc=function(e,t,n){var r=e.length;if(!r||n&&n.f&&!n.l)return t||new ic(0);var a=!t||n,o=!n||n.i;n||(n={}),t||(t=new ic(3*r));var i=function(e){var n=t.length;if(e>n){var r=new ic(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,l=n.p||0,c=n.b||0,u=n.l,f=n.d,d=n.m,p=n.n,m=8*r;do{if(!u){s=Ic(e,l,1);var g=Ic(e,l+1,3);if(l+=3,!g){var v=Ec(l)+4,h=e[v-4]|e[v-3]<<8,y=v+h;if(y>r){o&&Dc(0);break}a&&i(c+h),t.set(e.subarray(v,y),c),n.b=c+=h,n.p=l=8*y,n.f=s;continue}if(1==g)u=wc,f=Ac,d=9,p=5;else if(2==g){var b=Ic(e,l,31)+257,x=Ic(e,l+10,15)+4,T=b+Ic(e,l+5,31)+1;l+=14;for(var S=new ic(T),O=new ic(19),w=0;w<x;++w)O[fc[w]]=Ic(e,l+3*w,7);l+=3*x;var A=Pc(O),P=(1<<A)-1,I=Tc(O,A,1);for(w=0;w<T;){var C=I[Ic(e,l,P)];l+=15&C;v=C>>>4;if(v<16)S[w++]=v;else{var E=0,M=0;16==v?(M=3+Ic(e,l,3),l+=2,E=S[w-1]):17==v?(M=3+Ic(e,l,7),l+=3):18==v&&(M=11+Ic(e,l,127),l+=7);while(M--)S[w++]=E}}var R=S.subarray(0,b),D=S.subarray(b);d=Pc(R),p=Pc(D),u=Tc(R,d,1),f=Tc(D,p,1)}else Dc(1);if(l>m){o&&Dc(0);break}}a&&i(c+131072);for(var k=(1<<d)-1,L=(1<<p)-1,B=l;;B=l){E=u[Cc(e,l)&k];var V=E>>>4;if(l+=15&E,l>m){o&&Dc(0);break}if(E||Dc(2),V<256)t[c++]=V;else{if(256==V){B=l,u=null;break}var F=V-254;if(V>264){w=V-257;var N=cc[w];F=Ic(e,l,(1<<N)-1)+mc[w],l+=N}var U=f[Cc(e,l)&L],_=U>>>4;U||Dc(3),l+=15&U;D=hc[_];if(_>3){N=uc[_];D+=Cc(e,l)&(1<<N)-1,l+=N}if(l>m){o&&Dc(0);break}a&&i(c+131072);for(var G=c+F;c<G;c+=4)t[c]=t[c-D],t[c+1]=t[c+1-D],t[c+2]=t[c+2-D],t[c+3]=t[c+3-D];c=G}}n.l=u,n.p=B,n.b=c,n.f=s,u&&(s=1,n.m=d,n.d=f,n.n=p)}while(!s);return c==t.length?t:Mc(t,0,c)},Lc=new ic(0),Bc=function(e,t){return e[t]|e[t+1]<<8},Vc=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Fc=function(e,t){return Vc(e,t)+4294967296*Vc(e,t+4)},Nc=function(e){31==e[0]&&139==e[1]&&8==e[2]||Dc(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},Uc=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},_c=function(e){(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)&&Dc(6,"invalid zlib data"),32&e[1]&&Dc(6,"invalid zlib data: preset dictionaries not supported")};function Gc(e,t){return kc(e,t)}function zc(e,t){return kc(e.subarray(Nc(e),-8),t||new ic(Uc(e)))}function jc(e,t){return kc((_c(e),e.subarray(2,-4)),t)}function Wc(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?zc(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Gc(e,t):jc(e,t)}var Kc="undefined"!=typeof TextEncoder&&new TextEncoder,Hc="undefined"!=typeof TextDecoder&&new TextDecoder;try{Hc.decode(Lc,{stream:!0}),1}catch(bp){}var Xc=function(e){for(var t="",n=0;;){var r=e[n++],a=(r>127)+(r>223)+(r>239);if(n+a>e.length)return[t,Mc(e,n-1)];a?3==a?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&a?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}};function qc(e,t){if(t){for(var n=new ic(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(Kc)return Kc.encode(e);var a=e.length,o=new ic(e.length+(e.length>>1)),i=0,s=function(e){o[i++]=e};for(r=0;r<a;++r){if(i+5>o.length){var l=new ic(i+8+(a-r<<1));l.set(o),o=l}var c=e.charCodeAt(r);c<128||t?s(c):c<2048?(s(192|c>>6),s(128|63&c)):c>55295&&c<57344?(c=65536+(1047552&c)|1023&e.charCodeAt(++r),s(240|c>>18),s(128|c>>12&63),s(128|c>>6&63),s(128|63&c)):(s(224|c>>12),s(128|c>>6&63),s(128|63&c))}return Mc(o,0,i)}function Yc(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Hc)return Hc.decode(e);var a=Xc(e),o=a[0],i=a[1];return i.length&&Dc(8),o}var Zc=function(e,t){return t+30+Bc(e,t+26)+Bc(e,t+28)},$c=function(e,t,n){var r=Bc(e,t+28),a=Yc(e.subarray(t+46,t+46+r),!(2048&Bc(e,t+8))),o=t+46+r,i=Vc(e,t+20),s=n&&4294967295==i?Jc(e,o):[i,Vc(e,t+24),Vc(e,t+42)],l=s[0],c=s[1],u=s[2];return[Bc(e,t+10),l,c,a,o+Bc(e,t+30)+Bc(e,t+32),u]},Jc=function(e,t){for(;1!=Bc(e,t);t+=4+Bc(e,t+2));return[Fc(e,t+12),Fc(e,t+4),Fc(e,t+20)]};"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function Qc(e,t){for(var n={},r=e.length-22;101010256!=Vc(e,r);--r)(!r||e.length-r>65558)&&Dc(13);var a=Bc(e,r+8);if(!a)return{};var o=Vc(e,r+16),i=4294967295==o;i&&(r=Vc(e,r-12),101075792!=Vc(e,r)&&Dc(13),a=Vc(e,r+32),o=Vc(e,r+48));for(var s=t&&t.filter,l=0;l<a;++l){var c=$c(e,o,i),u=c[0],f=c[1],d=c[2],p=c[3],m=c[4],g=c[5],v=Zc(e,g);o=m,s&&!s({name:p,size:f,originalSize:d,compression:u})||(u?8==u?n[p]=Gc(e.subarray(v,v+f),new ic(d)):Dc(14,"unknown compression type "+u):n[p]=Mc(e,v,v+f))}return n}var eu=[];eu["-".charCodeAt(0)]=62,eu["_".charCodeAt(0)]=63;for(var tu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nu=0;nu<tu.length;nu++)eu[tu.charCodeAt(nu)]=nu;function ru(e){return void 0!==eu[e.charCodeAt(0)]}function au(e){for(var t=e.length,n=[],r=null,a=0;a<t;a++)ru(e[a])?(r||(r={start:a,count:0}),r.count++,r.end=a):"="===e[a]&&r&&(n.push(r),r=null);return r&&n.push(r),n}function ou(e,t,n,r){for(var a=t.start,o=t.count,i=o%4,s=Math.floor(o/4),l=a,c=null,u=n,f=0;f<s;f++){while(!ru(e[l]))l++;c=eu[e.charCodeAt(l++)]<<18;while(!ru(e[l]))l++;c|=eu[e.charCodeAt(l++)]<<12;while(!ru(e[l]))l++;c|=eu[e.charCodeAt(l++)]<<6;while(!ru(e[l]))l++;c|=eu[e.charCodeAt(l++)],r[u++]=c>>16&255,r[u++]=c>>8&255,r[u++]=255&c}switch(i){case 3:while(!ru(e[l]))l++;c=eu[e.charCodeAt(l++)]<<10;while(!ru(e[l]))l++;c|=eu[e.charCodeAt(l++)]<<4;while(!ru(e[l]))l++;c|=eu[e.charCodeAt(l++)]>>2,r[u++]=c>>8&255,r[u++]=255&c;break;case 2:while(!ru(e[l]))l++;c=eu[e.charCodeAt(l++)]<<2;while(!ru(e[l]))l++;c|=eu[e.charCodeAt(l++)]>>4,r[u++]=255&c;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return u}function iu(e){for(var t=au(e),n=t[t.length-1].end+1,r=(4-n%4)%4,a=3*(n+r)/4-r,o=new ArrayBuffer(a),i=new Uint8Array(o),s=0,l=0;l<t.length;l++)s+=ou(e,t[l],s,i),s+=(4-t[l].count%4)%4;return o}function su(e,t,n){var r=(e<<16)+(t<<8)+n;return tu[r>>18]+tu[r>>12&63]+tu[r>>6&63]+tu[63&r]}function lu(e){for(var t=new Uint8Array(e),n=e.byteLength%3,r=e.byteLength-n,a=Array(r/3),o=0;o<a.length;o++){var i=3*o;a[o]=su(t[i],t[i+1],t[i+2])}if(n>0){var s=su(t[r],t[r+1]||0,t[r+2]||0);1===n?a.push("".concat(s.substr(0,2),"==")):2===n&&a.push("".concat(s.substr(0,3),"="))}return a.join("")}var cu={toArrayBuffer:iu,fromArrayBuffer:lu};function uu(){var e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return t[0]=161,t[1]=178,t[2]=195,t[3]=212,3569595041===n[0]?"LittleEndian":2712847316===n[0]?"BigEndian":null}var fu=uu();function du(e,t){if(!(t<2))for(var n=new Int8Array(e),r=n.length,a=[],o=0;o<r;o+=t){for(var i=0;i<t;i++)a.push(n[o+i]);for(var s=0;s<t;s++)n[o+s]=a.pop()}}var pu={ENDIANNESS:fu,getEndianness:uu,swapBytes:du},mu={};function gu(e,t){mu[e]=t}var vu=nn.vtkErrorMacro,hu=nn.vtkDebugMacro,yu=0;function bu(e){var t=document.querySelector('.webResource[data-url="'.concat(e,'"]'));return t?t.innerHTML:null}function xu(e){return document.querySelector('.webResource[data-url="'.concat(e,'"]'))}function Tu(e){return"/"===e[0]?e.substr(1):e}function Su(e,t){return new Promise((function(e,n){var r=bu(t);null===r?n(new Error("No such text ".concat(t))):e(r)}))}function Ou(e,t){return new Promise((function(e,n){var r=bu(Tu(t));null===r?n(new Error("No such JSON ".concat(t))):e(JSON.parse(r))}))}function wu(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(a,o){var i=Tu([t,n.ref.basepath,r.compression?"".concat(n.ref.id,".gz"):n.ref.id].join("/")),s=bu(i);if(null===s)o(new Error("No such array ".concat(i)));else{if("string"===n.dataType){var l=atob(s);r.compression&&(l=Yc(Wc(l))),n.values=JSON.parse(l)}else{var c=new Uint8Array(cu.toArrayBuffer(s));n.buffer=new ArrayBuffer(c.length);var u=new Uint8Array(n.buffer);u.set(c),r.compression&&("string"===n.dataType||"JSON"===n.dataType?n.buffer=Yc(Wc(new Uint8Array(n.buffer))):n.buffer=Wc(new Uint8Array(n.buffer)).buffer),"JSON"===n.ref.encode?n.values=JSON.parse(n.buffer):(pu.ENDIANNESS!==n.ref.encode&&pu.ENDIANNESS&&(hu("Swap bytes of ".concat(n.name)),pu.swapBytes(n.buffer,Dn[n.dataType])),n.values=nn.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&vu("Error in FetchArray: ".concat(n.name," does not have the proper array size. Got ").concat(n.values.length,", instead of ").concat(n.size))}delete n.ref,0===--yu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!1),null!==e&&void 0!==e&&e.modified&&e.modified(),a(n)}}))}function Au(e,t){return new Promise((function(e,n){var r=xu(t);r?e(r):n(new Error("No such image ".concat(t)))}))}var Pu={fetchJSON:Ou,fetchText:Su,fetchArray:wu,fetchImage:Au};gu("html",(function(e){return Pu}));var Iu=nn.vtkErrorMacro,Cu=nn.vtkDebugMacro,Eu=0;function Mu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new XMLHttpRequest;return r.open(e,t,!0),n.headers&&Object.entries(n.headers).forEach((function(e){var t=ge(e,2),n=t[0],a=t[1];return r.setRequestHeader(n,a)})),n.progressCallback&&r.addEventListener("progress",n.progressCallback),r}function Ru(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&t.compression&&"gz"!==t.compression&&(Iu("Supported algorithms are: [gz]"),Iu("Unkown compression algorithm: ".concat(t.compression))),new Promise((function(n,r){var a=Mu("GET",e,t);a.onreadystatechange=function(e){4===a.readyState&&(200===a.status||0===a.status?t.compression?n(Wc(new Uint8Array(a.response)).buffer):n(a.response):r({xhr:a,e:e}))},a.responseType="arraybuffer",a.send()}))}function Du(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n.ref&&!n.ref.pending?new Promise((function(a,o){var i=null;i=n.ref.url?n.ref.url:[t,n.ref.basepath,r.compression?"".concat(n.ref.id,".gz"):n.ref.id].join("/");var s=Mu("GET",i,r);s.onreadystatechange=function(t){1===s.readyState&&(n.ref.pending=!0,1===++Eu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!0)),4===s.readyState&&(n.ref.pending=!1,200===s.status||0===s.status?(n.buffer=s.response,r.compression&&("string"===n.dataType||"JSON"===n.dataType?n.buffer=Yc(Wc(new Uint8Array(n.buffer))):n.buffer=Wc(new Uint8Array(n.buffer)).buffer),"JSON"===n.ref.encode?n.values=JSON.parse(n.buffer):(pu.ENDIANNESS!==n.ref.encode&&pu.ENDIANNESS&&(Cu("Swap bytes of ".concat(n.name)),pu.swapBytes(n.buffer,Dn[n.dataType])),n.values=nn.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&Iu("Error in FetchArray: ".concat(n.name,", does not have the proper array size. Got ").concat(n.values.length,", instead of ").concat(n.size)),delete n.ref,0===--Eu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!1),null!==e&&void 0!==e&&e.modified&&e.modified(),a(n)):o({xhr:s,e:t}))},s.responseType=r.compression||"string"!==n.dataType?"arraybuffer":"text",s.send()})):Promise.resolve(n)}function ku(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(r,a){var o=Mu("GET",t,n);o.onreadystatechange=function(t){1===o.readyState&&1===++Eu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!0),4===o.readyState&&(0===--Eu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!1),200===o.status||0===o.status?n.compression?r(JSON.parse(Yc(Wc(new Uint8Array(o.response))))):r(JSON.parse(o.responseText)):a({xhr:o,e:t}))},o.responseType=n.compression?"arraybuffer":"text",o.send()}))}function Lu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n&&n.compression&&"gz"!==n.compression&&(Iu("Supported algorithms are: [gz]"),Iu("Unkown compression algorithm: ".concat(n.compression))),new Promise((function(r,a){var o=Mu("GET",t,n);o.onreadystatechange=function(t){1===o.readyState&&1===++Eu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!0),4===o.readyState&&(0===--Eu&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!1),200===o.status||0===o.status?n.compression?r(Yc(Wc(new Uint8Array(o.response)))):r(o.responseText):a({xhr:o,e:t}))},o.responseType=n.compression?"arraybuffer":"text",o.send()}))}function Bu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(e,r){var a=new Image;n.crossOrigin&&(a.crossOrigin=n.crossOrigin),a.onload=function(){return e(a)},a.onerror=r,a.src=t}))}var Vu={fetchArray:Du,fetchJSON:ku,fetchText:Lu,fetchBinary:Ru,fetchImage:Bu};gu("http",(function(e){return Vu}));var Fu=nn.vtkErrorMacro,Nu=nn.vtkDebugMacro;function Uu(e){var t=e.split(".").pop().toLowerCase();return"jpg"===t?"jpeg":t}function _u(e,t,n){return function(r){e.buffer=new ArrayBuffer(r.length);var a=new Uint8Array(e.buffer);a.set(r),t&&("string"===e.dataType||"JSON"===e.dataType?e.buffer=Yc(Wc(new Uint8Array(e.buffer))):e.buffer=Wc(new Uint8Array(e.buffer)).buffer),"JSON"===e.ref.encode?e.values=JSON.parse(e.buffer):(pu.ENDIANNESS!==e.ref.encode&&pu.ENDIANNESS&&(Nu("Swap bytes of ".concat(e.name)),pu.swapBytes(e.buffer,Dn[e.dataType])),e.values=nn.newTypedArray(e.dataType,e.buffer)),e.values.length!==e.size&&Fu("Error in FetchArray: ".concat(e.name," does not have the proper array size. Got ").concat(e.values.length,", instead of ").concat(e.size)),n()}}function Gu(e,t,n){return function(r){e.values=t?JSON.parse(Yc(Wc(r))):JSON.parse(r),n()}}function zu(e){return"/"===e[0]?e.substr(1):e}function ju(e){return new URL(e,"http://any").pathname}function Wu(e){return zu(ju(e))}function Ku(e){return new Promise((function(t,n){"string"===typeof e?t(qc(e)):e instanceof Blob?t(e.arrayBuffer().then((function(e){return new Uint8Array(e)}))):e instanceof ArrayBuffer?t(new Uint8Array(e)):(null===e||void 0===e?void 0:e.buffer)instanceof ArrayBuffer?t(new Uint8Array(e.buffer)):n(new Error("Invalid datatype to unpack."))}))}function Hu(e){var t=!1,n=0,r=null,a="";return Ku(e.zipContent).then((function(n){r=Qc(n),t=!0;var o=[];Object.keys(r).forEach((function(e){e.endsWith("index.json")&&o.push(e)})),o.sort((function(e,t){return e.length-t.length})),a=o[0].replace(/index\.json$/,""),e.callback&&e.callback(r)})),{fetchArray:function(e,o,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(l,c){t||Fu("ERROR!!! zip not ready...");var u=Wu([o,i.ref.basepath,s.compression?"".concat(i.ref.id,".gz"):i.ref.id].join("/"));function f(){delete i.ref,0===--n&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!1),null!==e&&void 0!==e&&e.modified&&e.modified(),l(i)}1===++n&&null!==e&&void 0!==e&&e.invokeBusy&&e.invokeBusy(!0);var d=r["".concat(a).concat(u)];if("string"!==i.dataType||s.compression){var p=_u(i,s.compression,f);p(d)}else{var m=Gu(i,s.compression,f);m(Yc(d))}}))},fetchJSON:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Wu(n);t||Fu("ERROR!!! zip not ready...");var s=r["".concat(a).concat(i)];if(o.compression){if("gz"===o.compression){var l=Yc(Wc(s));return Promise.resolve(JSON.parse(l))}return Promise.reject(new Error("Invalid compression"))}return Promise.resolve(JSON.parse(Yc(s)))},fetchText:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Wu(n);t||Fu("ERROR!!! zip not ready...");var s=r["".concat(a).concat(i)];return o.compression?"gz"===o.compression?Promise.resolve(Yc(Qc(s))):Promise.reject(new Error("Invalid compression")):Promise.resolve(Yc(s))},fetchImage:function(e,n){var o=Wu(n);t||Fu("ERROR!!! zip not ready...");var i=r["".concat(a).concat(o)];return new Promise((function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t;var r=lu(i.buffer);n.src="data:image/".concat(Uu(o),";base64,").concat(r)}))},fetchBinary:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Wu(n);t||Fu("ERROR!!! zip not ready...");var s=r["".concat(a).concat(i)];return o.compression?"gz"===o.compression?Promise.resolve(Wc(s).buffer):Promise.reject(new Error("Invalid compression")):Promise.resolve(s.buffer)}}}var Xu={create:Hu};gu("zip",(function(e){return Xu.create(e)}));n(4211);function qu(e,t){t.classHierarchy.push("vtkAbstractMapper"),e.update=function(){e.getInputData()},e.addClippingPlane=function(n){return!!n.isA("vtkPlane")&&(!t.clippingPlanes.includes(n)&&(t.clippingPlanes.push(n),e.modified(),!0))},e.getNumberOfClippingPlanes=function(){return t.clippingPlanes.length},e.removeAllClippingPlanes=function(){return 0!==t.clippingPlanes.length&&(t.clippingPlanes.length=0,e.modified(),!0)},e.removeClippingPlane=function(n){var r=t.clippingPlanes.indexOf(n);return-1!==r&&(t.clippingPlanes.splice(r,1),e.modified(),!0)},e.getClippingPlanes=function(){return t.clippingPlanes},e.setClippingPlanes=function(t){if(t)if(Array.isArray(t))for(var n=t.length,r=0;r<n&&r<6;r++)e.addClippingPlane(t[r]);else e.addClippingPlane(t)},e.getClippingPlaneInDataCoords=function(e,n,r){var a=t.clippingPlanes,o=e;if(a){var i=a.length;if(n>=0&&n<i){var s=a[n],l=s.getNormal(),c=s.getOrigin(),u=l[0],f=l[1],d=l[2],p=-(u*c[0]+f*c[1]+d*c[2]);return r[0]=u*o[0]+f*o[4]+d*o[8]+p*o[12],r[1]=u*o[1]+f*o[5]+d*o[9]+p*o[13],r[2]=u*o[2]+f*o[6]+d*o[10]+p*o[14],void(r[3]=u*o[3]+f*o[7]+d*o[11]+p*o[15])}}nn.vtkErrorMacro("Clipping plane index ".concat(n," is out of range."))}}var Yu={clippingPlanes:[]};function Zu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Yu,n),nn.obj(e,t),nn.algo(e,t,1,0),t.clippingPlanes||(t.clippingPlanes=[]),qu(e,t)}var $u={extend:Zu};function Ju(e,t){t.classHierarchy.push("vtkAbstractImageMapper"),e.getIsOpaque=function(){return!0},e.getCurrentImage=function(){return null}}var Qu={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1};function ef(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Qu,n),$u.extend(e,t,n),nn.setGet(e,t,["slice","useCustomExtents"]),nn.setGetArray(e,t,["customDisplayExtent"],6),Ju(e,t)}var tf={extend:ef};function nf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nf(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var af=1e-6,of="coincide",sf="disjoint";function lf(e,t,n){return e[0]*(n[0]-t[0])+e[1]*(n[1]-t[1])+e[2]*(n[2]-t[2])}function cf(e,t,n){var r=n[0]*(e[0]-t[0])+n[1]*(e[1]-t[1])+n[2]*(e[2]-t[2]);return Math.abs(r)}function uf(e,t,n,r){var a=[];Wn(e,t,a);var o=Kn(n,a);r[0]=e[0]-o*n[0],r[1]=e[1]-o*n[1],r[2]=e[2]-o*n[2]}function ff(e,t,n){var r=Kn(e,t),a=Kn(t,t);return 0===a&&(a=1),n[0]=e[0]-r*t[0]/a,n[1]=e[1]-r*t[1]/a,n[2]=e[2]-r*t[2]/a,n}function df(e,t,n,r){var a=[];Wn(e,t,a);var o=Kn(n,a),i=Kn(n,n);0!==i?(r[0]=e[0]-o*n[0]/i,r[1]=e[1]-o*n[1]/i,r[2]=e[2]-o*n[2]/i):(r[0]=e[0],r[1]=e[1],r[2]=e[2])}function pf(e,t,n,r){var a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},o=[],i=[];Wn(t,e,o),Wn(n,e,i);var s,l,c=Kn(r,i),u=Kn(r,o);return s=u<0?-u:u,l=c<0?-c*af:c*af,s<=l||(a.t=c/u,a.x[0]=e[0]+a.t*o[0],a.x[1]=e[1]+a.t*o[1],a.x[2]=e[2]+a.t*o[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function mf(e,t,n,r){var a={intersection:!1,l0:[],l1:[],error:null},o=[];Hn(t,r,o);var i,s=o.map((function(e){return Math.abs(e)}));if(s[0]+s[1]+s[2]<af){var l=[];return Wn(e,n,l),0===Kn(t,l)?a.error=of:a.error=sf,a}i=s[0]>s[1]&&s[0]>s[2]?"x":s[1]>s[2]?"y":"z";var c=[],u=-Kn(t,e),f=-Kn(r,n);switch(i){case"x":c[0]=0,c[1]=(f*t[2]-u*r[2])/o[0],c[2]=(u*r[1]-f*t[1])/o[0];break;case"y":c[0]=(u*r[2]-f*t[2])/o[1],c[1]=0,c[2]=(f*t[0]-u*r[0])/o[1];break;case"z":c[0]=(f*t[1]-u*r[1])/o[2],c[1]=(u*r[0]-f*t[0])/o[2],c[2]=0;break}return a.l0=c,jn(c,o,a.l1),a.intersection=!0,a}var gf={evaluate:lf,distanceToPlane:cf,projectPoint:uf,projectVector:ff,generalizedProjectPoint:df,intersectWithLine:pf,intersectWithPlane:mf,DISJOINT:sf,COINCIDE:of};function vf(e,t){t.classHierarchy.push("vtkPlane"),e.distanceToPlane=function(e){return cf(e,t.origin,t.normal)},e.projectPoint=function(e,n){uf(e,t.origin,t.normal,n)},e.projectVector=function(e,n){return ff(e,t.normal,n)},e.push=function(e){if(0!==e)for(var n=0;n<3;n++)t.origin[n]+=e*t.normal[n]},e.generalizedProjectPoint=function(e,n){df(e,t.origin,t.normal,n)},e.evaluateFunction=function(e,n,r){return Array.isArray(e)?t.normal[0]*(e[0]-t.origin[0])+t.normal[1]*(e[1]-t.origin[1])+t.normal[2]*(e[2]-t.origin[2]):t.normal[0]*(e-t.origin[0])+t.normal[1]*(n-t.origin[1])+t.normal[2]*(r-t.origin[2])},e.evaluateGradient=function(e){var n=[t.normal[0],t.normal[1],t.normal[2]];return n},e.intersectWithLine=function(e,n){return pf(e,n,t.origin,t.normal)},e.intersectWithPlane=function(e,n){return mf(e,n,t.origin,t.normal)}}var hf={normal:[0,0,1],origin:[0,0,0]};function yf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,hf,n),nn.obj(e,t),nn.setGetArray(e,t,["normal","origin"],3),vf(e,t)}var bf=nn.newInstance(yf,"vtkPlane"),xf=rf({newInstance:bf,extend:yf},gf);function Tf(e,t,n){var r=n.getCurrentImage(),a=r.getExtent(),o=[a[0],a[2],a[4]],i=n.getClosestIJKAxis(),s=i.ijkMode,l=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();s!==n.getSlicingMode()&&(l=n.getSliceAtPosition(l)),o[s]+=l;var c=[0,0,0];r.indexToWorld(o,c),o[s]+=1;var u=[0,0,0];r.indexToWorld(o,u),u[0]-=c[0],u[1]-=c[1],u[2]-=c[2],Pr(u,u);var f=xf.intersectWithLine(e,t,c,u);if(f.intersection){var d=f.x,p=[0,0,0];return r.worldToIndex(d,p),{t:f.t,absoluteIJK:p}}return null}function Sf(e,t,n){var r=Tf(e,t,n);if(r){var a=n.getCurrentImage(),o=a.getExtent(),i=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return i[0]<o[0]||i[0]>o[1]||i[1]<o[2]||i[1]>o[3]||i[2]<o[4]||i[2]>o[5]?null:{t:r.t,ijk:i}}return null}function Of(e,t,n){var r=Tf(e,t,n);if(r){var a=n.getCurrentImage(),o=a.getExtent(),i=r.absoluteIJK,s=[Math.floor(i[0]),Math.floor(i[1]),Math.floor(i[2])];if(s[0]<o[0]||s[0]>o[1]-1||s[1]<o[2]||s[1]>o[3]-1||s[2]<o[4]||s[2]>(o[5]?o[5]-1:o[5]))return null;var l=[i[0]-s[0],i[1]-s[1],i[2]-s[2]];return{t:r.t,ijk:s,pCoords:l}}return null}var wf=1,Af=0,Pf=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function If(){return wf}function Cf(e){wf=e}function Ef(){return Af}function Mf(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Af=e}function Rf(){Mf(0)}function Df(){Mf(0)}function kf(){Mf(1)}function Lf(){return Pf[Af]}var Bf={getResolveCoincidentTopologyAsString:Lf,getResolveCoincidentTopologyPolygonOffsetFaces:If,getResolveCoincidentTopology:Ef,setResolveCoincidentTopology:Mf,setResolveCoincidentTopologyPolygonOffsetFaces:Cf,setResolveCoincidentTopologyToDefault:Rf,setResolveCoincidentTopologyToOff:Df,setResolveCoincidentTopologyToPolygonOffset:kf};function Vf(e,t,n){n.forEach((function(n){e["get".concat(n.method)]=function(){return t[n.key]},e["set".concat(n.method)]=function(e,r){t[n.key]={factor:e,offset:r}}}))}var Ff=["Polygon","Line","Point"],Nf={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},Uf={};function _f(e,t){void 0===t.resolveCoincidentTopology&&(t.resolveCoincidentTopology=!1),nn.setGet(e,t,["resolveCoincidentTopology"]),t.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(Bf).forEach((function(t){e[t]=Bf[t]})),Object.keys(Uf).forEach((function(t){e[t]=Uf[t]})),Vf(e,t.topologyOffset,Ff.map((function(e){return{key:e,method:"RelativeCoincidentTopology".concat(e,"OffsetParameters")}}))),e.getCoincidentTopologyPolygonOffsetParameters=function(){var t=Uf.getResolveCoincidentTopologyPolygonOffsetParameters(),n=e.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:t.factor+n.factor,offset:t.offset+n.offset}},e.getCoincidentTopologyLineOffsetParameters=function(){var t=Uf.getResolveCoincidentTopologyLineOffsetParameters(),n=e.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:t.factor+n.factor,offset:t.offset+n.offset}},e.getCoincidentTopologyPointOffsetParameter=function(){var t=Uf.getResolveCoincidentTopologyPointOffsetParameters(),n=e.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:t.factor+n.factor,offset:t.offset+n.offset}}}Vf(Uf,Nf,Ff.map((function(e){return{key:e,method:"ResolveCoincidentTopology".concat(e,"OffsetParameters")}})));var Gf={implementCoincidentTopologyMethods:_f,staticOffsetAPI:Uf,otherStaticMethods:Bf,CATEGORIES:Ff};function zf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zf(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Wf=Gf.staticOffsetAPI,Kf=Gf.otherStaticMethods,Hf=nn.vtkWarningMacro,Xf=Rn.SlicingMode;function qf(e,t){function n(){var n;switch(t.slicingMode){case Xf.X:n=[1,0,0];break;case Xf.Y:n=[0,1,0];break;case Xf.Z:n=[0,0,1];break;default:return void(t.closestIJKAxis={ijkMode:t.slicingMode,flip:!1})}var r=[0,0,0],a=e.getCurrentImage().getDirection();Yn(a,n,r);for(var o=0,i=-1,s=!1,l=0;l<r.length;++l){var c=Math.abs(r[l]);c>o&&(o=c,s=r[l]<0,i=l)}if(1!==o){var u="IJKXYZ"[t.slicingMode],f="IJKXYZ"[i];Hf("Unaccurate slicing along ".concat(u," axis which ")+"is not aligned with any IJK axis of the image data. "+"Using ".concat(f," axis  as a fallback (").concat(o,"% aligned). ")+"Necessitates slice reformat that is not yet implemented.  You can switch the slicing mode on your mapper to do IJK slicing instead.")}t.closestIJKAxis={ijkMode:i,flip:s}}t.classHierarchy.push("vtkImageMapper"),e.getSliceAtPosition=function(n){var r,a=e.getCurrentImage();if(3===n.length)r=n;else if(Number.isFinite(n)){var o=a.getBounds();switch(t.slicingMode){case Xf.X:r=[n,(o[3]+o[2])/2,(o[5]+o[4])/2];break;case Xf.Y:r=[(o[1]+o[0])/2,n,(o[5]+o[4])/2];break;case Xf.Z:r=[(o[1]+o[0])/2,(o[3]+o[2])/2,n];break}}var i=[0,0,0];a.worldToIndex(r,i);var s=a.getExtent(),l=e.getClosestIJKAxis(),c=l.ijkMode,u=0;switch(c){case Xf.I:u=Qn(i[0],s[0],s[1]);break;case Xf.J:u=Qn(i[1],s[2],s[3]);break;case Xf.K:u=Qn(i[2],s[4],s[5]);break;default:return 0}return u},e.setSliceFromCamera=function(n){var r=n.getFocalPoint();switch(t.slicingMode){case Xf.I:case Xf.J:case Xf.K:var a=e.getSliceAtPosition(r);e.setSlice(a);break;case Xf.X:e.setSlice(r[0]);break;case Xf.Y:e.setSlice(r[1]);break;case Xf.Z:e.setSlice(r[2]);break}},e.setXSlice=function(t){e.setSlicingMode(Xf.X),e.setSlice(t)},e.setYSlice=function(t){e.setSlicingMode(Xf.Y),e.setSlice(t)},e.setZSlice=function(t){e.setSlicingMode(Xf.Z),e.setSlice(t)},e.setISlice=function(t){e.setSlicingMode(Xf.I),e.setSlice(t)},e.setJSlice=function(t){e.setSlicingMode(Xf.J),e.setSlice(t)},e.setKSlice=function(t){e.setSlicingMode(Xf.K),e.setSlice(t)},e.getSlicingModeNormal=function(){var n=[0,0,0],r=e.getCurrentImage().getDirection(),a=[[r[0],r[1],r[2]],[r[3],r[4],r[5]],[r[6],r[7],r[8]]];switch(t.slicingMode){case Xf.X:n[0]=1;break;case Xf.Y:n[1]=1;break;case Xf.Z:n[2]=1;break;case Xf.I:Yn(a,[1,0,0],n);break;case Xf.J:Yn(a,[0,1,0],n);break;case Xf.K:Yn(a,[0,0,1],n);break}return n},e.setSlicingMode=function(r){t.slicingMode!==r&&(t.slicingMode=r,e.getCurrentImage()&&n(),e.modified())},e.getClosestIJKAxis=function(){return void 0!==t.closestIJKAxis&&t.closestIJKAxis.ijkMode!==Xf.NONE||!e.getCurrentImage()||n(),t.closestIJKAxis},e.getBounds=function(){var n=e.getCurrentImage();if(!n)return er();if(!t.useCustomExtents)return n.getBounds();var r=t.customDisplayExtent.slice(),a=e.getClosestIJKAxis(),o=a.ijkMode,i=t.slice;switch(o!==t.slicingMode&&(i=e.getSliceAtPosition(t.slice)),o){case Xf.I:r[0]=i,r[1]=i;break;case Xf.J:r[2]=i,r[3]=i;break;case Xf.K:r[4]=i,r[5]=i;break}return n.extentToBounds(r)},e.getBoundsForSlice=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.slice,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=e.getCurrentImage();if(!a)return er();var o=a.getSpatialExtent(),i=e.getClosestIJKAxis(),s=i.ijkMode,l=n;switch(s!==t.slicingMode&&(l=e.getSliceAtPosition(n)),s){case Xf.I:o[0]=l-r,o[1]=l+r;break;case Xf.J:o[2]=l-r,o[3]=l+r;break;case Xf.K:o[4]=l-r,o[5]=l+r;break}return a.extentToBounds(o)},e.intersectWithLineForPointPicking=function(t,n){return Sf(t,n,e)},e.intersectWithLineForCellPicking=function(t,n){return Of(t,n,e)},e.getCurrentImage=function(){return e.getInputData()}}var Yf={slicingMode:Xf.NONE,closestIJKAxis:{ijkMode:Xf.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1};function Zf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Yf,n),tf.extend(e,t,n),nn.get(e,t,["slicingMode"]),nn.setGet(e,t,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint"]),Gf.implementCoincidentTopologyMethods(e,t),qf(e,t)}var $f=nn.newInstance(Zf,"vtkImageMapper");jf(jf(jf({newInstance:$f,extend:Zf},Wf),Kf),Rn);function Jf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jf(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ed=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function td(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function nd(e){return e[0]<=e[1]&&e[2]<=e[3]&&e[4]<=e[5]}function rd(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function ad(e){return rd(e,ed)}function od(e,t,n,r){var a=ge(e,6),o=a[0],i=a[1],s=a[2],l=a[3],c=a[4],u=a[5];return e[0]=o<t?o:t,e[1]=i>t?i:t,e[2]=s<n?s:n,e[3]=l>n?l:n,e[4]=c<r?c:r,e[5]=u>r?u:r,e}function id(e,t){if(0===t.length)return e;if(Array.isArray(t[0]))for(var n=0;n<t.length;++n)od.apply(void 0,[e].concat(Te(t[n])));else for(var r=0;r<t.length;r+=3)od.apply(void 0,[e].concat(Te(t.slice(r,r+3))));return e}function sd(e,t,n,r,a,o,i){var s=ge(e,6),l=s[0],c=s[1],u=s[2],f=s[3],d=s[4],p=s[5];return void 0===i?(e[0]=Math.min(t[0],l),e[1]=Math.max(t[1],c),e[2]=Math.min(t[2],u),e[3]=Math.max(t[3],f),e[4]=Math.min(t[4],d),e[5]=Math.max(t[5],p)):(e[0]=Math.min(t,l),e[1]=Math.max(n,c),e[2]=Math.min(r,u),e[3]=Math.max(a,f),e[4]=Math.min(o,d),e[5]=Math.max(i,p)),e}function ld(e,t,n,r){var a=ge(e,6),o=a[0],i=a[1],s=a[2],l=a[3],c=a[4],u=a[5];return e[0]=t,e[1]=t>i?t:i,e[2]=n,e[3]=n>l?n:l,e[4]=r,e[5]=r>u?r:u,o!==t||s!==n||c!==r}function cd(e,t,n,r){var a=ge(e,6),o=a[0],i=a[1],s=a[2],l=a[3],c=a[4],u=a[5];return e[0]=t<o?t:o,e[1]=t,e[2]=n<s?n:s,e[3]=n,e[4]=r<c?r:c,e[5]=r,i!==t||l!==n||u!==r}function ud(e,t){return e[0]-=t,e[1]+=t,e[2]-=t,e[3]+=t,e[4]-=t,e[5]+=t,e}function fd(e,t,n,r){return!!nd(e)&&(t>=0?(e[0]*=t,e[1]*=t):(e[0]=t*e[1],e[1]=t*e[0]),n>=0?(e[2]*=n,e[3]*=n):(e[2]=n*e[3],e[3]=n*e[2]),r>=0?(e[4]*=r,e[5]*=r):(e[4]=r*e[5],e[5]=r*e[4]),!0)}function dd(e){return[.5*(e[0]+e[1]),.5*(e[2]+e[3]),.5*(e[4]+e[5])]}function pd(e,t,n,r){if(!nd(e))return!1;var a=dd(e);return e[0]-=a[0],e[1]-=a[0],e[2]-=a[1],e[3]-=a[1],e[4]-=a[2],e[5]-=a[2],fd(e,t,n,r),e[0]+=a[0],e[1]+=a[0],e[2]+=a[1],e[3]+=a[1],e[4]+=a[2],e[5]+=a[2],!0}function md(e,t){return e[2*t+1]-e[2*t]}function gd(e){return[md(e,0),md(e,1),md(e,2)]}function vd(e){return e.slice(0,2)}function hd(e){return e.slice(2,4)}function yd(e){return e.slice(4,6)}function bd(e){var t=gd(e);return t[0]>t[1]?t[0]>t[2]?t[0]:t[2]:t[1]>t[2]?t[1]:t[2]}function xd(e){if(nd(e)){var t=gd(e);return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}return null}function Td(e){return[e[0],e[2],e[4]]}function Sd(e){return[e[1],e[3],e[5]]}function Od(e,t){return e<=0&&t>=0||e>=0&&t<=0}function wd(e,t){for(var n=0,r=0;r<2;r++)for(var a=2;a<4;a++)for(var o=4;o<6;o++)t[n]=[e[r],e[a],e[o]],n++;return t}function Ad(e,t,n){return t[0]=e[0],t[1]=e[2],t[2]=e[4],n[0]=e[1],n[1]=e[3],n[2]=e[5],t}function Pd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];n.length<6&&ad(n);for(var r=wd(e,[]),a=0;a<r.length;++a)Er(r[a],r[a],t);return id(n,r)}function Id(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[0]=.5*(e[1]-e[0]),t[1]=.5*(e[3]-e[2]),t[2]=.5*(e[5]-e[4]),t}function Cd(e,t,n,r){for(var a=[].concat(ed),o=e.getData(),i=0;i<o.length;i+=3){var s=[o[i],o[i+1],o[i+2]],l=Kn(s,t);a[0]=Math.min(l,a[0]),a[1]=Math.max(l,a[1]);var c=Kn(s,n);a[2]=Math.min(c,a[2]),a[3]=Math.max(c,a[3]);var u=Kn(s,r);a[4]=Math.min(u,a[4]),a[5]=Math.max(u,a[5])}return a}function Ed(e,t,n,r,a){for(var o=!0,i=[],s=0,l=[],c=[0,0,0],u=0,f=1,d=2,p=0;p<3;p++)t[p]<e[2*p]?(i[p]=f,c[p]=e[2*p],o=!1):t[p]>e[2*p+1]?(i[p]=u,c[p]=e[2*p+1],o=!1):i[p]=d;if(o)return r[0]=t[0],r[1]=t[1],r[2]=t[2],a[0]=0,1;for(var m=0;m<3;m++)i[m]!==d&&0!==n[m]?l[m]=(c[m]-t[m])/n[m]:l[m]=-1;for(var g=0;g<3;g++)l[s]<l[g]&&(s=g);if(l[s]>1||l[s]<0)return 0;a[0]=l[s];for(var v=0;v<3;v++)if(s!==v){if(r[v]=t[v]+l[s]*n[v],r[v]<e[2*v]||r[v]>e[2*v+1])return 0}else r[v]=c[v];return 1}function Md(e,t,n){for(var r=[],a=0,o=1,i=1,s=4;s<=5;++s){r[2]=e[s];for(var l=2;l<=3;++l){r[1]=e[l];for(var c=0;c<=1;++c)if(r[0]=e[c],a=xf.evaluate(n,t,r),i&&(o=a>=0?1:-1,i=0),0===a||o>0&&a<0||o<0&&a>0)return 1}}return 0}function Rd(e,t){if(!nd(e)||!nd(t))return!1;for(var n,r=[0,0,0,0,0,0],a=0;a<3;a++)if(n=!1,t[2*a]>=e[2*a]&&t[2*a]<=e[2*a+1]?(n=!0,r[2*a]=t[2*a]):e[2*a]>=t[2*a]&&e[2*a]<=t[2*a+1]&&(n=!0,r[2*a]=e[2*a]),t[2*a+1]>=e[2*a]&&t[2*a+1]<=e[2*a+1]?(n=!0,r[2*a+1]=t[2*a+1]):e[2*a+1]>=t[2*a]&&e[2*a+1]<=t[2*a+1]&&(n=!0,r[2*a+1]=e[2*a+1]),!n)return!1;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],!0}function Dd(e,t){if(!nd(e)||!nd(t))return!1;for(var n=0;n<3;n++)if(!(t[2*n]>=e[2*n]&&t[2*n]<=e[2*n+1])&&!(e[2*n]>=t[2*n]&&e[2*n]<=t[2*n+1])&&!(t[2*n+1]>=e[2*n]&&t[2*n+1]<=e[2*n+1])&&!(e[2*n+1]>=t[2*n]&&e[2*n+1]<=t[2*n+1]))return!1;return!0}function kd(e,t,n,r){return!(t<e[0]||t>e[1])&&(!(n<e[2]||n>e[3])&&!(r<e[4]||r>e[5]))}function Ld(e,t){return!!Dd(e,t)&&(!!kd.apply(void 0,[e].concat(Te(Td(t))))&&!!kd.apply(void 0,[e].concat(Te(Sd(t)))))}function Bd(e,t,n){for(var r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0],o=0,i=0;i<2;i++)for(var s=2;s<4;s++)for(var l=4;l<6;l++){var c=[e[i],e[s],e[l]];a[o++]=xf.evaluate(n,t,c)}var u=2;while(u--)if(Od(a[r[u][0]],a[r[u][4]])&&Od(a[r[u][1]],a[r[u][5]])&&Od(a[r[u][2]],a[r[u][6]])&&Od(a[r[u][3]],a[r[u][7]]))break;if(u<0)return!1;for(var f=Math.sign(n[u]),d=Math.abs((e[2*u+1]-e[2*u])*n[u]),p=f>0?1:0,m=0;m<4;m++)if(0!==d){var g=Math.abs(a[r[u][m]])/d;f>0&&g<p&&(p=g),f<0&&g>p&&(p=g)}var v=(1-p)*e[2*u]+p*e[2*u+1];return f>0?e[2*u]=v:e[2*u+1]=v,!0}var Vd=function(){function e(t){Be(this,e),this.bounds=t,this.bounds||(this.bounds=new Float64Array(ed))}return Fe(e,[{key:"getBounds",value:function(){return this.bounds}},{key:"equals",value:function(e){return td(this.bounds,e)}},{key:"isValid",value:function(){return nd(this.bounds)}},{key:"setBounds",value:function(e){return rd(this.bounds,e)}},{key:"reset",value:function(){return ad(this.bounds)}},{key:"addPoint",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return od.apply(void 0,[this.bounds].concat(t))}},{key:"addPoints",value:function(e){return id(this.bounds,e)}},{key:"addBounds",value:function(e,t,n,r,a,o){return sd(this.bounds,e,t,n,r,a,o)}},{key:"setMinPoint",value:function(e,t,n){return ld(this.bounds,e,t,n)}},{key:"setMaxPoint",value:function(e,t,n){return cd(this.bounds,e,t,n)}},{key:"inflate",value:function(e){return ud(this.bounds,e)}},{key:"scale",value:function(e,t,n){return fd(this.bounds,e,t,n)}},{key:"getCenter",value:function(){return dd(this.bounds)}},{key:"getLength",value:function(e){return md(this.bounds,e)}},{key:"getLengths",value:function(){return gd(this.bounds)}},{key:"getMaxLength",value:function(){return bd(this.bounds)}},{key:"getDiagonalLength",value:function(){return xd(this.bounds)}},{key:"getMinPoint",value:function(){return Td(this.bounds)}},{key:"getMaxPoint",value:function(){return Sd(this.bounds)}},{key:"getXRange",value:function(){return vd(this.bounds)}},{key:"getYRange",value:function(){return hd(this.bounds)}},{key:"getZRange",value:function(){return yd(this.bounds)}},{key:"getCorners",value:function(e){return wd(this.bounds,e)}},{key:"computeCornerPoints",value:function(e,t){return Ad(this.bounds,e,t)}},{key:"computeLocalBounds",value:function(e,t,n){return Cd(this.bounds,e,t,n)}},{key:"transformBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Pd(this.bounds,e,t)}},{key:"computeScale3",value:function(e){return Id(this.bounds,e)}},{key:"cutWithPlane",value:function(e,t){return Bd(this.bounds,e,t)}},{key:"intersectBox",value:function(e,t,n,r){return Ed(this.bounds,e,t,n,r)}},{key:"intersectPlane",value:function(e,t){return Md(this.bounds,e,t)}},{key:"intersect",value:function(e){return Rd(this.bounds,e)}},{key:"intersects",value:function(e){return Dd(this.bounds,e)}},{key:"containsPoint",value:function(e,t,n){return kd(this.bounds,e,t,n)}},{key:"contains",value:function(e){return Dd(this.bounds,e)}}]),e}();function Fd(e){var t=e&&e.bounds;return new Vd(t)}var Nd={equals:td,isValid:nd,setBounds:rd,reset:ad,addPoint:od,addPoints:id,addBounds:sd,setMinPoint:ld,setMaxPoint:cd,inflate:ud,scale:fd,scaleAboutCenter:pd,getCenter:dd,getLength:md,getLengths:gd,getMaxLength:bd,getDiagonalLength:xd,getMinPoint:Td,getMaxPoint:Sd,getXRange:vd,getYRange:hd,getZRange:yd,getCorners:wd,computeCornerPoints:Ad,computeLocalBounds:Cd,transformBounds:Pd,computeScale3:Id,cutWithPlane:Bd,intersectBox:Ed,intersectPlane:Md,intersect:Rd,intersects:Dd,containsPoint:kd,contains:Ld,INIT_BOUNDS:ed},Ud=Qf({newInstance:Fd},Nd),_d={DISPLAY:0,WORLD:1},Gd={CoordinateSystem:_d};function zd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zd(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Wd=Gd.CoordinateSystem;function Kd(e){return function(){return nn.vtkErrorMacro("vtkProp::".concat(e," - NOT IMPLEMENTED"))}}function Hd(e,t){t.classHierarchy.push("vtkProp"),e.getMTime=function(){for(var e=t.mtime,n=0;n<t.textures.length;++n){var r=t.textures[n].getMTime();r>e&&(e=r)}return e},e.processSelectorPixelBuffers=function(e,t){},e.getNestedProps=function(){return null},e.getActors=function(){return[]},e.getActors2D=function(){return[]},e.getVolumes=function(){return[]},e.pick=Kd("pick"),e.hasKey=Kd("hasKey"),e.getNestedVisibility=function(){return t.visibility&&(!t._parentProp||t._parentProp.getNestedVisibility())},e.getNestedPickable=function(){return t.pickable&&(!t._parentProp||t._parentProp.getNestedPickable())},e.getNestedDragable=function(){return t.dragable&&(!t._parentProp||t._parentProp.getNestedDragable())},e.getRedrawMTime=function(){return t.mtime},e.setEstimatedRenderTime=function(e){t.estimatedRenderTime=e,t.savedEstimatedRenderTime=e},e.restoreEstimatedRenderTime=function(){t.estimatedRenderTime=t.savedEstimatedRenderTime},e.addEstimatedRenderTime=function(e){t.estimatedRenderTime+=e},e.setAllocatedRenderTime=function(e){t.allocatedRenderTime=e,t.savedEstimatedRenderTime=t.estimatedRenderTime,t.estimatedRenderTime=0},e.getSupportsSelection=function(){return!1},e.getTextures=function(){return t.textures},e.hasTexture=function(e){return-1!==t.textures.indexOf(e)},e.addTexture=function(n){n&&!e.hasTexture(n)&&(t.textures=t.textures.concat(n),e.modified())},e.removeTexture=function(n){var r=t.textures.filter((function(e){return e!==n}));t.textures.length!==r.length&&(t.textures=r,e.modified())},e.removeAllTextures=function(){t.textures=[],e.modified()},e.setCoordinateSystemToWorld=function(){return e.setCoordinateSystem(Wd.WORLD)},e.setCoordinateSystemToDisplay=function(){return e.setCoordinateSystem(Wd.DISPLAY)}}var Xd={allocatedRenderTime:10,coordinateSystem:Wd.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function qd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Xd,n),nn.obj(e,t),nn.get(e,t,["estimatedRenderTime","allocatedRenderTime"]),nn.setGet(e,t,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),nn.moveToProtected(e,t,["parentProp"]),Hd(e,t)}var Yd=nn.newInstance(qd,"vtkProp"),Zd=jd({newInstance:Yd,extend:qd},Gd);function $d(e,t){function n(){e.computeMatrix()}t.classHierarchy.push("vtkProp3D"),e.addPosition=function(n){t.position=t.position.map((function(e,t){return e+n[t]})),e.modified()},e.getOrientationWXYZ=function(){var e=Ur();te(e,t.rotation);var n=new Float64Array(3),r=Gr(n,e);return[_n(r),n[0],n[1],n[2]]},e.rotateX=function(n){0!==n&&(Z(t.rotation,t.rotation,Un(n)),e.modified())},e.rotateY=function(n){0!==n&&($(t.rotation,t.rotation,Un(n)),e.modified())},e.rotateZ=function(n){0!==n&&(J(t.rotation,t.rotation,Un(n)),e.modified())},e.rotateWXYZ=function(n,r,a,o){if(0!==n&&(0!==r||0!==a||0!==o)){var i=Un(n),s=Ur();_r(s,[r,a,o],i);var l=new Float64Array(16);re(l,s),X(t.rotation,t.rotation,l),e.modified()}},e.setOrientation=function(n,r,a){return(n!==t.orientation[0]||r!==t.orientation[1]||a!==t.orientation[2])&&(t.orientation=[n,r,a],W(t.rotation),e.rotateZ(a),e.rotateX(n),e.rotateY(r),e.modified(),!0)},e.setUserMatrix=function(n){return!$n(t.userMatrix,n)&&(j(t.userMatrix,n),e.modified(),!0)},e.getMatrix=function(){return e.computeMatrix(),t.matrix},e.computeMatrix=function(){if(e.getMTime()>t.matrixMTime.getMTime()){W(t.matrix),t.userMatrix&&X(t.matrix,t.matrix,t.userMatrix),q(t.matrix,t.matrix,t.origin),q(t.matrix,t.matrix,t.position),X(t.matrix,t.matrix,t.rotation),Y(t.matrix,t.matrix,t.scale),q(t.matrix,t.matrix,[-t.origin[0],-t.origin[1],-t.origin[2]]),K(t.matrix,t.matrix),t.isIdentity=!0;for(var n=0;n<4;++n)for(var r=0;r<4;++r)(n===r?1:0)!==t.matrix[n+4*r]&&(t.isIdentity=!1);t.matrixMTime.modified()}},e.getCenter=function(){return Ud.getCenter(t.bounds)},e.getLength=function(){return Ud.getLength(t.bounds)},e.getXRange=function(){return Ud.getXRange(t.bounds)},e.getYRange=function(){return Ud.getYRange(t.bounds)},e.getZRange=function(){return Ud.getZRange(t.bounds)},e.getUserMatrix=function(){return t.userMatrix},e.onModified(n)}var Jd={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function Qd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Jd,n),Zd.extend(e,t,n),t.matrixMTime={},nn.obj(t.matrixMTime),nn.get(e,t,["bounds","isIdentity"]),nn.getArray(e,t,["orientation"]),nn.setGetArray(e,t,["origin","position","scale"],3),t.matrix=W(new Float64Array(16)),t.rotation=W(new Float64Array(16)),t.userMatrix=W(new Float64Array(16)),t.transform=null,$d(e,t)}var ep=nn.newInstance(Qd,"vtkProp3D"),tp={newInstance:ep,extend:Qd},np=io.InterpolationType,rp=nn.vtkErrorMacro,ap=4;function op(e,t){t.classHierarchy.push("vtkImageProperty"),e.getMTime=function(){for(var e,n=t.mtime,r=0;r<ap;r++)t.componentData[r].rGBTransferFunction&&(e=t.componentData[r].rGBTransferFunction.getMTime(),n=n>e?n:e),t.componentData[r].piecewiseFunction&&(e=t.componentData[r].piecewiseFunction.getMTime(),n=n>e?n:e);return n},e.setRGBTransferFunction=function(n,r){var a=n,o=r;return Number.isInteger(n)||(o=n,a=0),t.componentData[a].rGBTransferFunction!==o&&(t.componentData[a].rGBTransferFunction=o,e.modified(),!0)},e.getRGBTransferFunction=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.componentData[e].rGBTransferFunction},e.setPiecewiseFunction=function(n,r){var a=n,o=r;return Number.isInteger(n)||(o=n,a=0),t.componentData[a].piecewiseFunction!==o&&(t.componentData[a].piecewiseFunction=o,e.modified(),!0)},e.getPiecewiseFunction=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.componentData[e].piecewiseFunction},e.setScalarOpacity=function(t,n){var r=t,a=n;return Number.isInteger(t)||(a=t,r=0),e.setPiecewiseFunction(r,a)},e.getScalarOpacity=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e.getPiecewiseFunction(t)},e.setComponentWeight=function(n,r){if(n<0||n>=ap)return rp("Invalid index"),!1;var a=Math.min(1,Math.max(0,r));return t.componentData[n].componentWeight!==a&&(t.componentData[n].componentWeight=a,e.modified(),!0)},e.getComponentWeight=function(e){return e<0||e>=ap?(rp("Invalid index"),0):t.componentData[e].componentWeight},e.setInterpolationTypeToNearest=function(){return e.setInterpolationType(np.NEAREST)},e.setInterpolationTypeToLinear=function(){return e.setInterpolationType(np.LINEAR)},e.getInterpolationTypeAsString=function(){return nn.enumToString(np,t.interpolationType)}}var ip={independentComponents:!1,interpolationType:np.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1};function sp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,ip,n),nn.obj(e,t),!t.componentData){t.componentData=[];for(var r=0;r<ap;r++)t.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}nn.setGet(e,t,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange"]),op(e,t)}var lp=nn.newInstance(sp,"vtkImageProperty"),cp={newInstance:lp,extend:sp},up=nn.vtkDebugMacro;function fp(e,t){t.classHierarchy.push("vtkImageSlice"),e.getActors=function(){return e},e.getImages=function(){return e},e.getIsOpaque=function(){if(t.forceOpaque)return!0;if(t.forceTranslucent)return!1;t.property||e.getProperty();var n=t.property.getOpacity()>=1;return n=n&&(!t.mapper||t.mapper.getIsOpaque()),n},e.hasTranslucentPolygonalGeometry=function(){return!1},e.makeProperty=cp.newInstance,e.getProperty=function(){return null===t.property&&(t.property=e.makeProperty()),t.property},e.getBounds=function(){if(null===t.mapper)return t.bounds;var n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;var r=function(e){return e[0].map((function(t,n){return e.map((function(e){return e[n]}))}))};if(!t.mapperBounds||!r([n,t.mapperBounds]).reduce((function(e,t){return e&&t[0]===t[1]}),!0)||e.getMTime()>t.boundsMTime.getMTime()){up("Recomputing bounds..."),t.mapperBounds=n.map((function(e){return e}));var a=[];Ud.getCorners(n,a),e.computeMatrix();var o=new Float64Array(16);K(o,t.matrix),a.forEach((function(e){return Er(e,e,o)})),t.bounds[0]=t.bounds[2]=t.bounds[4]=Number.MAX_VALUE,t.bounds[1]=t.bounds[3]=t.bounds[5]=-Number.MAX_VALUE,t.bounds=t.bounds.map((function(e,t){return t%2===0?a.reduce((function(e,n){return e>n[t/2]?n[t/2]:e}),e):a.reduce((function(e,n){return e<n[(t-1)/2]?n[(t-1)/2]:e}),e)})),t.boundsMTime.modified()}return t.bounds},e.getBoundsForSlice=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=t.mapper.getBoundsForSlice(n,r);if(!a||6!==a.length)return a;if(a[0]>a[1])return a;var o=[];Ud.getCorners(a,o),e.computeMatrix();var i=new Float64Array(16);K(i,t.matrix),o.forEach((function(e){return Er(e,e,i)}));var s=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];return s=s.map((function(e,t){return t%2===0?o.reduce((function(e,n){return e>n[t/2]?n[t/2]:e}),e):o.reduce((function(e,n){return e<n[(t-1)/2]?n[(t-1)/2]:e}),e)})),s},e.getMinXBound=function(){return e.getBounds(),t.bounds[0]},e.getMaxXBound=function(){return e.getBounds(),t.bounds[1]},e.getMinYBound=function(){return e.getBounds(),t.bounds[2]},e.getMaxYBound=function(){return e.getBounds(),t.bounds[3]},e.getMinZBound=function(){return e.getBounds(),t.bounds[4]},e.getMaxZBound=function(){return e.getBounds(),t.bounds[5]},e.getMTime=function(){var e=t.mtime;if(null!==t.property){var n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=function(){var e=t.mtime;if(null!==t.mapper){var n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}if(null!==t.property){var r=t.property.getMTime();e=r>e?r:e,null!==t.property.getRGBTransferFunction()&&(r=t.property.getRGBTransferFunction().getMTime(),e=r>e?r:e)}return e},e.getSupportsSelection=function(){return!!t.mapper&&t.mapper.getSupportsSelection()}}var dp={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function pp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,dp,n),tp.extend(e,t,n),t.boundsMTime={},nn.obj(t.boundsMTime),nn.set(e,t,["property"]),nn.setGet(e,t,["mapper"]),nn.getArray(e,t,["bounds"],6),fp(e,t)}nn.newInstance(pp,"vtkImageSlice"),n(8642),n(5175);var mp=n(7436),gp={name:"Detectchanges",components:{Tabinfor:d.Z,Bottominfor:p.Z,DraggableItem:R},beforeRouteEnter(e,t,n){n((e=>{document.querySelector(".el-main").scrollTop=0}))},data(){return{holeShow:!0,isSliderLocked:!1,preMode:1,pairs:[],hisPairs:[],shaPairs:[],canUpload:!0,onRender:0,isUpload:!0,hisNum:0,value:null,renderstyle:"原图",funtype:"变化检测",scrollTop:"",currentQroup:0,currentIndex:0,fileList1:[],fileList2:[],uploadSrc1:[],uploadSrc2:[],uploadSrc:[],upload:{window_size:256,stride:128,list:[{first:"",second:""}],prehandle:0,denoise:0,model_path:""},modelPathArr:[]}},created(){this.getMore(),this.getCustomModel("change_detection").then((e=>{this.modelPathArr=e.data.data,this.upload.model_path=this.modelPathArr[0]?.model_path})).catch((e=>{}))},methods:{downloadimgWithWords:u.R3,historyGetPage:f.G,imgUpload:c.cM,getCustomModel:c.Xk,createSrc:c.EE,getImgArrayBuffer:u.pT,atchDownload:u.wR,histogramUpload:c.EW,outputFileInformation(e){var t=document.querySelector("textarea");t.textContent="Loading...";const n=e.dataTransfer,r=e.target.files||n.files;function a(e){function n(e,t){return t&&void 0!==t.byteLength?String(t.slice(0,6))+"...":t}t.textContent=JSON.stringify(e,n,4)}return a(r.length),1===r.length?(0,k.Z)(null,r[0]).then((function({image:e,webWorker:t}){t.terminate(),a(e);const n=B.Z.convertItkToVtkImage(e),r=n,o=document.querySelector("#container"),i=V.ZP.newInstance({rootContainer:o,containerStyle:{height:"100%",overflow:"hidden"},background:[0,0,0]}),s=i.getRenderer(),l=i.getRenderWindow(),c=F.ZP.newInstance(),u=N.ZP.newInstance();u.setInputData(r),c.setMapper(u);const f=.7*Math.sqrt(r.getSpacing().map((e=>e*e)).reduce(((e,t)=>e+t),0));u.setSampleDistance(f);const d=s.getActiveCamera();d.setPosition(0,-1,0),d.setFocalPoint(0,0,0),d.setViewUp(0,0,1),s.addActor(c),s.resetCamera(),l.render()})):(0,L.Z)(null,r).then((({webWorker:e,image:t})=>{e.terminate(),a("source");const n=B.Z.convertItkToVtkImage(t);a(n);const r=n,o=document.querySelector("#container"),i=V.ZP.newInstance({rootContainer:o,containerStyle:{height:"100%",overflow:"hidden"},background:[0,0,0]}),s=i.getRenderer(),l=i.getRenderWindow();l.getInteractor().setDesiredUpdateRate(15);const c=F.ZP.newInstance(),u=N.ZP.newInstance();u.setInputData(r),c.setMapper(u);const f=.7*Math.sqrt(r.getSpacing().map((e=>e*e)).reduce(((e,t)=>e+t),0));u.setSampleDistance(f);const d=s.getActiveCamera();d.setPosition(0,-1,0),d.setFocalPoint(0,0,0),d.setViewUp(0,0,1);const p=U.ZP.newInstance(),m=_.ZP.newInstance();p.applyColorMap(mp.Z.getPresetByName("Cool to Warm")),p.setMappingRange(0,256),p.updateRange();for(let a=0;a<=8;a++)m.addPoint(32*a,a/8);c.getProperty().setRGBTransferFunction(0,p),c.getProperty().setScalarOpacity(0,m),s.addActor(c),s.resetCamera(),l.render()}))},clearQueue(){this.fileList1=[],this.fileList2=[],this.$message.success("清除成功")},goRenderThese(e){this.currentQroup=5*e,this.currentIndex=5*e,this.goRenderThis(0)},uploadfile(){if(this.uploadSrc=[],this.upload.window_size!==this.upload.stride)if(this.fileList1.length!==this.fileList2.length||0===this.fileList1.length)this.$message.error("请按照要求上传文件夹或图片！");else{let e=new FormData,t=new FormData;for(const a of this.fileList1)e.append("files",a)||e.append("files",a.raw),e.append("type","变化检测");for(const a of this.fileList2)t.append("files",a)||t.append("files",a.raw),t.append("type","变化检测");let n=new Promise(((t,n)=>{this.createSrc(e).then((e=>{this.uploadSrc1=e.data.data,t()})).catch((e=>{}))})),r=new Promise(((e,n)=>{this.createSrc(t).then((t=>{this.uploadSrc2=t.data.data,e()})).catch((e=>{}))}));Promise.all([n,r]).then((e=>{this.uploadSrc=this.uploadSrc1.concat(this.uploadSrc2),this.uploadSrc=this.uploadSrc.map((e=>({filename:e.filename.substring(e.filename.indexOf("/")+1,e.length),src:e.src}))),this.pairs=this.uploadSrc.map((e=>e.filename.substring(e.filename.indexOf("/")+1,e.length))),this.checkPairs(this.pairs),this.canUpload?(this.upload.list=this.getList(this.uploadSrc),this.imgUpload(this.upload,"change_detection").then((e=>{this.$refs.uploadA.clearFiles(),this.$refs.uploadB.clearFiles(),this.fileList1=[],this.fileList2=[],this.$message.success("上传成功"),this.isUpload=!0,this.getMore(),this.upload.list.length>=10&&this.$confirm("上传图片过多，是否压缩?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.goCompress(this.upload.list.length)})).catch((()=>{}))})).catch((e=>{}))):this.$message.error("检测到命名对应失败的图片，请检查您的文件命名")})).catch((e=>{}))}else this.$message.error("窗口大小不能等于步长")},getList(e){let t=[],n=[];for(let r=0;r<e.length;r++){if(-1!==t.indexOf(e[r].filename)){for(let t=0;t<n.length;t++)Reflect.deleteProperty(n[t],"photo_id"),n[t].first=n[t].src,n[t].second=e[r+t].src;break}n.push(e[r]),t.push(e[r].filename)}return n},goCompress(e){this.$message.success("正在下载压缩"),this.historyGetPage(1,e,"变化检测").then((e=>{this.atchDownload(e.data.data.map((e=>({after_img:e.after_img,id:e.id}))))})).catch((e=>{}))},getMore(){this.historyGetPage(1,20,"变化检测").then((e=>{e.data.data.forEach((e=>{e["before_img1"]=D.Z.BASEURL+e.before_img1,e["before_img"]=D.Z.BASEURL+e.before_img,e["after_img"]=D.Z.BASEURL+e.after_img,e.data["hole"]=D.Z.BASEURL+e.data["hole"],e.data["hole_style"][0]=D.Z.BASEURL+e.data["hole_style"][0],e.data["hole_style"][1]=D.Z.BASEURL+e.data["hole_style"][1],e.data["hole_style"][2]=D.Z.BASEURL+e.data["hole_style"][2],e.data["hole_style"][3]=D.Z.BASEURL+e.data["hole_style"][3],e.data[0]=D.Z.BASEURL+e.data[0],e.data[1]=D.Z.BASEURL+e.data[1],e.data[2]=D.Z.BASEURL+e.data[2],e.data[3]=D.Z.BASEURL+e.data[3],e.data["mask"]=D.Z.BASEURL+e.data.mask,e.data["mask_hole"]=D.Z.BASEURL+e.data.mask_hole})),this.resultArr=e.data.data,this.onRenderResult=this.resultArr[this.currentIndex].after_img})).catch((e=>{}))},selectHistogram(){if(!0===this.$refs.histogram.checked)if(this.fileList1.length!==this.fileList2.length||0===this.fileList1.length)1===this.upload.prehandle?(this.$refs.histogram.checked=!1,this.upload.prehandle=0):(this.$refs.histogram.checked=!1,this.$message.error("请先按要求上传图片"));else{this.upload.prehandle=1,this.myhistogram.prehandle=1,this.$message.success("直方图处理"),!0===this.$refs.sharpen.checked&&(this.$refs.sharpen.checked=!1);let e=new FormData,t=new FormData;for(const a of this.fileList1)e.append("files",a)||e.append("files",a.raw),e.append("type","变化检测");for(const a of this.fileList2)t.append("files",a)||t.append("files",a.raw),t.append("type","变化检测");let n=new Promise(((t,n)=>{this.createSrc(e).then((e=>{this.uploadSrc3=e.data.data.splice(0,3),this.Img1=this.uploadSrc3.map((e=>D.Z.BASEURL+e.src)),t()})).catch((e=>{}))})),r=new Promise(((e,n)=>{this.createSrc(t).then((t=>{this.uploadSrc4=t.data.data.splice(0,3),this.Img3=this.uploadSrc4.map((e=>D.Z.BASEURL+e.src)),e()})).catch((e=>{}))}));Promise.all([n,r]).then((e=>{this.histogramSrc=this.uploadSrc3.concat(this.uploadSrc4),this.histogramSrc=this.histogramSrc.map((e=>({filename:e.filename.substring(e.filename.indexOf("/")+1,e.length),src:e.src}))),this.hisPairs=this.histogramSrc.map((e=>e.filename.substring(e.filename.indexOf("/")+1,e.length))),this.checkPairs(this.hisPairs),this.canUpload?(this.myhistogram.list=this.getList(this.histogramSrc),this.histogramUpload(this.myhistogram).then((e=>{this.Img2=e.data.data.map((e=>D.Z.BASEURL+e)),this.Img2=this.Img2.splice(0,3)})).catch((e=>{}))):(this.$message.error("检测到命名对应失败的图片，请检查您的文件命名"),this.Img1=[],this.Img3=[])})).catch((e=>{}))}else this.$message.success("取消直方图处理"),this.upload.prehandle=0,this.myhistogram.prehandle=0},selectSharpen(){if(this.fileList1.length!==this.fileList2.length||0===this.fileList1.length)4===this.upload.prehandle?(this.$refs.sharpen.checked=!1,this.upload.prehandle=0):(this.$refs.sharpen.checked=!1,this.$message.error("请先按要求上传图片"));else if(!0===this.$refs.histogram.checked&&(this.$refs.histogram.checked=!1),!1===this.$refs.sharpen.checked)this.myhistogram.prehandle=0,this.$message.success("取消锐化处理"),this.upload.prehandle=0;else{this.$message.success("锐化处理"),this.upload.prehandle=4,this.mysharpen.prehandle=4;let e=new FormData,t=new FormData;for(const a of this.fileList1)e.append("files",a)||e.append("files",a.raw),e.append("type","变化检测");for(const a of this.fileList2)t.append("files",a)||t.append("files",a.raw),t.append("type","变化检测");let n=new Promise(((t,n)=>{this.createSrc(e).then((e=>{this.sharpenSrc1=e.data.data.splice(0,3),this.Img1=this.sharpenSrc1.map((e=>D.Z.BASEURL+e.src)),t()})).catch((e=>{}))})),r=new Promise(((e,n)=>{this.createSrc(t).then((t=>{this.sharpenSrc2=t.data.data.splice(0,3),this.Img3=this.sharpenSrc2.map((e=>D.Z.BASEURL+e.src)),e()})).catch((e=>{}))}));Promise.all([n,r]).then((e=>{this.sharpenSrc=this.sharpenSrc1.concat(this.sharpenSrc2),this.sharpenSrc=this.sharpenSrc.map((e=>({filename:e.filename.substring(e.filename.indexOf("/")+1,e.length),src:e.src}))),this.shaPairs=this.sharpenSrc.map((e=>e.filename.substring(e.filename.indexOf("/")+1,e.length))),this.checkPairs(this.hisPairs),this.canUpload?(this.mysharpen.list=this.getList(this.sharpenSrc),this.histogramUpload(this.mysharpen).then((e=>{this.sharpenImg1=e.data.data.map((e=>D.Z.BASEURL+e.first)),this.sharpenImg2=e.data.data.map((e=>D.Z.BASEURL+e.second))}))):(this.$message.error("检测到命名对应失败的图片，请检查您的文件命名"),this.Img1=[],this.Img3=[])})).catch((e=>{}))}},selectFilter(){!0===this.$refs.smooth.checked&&(this.$refs.smooth.checked=!1),!1===this.$refs.filter.checked?(this.$message.success("取消高斯滤波处理"),this.upload.denoise=0):(this.$message.success("高斯滤波处理"),this.upload.denoise=5)},selectSmooth(){!0===this.$refs.filter.checked&&(this.$refs.filter.checked=!1),!1===this.$refs.smooth.checked?(this.$message.success("取消平滑处理"),this.upload.denoise=0):(this.$message.success("平滑处理"),this.upload.denoise=3)},uploadFirst(){this.checkFile1(...this.$refs.refFileA.files),this.canUpload?this.fileList1.push(...this.$refs.refFileA.files):setTimeout((()=>{this.$message.error("检测到您上传的文件夹内存在不符合规范的图片类型")}),1e3)},uploadSecond(){this.checkFile2(...this.$refs.refFileB.files),this.canUpload?this.fileList2.push(...this.$refs.refFileB.files):setTimeout((()=>{this.$message.error("检测到您上传的文件夹内存在不符合规范的图片类型")}),1e3)},file1Click(){document.querySelector("#upload-fileA").click()},file2Click(){document.querySelector("#upload-fileB").click()},checkPairs(e){let t=e.join(",")+",",n=0;for(let r=0;r<e.length;r++)if(!(t.replace(e[r]+",","").indexOf(e[r]+",")>-1)){n++;break}this.canUpload=0===n},changePreMode(){1===this.preMode?this.preMode=2:this.preMode=1},sliderMouseMove(e){const t=document.querySelector("#image-slider"),n=document.querySelector(".img-wrapper"),r=document.querySelector(".handle");if(this.isSliderLocked)return;const a=t.offsetLeft,o=t.clientWidth,i=r.clientWidth;let s=e.clientX-a;s<0?s=0:s>o&&(s=o),n.style.width=`${(100*(1-s/o)).toFixed(4)}%`,r.style.left=`calc(${(s/o*100).toFixed(4)}% - ${i/2}px)`},sliderMouseDown(){this.isSliderLocked&&(this.isSliderLocked=!1),this.sliderMouseMove(event)},sliderMouseUp(){this.isSliderLocked||(this.isSliderLocked=!0)},sliderMouseLeave(){this.isSliderLocked&&(this.isSliderLocked=!0)},vanishDrag(){this.dragShow=!1},hideMask(){this.isHiddenMask=!this.isHiddenMask}}};const vp=(0,E.Z)(gp,[["render",l]]);var hp=vp},5042:function(){}}]);
//# sourceMappingURL=969.bea68417.js.map